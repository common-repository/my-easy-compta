import{V as f}from"./api.min.js";import{_ as w,d as v,o,c as l,n as p,a as s,t as c,g as u,F as y,r as h,w as P,i as _,k as M,j as k,H as x,v as B,m as V}from"./plugin-vue_export-helper.min.js";const T={components:{VueDatePicker:f},props:{loading:{type:Boolean,default:!1},showModal:{type:Boolean,default:!1},modalId:{type:String,required:!0},modalTitle:{type:String,default:""},payment:{type:Object,default:()=>({id:null,invoice_number:"",company_name:"",amount:"",payment_method_id:"",payment_date:"",note:"",payment_methods:[]})},disabled:{type:Boolean,default:!0},methods:Array},data(){const e=window.myEasyComptaAdmin.easyComptaTranslations;return{editedPayment:{...this.payment},loadingBtn:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},fields:{invoice_number:{label:e.invoice_number,disabled:this.disabled},company_name:{label:e.client,disabled:this.disabled},amount:{label:e.amount,disabled:!1},payment_method:{label:e.payment_method},payment_date:{label:e.payment_date}}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},formattedDate(){return e=>{if(!e)return"";const t=e.getDate().toString().padStart(2,"0"),m=(e.getMonth()+1).toString().padStart(2,"0"),b=e.getFullYear();return`${t}-${m}-${b}`}},paymentMethods(){return this.methods},skeletonItems(){return Array.from({length:10},(e,t)=>t)}},methods:{closeModal(){document.getElementById("modal_payment_edit").close()},async submitForm(){this.loadingBtn=!0;try{const e=await fetch(`/wp-json/my-easy-compta/v1/payments/${this.editedPayment.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.editedPayment)});if(e.ok){const t=await e.json();this.closeModal(),this.loadingBtn=!1,this.showToast(t.message,"alert-success"),this.$emit("paymentEdited")}else{this.loadingBtn=!1;const t=`Error editing payment: ${e.statusText}`;this.showToast(t,"alert-error"),console.error(t)}}catch(e){const t=e.response&&e.response.data&&e.response.data.message?e.response.data.message:"Error editing payment";this.showToast(t,"alert-error"),console.error("Error editing payment:",e),this.loadingBtn=!1}},showToast(e,t){this.toast.message=e,this.toast.type=t,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}},watch:{payment:{handler(e){this.editedPayment={...e}},immediate:!0}}},D=["id","open"],C={class:"modal-box"},E={class:"font-bold text-lg"},S={key:0},j={class:"grid grid-cols-2 gap-4"},F=s("div",{class:"skeleton h-4 w-full mb-2"},null,-1),I=s("div",{class:"skeleton h-4 w-full"},null,-1),U=[F,I],A={class:"grid grid-cols-2 gap-4"},N=["for"],q=["type","id","onUpdate:modelValue","disabled"],z=["id"],O=["value"],H={class:"ecwp-group form-group mt-4"},J={for:"note",class:"ecwp-label form-label"},L={class:"form-group mt-4 flex justify-end"},W=["disabled"],X={key:0,class:"loading loading-spinner loading-sm"};function Y(e,t,m,b,a,i){const g=v("VueDatePicker");return o(),l("div",null,[a.toast.visible?(o(),l("div",{key:0,class:p(["toast",a.toast.position]),style:{zIndex:9999}},[s("div",{class:p(["alert",a.toast.type,"text-white"])},[s("span",null,c(a.toast.message),1)],2)],2)):u("",!0),s("dialog",{id:m.modalId,class:"modal",open:m.showModal},[s("div",C,[s("h3",E,c(m.modalTitle),1),s("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:t[0]||(t[0]=(...n)=>i.closeModal&&i.closeModal(...n))}," \u2715 "),m.loading?(o(),l("div",S,[s("div",j,[(o(!0),l(y,null,h(i.skeletonItems,n=>(o(),l("div",{key:n,class:"py-2"},U))),128))])])):(o(),l("form",{key:1,onSubmit:t[4]||(t[4]=P((...n)=>i.submitForm&&i.submitForm(...n),["prevent"])),class:"form"},[s("div",A,[(o(!0),l(y,null,h(a.fields,(n,d)=>(o(),l("div",{key:d,class:"ecwp-group form-group"},[s("label",{for:d,class:"ecwp-label form-label"},c(n.label),9,N),d!=="payment_method"&&d!=="payment_date"?_((o(),l("input",{key:0,type:n.type||"text",id:d,"onUpdate:modelValue":r=>a.editedPayment[d]=r,class:p(["ecwp-input input","input-bordered",n.class||"w-full"]),disabled:n.disabled},null,10,q)),[[M,a.editedPayment[d]]]):d=="payment_method"?_((o(),l("select",{key:1,id:d,"onUpdate:modelValue":t[1]||(t[1]=r=>a.editedPayment.payment_method_id=r),class:p(["ecwp-input input","input-bordered",n.class||"w-full"])},[(o(!0),l(y,null,h(i.paymentMethods,r=>(o(),l("option",{key:r.id,value:r.id},c(r.method_name),9,O))),128))],10,z)),[[k,a.editedPayment.payment_method_id]]):d=="payment_date"?(o(),x(g,{key:2,class:"ecwp-input ecwp-date input input-bordered w-full",id:"invoiceDate",modelValue:a.editedPayment.payment_date,"onUpdate:modelValue":t[2]||(t[2]=r=>a.editedPayment.payment_date=r),"enable-time-picker":!1,"auto-apply":"",format:i.formattedDate,"min-date":new Date,locale:"fr",required:""},null,8,["modelValue","format","min-date"])):u("",!0)]))),128))]),s("div",H,[s("label",J,c(i.translations.note),1),_(s("textarea",{id:"note","onUpdate:modelValue":t[3]||(t[3]=n=>a.editedPayment.notes=n),class:"ecwp-input textarea textarea-bordered w-full",rows:"4"},null,512),[[B,a.editedPayment.notes]])]),s("div",L,[s("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:a.loadingBtn},[V(c(i.translations.save)+" ",1),a.loadingBtn?(o(),l("span",X)):u("",!0)],8,W)])],32))])],8,D)])}var Q=w(T,[["render",Y]]);export{Q as P};
