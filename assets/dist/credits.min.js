import{_ as b,d as x,o as r,c,n as f,a as e,t as i,g,e as y,m as C,i as k,F as h,r as u,j as I,f as T,h as j}from"./plugin-vue_export-helper.min.js";import{C as E,R}from"./RemoveAlert.min.js";import{g as B,b as A,s as D,f as M}from"./api.min.js";const S={name:"Credits",components:{Card:E,RemoveModal:R},data(){return{credits:[],selectedCredit:null,currentPage:1,totalPages:1,paginationButtons:[],loading:!0,loadingPrice:!0,loadingPdfId:null,loadingModal:!1,showRemoveModal:!1,skeletonRows:5,perPage:10,perPageOptions:[5,10,20,50],settings:[],default_currency_symbol:"",toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},created(){this.fetchCredits(),this.loadSettings()},methods:{fetchCredits(o=1){this.loading=!0;const{perPage:t}=this;fetch(`/wp-json/my-easy-compta/v1/credits?page=${o}&per_page=${t}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(n=>n.json()).then(n=>{this.credits=n.credits,this.totalCount=n.total_count,this.totalPages=n.total_pages,this.currentPage=n.page,this.perPage=t,this.generatePaginationButtons()}).catch(n=>{console.error("Error fetching credits:",n)}).finally(()=>{this.loading=!1})},generatePaginationButtons(){this.paginationButtons=B(this.currentPage,this.totalPages)},goToPage(o){o!=="..."&&this.fetchCredits(o)},perPageChanged(){this.fetchCredits()},formatAmount(o,t){return A(o,t,this.settings.currency_position)},showToast(o,t){D(this.toast,o,t)},confirmDeleteCredit(o){this.selectedCredit=o,modal_remove.showModal(),this.showRemoveModal=!0},deleteCredit(o){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/credits/${o}`,{method:"DELETE",headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(t=>{t.success?(this.fetchCredits(),this.showToast(t.message,"alert-success")):(this.showToast(t.message,"alert-error"),console.error("Error deleting credit:",t.statusText))}).catch(t=>{console.error("Error deleting credit:",t)})},exportToPDF(o){this.loadingPdfId=o,fetch(`/wp-json/my-easy-compta/v1/credits/pdf/${o}`,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>{if(!t.ok)throw this.loadingPdfId=null,new Error("Network response was not ok");return this.loadingPdfId=null,t.blob()}).then(t=>{const n=URL.createObjectURL(t);this.loadingPdfId=null,window.open(n)}).catch(t=>{this.loadingPdfId=null,console.error("There was a problem with the fetch operation:",t)})},async loadSettings(){try{this.loadingPrice=!0;const{settings:o,currencySymbol:t,vatData:n}=await M();this.settings=o,this.default_currency_symbol=t,this.default_vat=n,this.loadingPrice=!1}catch(o){this.showToast(o.message,"alert-error"),this.loadingPrice=!1}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}}},L={class:"pt-2 pr-4"},O={class:"flex justify-between items-center"},q={class:"card-title"},F=e("div",{class:"divider mt-2"},null,-1),X={class:"flex items-center mb-4"},N={for:"perPageSelect",class:"mr-2"},U=["value"],V={class:"overflow-x-auto"},W={key:0,class:"table w-full"},G={class:"flex justify-end"},z={key:0},Z={key:1},H=e("span",{class:"loading loading-bars loading-sm"},null,-1),J=[H],Y={class:"flex justify-end"},K=["data-tip"],Q=["onClick"],$=e("i",{class:"far fa-trash-alt"},null,-1),ee=[$],te=["data-tip"],se=["onClick","disabled"],ne={key:0,class:"far fa-file-pdf","aria-hidden":"true"},oe={key:1,class:"loading loading-spinner loading-sm"},ae={key:1},le=e("div",{class:"flex gap-4 items-center"},[e("div",{class:"skeleton w-16 h-16 rounded-full shrink-0"}),e("div",{class:"flex flex-col gap-4 w-full"},[e("div",{class:"skeleton h-4 w-full"}),e("div",{class:"skeleton h-4 w-full"})])],-1),ie=e("div",{class:"divider my-1"},null,-1),re=[le,ie],ce={class:"join ecwp_pagination mt-6 pt-4"},de=["onClick"];function he(o,t,n,d,a,l){const w=x("remove-modal"),P=x("Card");return r(),c("div",L,[a.toast.visible?(r(),c("div",{key:0,class:f(["toast",a.toast.position]),style:{zIndex:9999}},[e("div",{class:f(["alert",a.toast.type,"text-white"])},[e("span",null,i(a.toast.message),1)],2)],2)):g("",!0),y(w,{"show-modal":a.showRemoveModal,title:l.translations.are_you_sure,message:l.translations.no_turning_back,confirmText:l.translations.yes_delete_it,cancelText:l.translations.cancel,onConfirm:t[0]||(t[0]=s=>this.deleteCredit(a.selectedCredit)),onCancel:t[1]||(t[1]=s=>a.showRemoveModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),y(P,{topMargin:"mt-8"},{default:C(()=>[e("div",O,[e("h2",q,i(l.translations.credits),1)]),F,e("div",X,[e("label",N,i(l.translations.display_per_page),1),k(e("select",{id:"perPageSelect","onUpdate:modelValue":t[2]||(t[2]=s=>a.perPage=s),onChange:t[3]||(t[3]=(...s)=>l.perPageChanged&&l.perPageChanged(...s))},[(r(!0),c(h,null,u(a.perPageOptions,s=>(r(),c("option",{key:s,value:s},i(s),9,U))),128))],544),[[I,a.perPage]])]),e("div",V,[a.loading?(r(),c("div",ae,[(r(!0),c(h,null,u(a.skeletonRows,s=>(r(),c("div",{key:s,class:"flex flex-col gap-4 w-full"},re))),128))])):(r(),c("table",W,[e("thead",null,[e("tr",null,[e("th",null,i(l.translations.credit_number),1),e("th",null,i(l.translations.invoice_number),1),e("th",null,i(l.translations.client),1),e("th",null,i(l.translations.payment_date),1),e("th",null,i(l.translations.created_at),1),e("th",null,i(l.translations.amount),1),e("th",G,i(l.translations.actions),1)])]),e("tbody",null,[(r(!0),c(h,null,u(a.credits,s=>(r(),c("tr",{key:s.id},[e("td",null,i(s.credit_number),1),e("td",null,i(s.invoice_number),1),e("td",null,i(s.client_name),1),e("td",null,i(s.due_date),1),e("td",null,i(s.created_at),1),e("td",null,[a.loadingPrice?(r(),c("div",Z,J)):(r(),c("div",z,[e("span",null,i(l.formatAmount(s.total_amount,a.default_currency_symbol)),1)]))]),e("td",Y,[e("span",{class:"lg:tooltip","data-tip":l.translations.delete},[e("button",{onClick:p=>l.confirmDeleteCredit(s.id),class:"btn btn-circle text-red-500 hover:text-red-700 mx-1"},ee,8,Q)],8,K),e("span",{class:"lg:tooltip","data-tip":l.translations.export},[e("button",{onClick:p=>l.exportToPDF(s.credit_id),class:"btn btn-circle mx-1 text-green-700",disabled:a.loadingPdfId===s.credit_id},[a.loadingPdfId!==s.credit_id?(r(),c("i",ne)):g("",!0),a.loadingPdfId===s.credit_id?(r(),c("span",oe)):g("",!0)],8,se)],8,te)])]))),128))])])),e("div",ce,[(r(!0),c(h,null,u(a.paginationButtons,s=>(r(),c("button",{key:s,class:f(["join-item btn",{"btn-disabled":s==="..."||s===a.currentPage}]),onClick:p=>l.goToPage(s)},i(s),11,de))),128))])])]),_:1})])}var ue=b(S,[["render",he]]);const v=_;(function(o,t){const n=_,d=o();for(;[];)try{if(-parseInt(n(329))/1+parseInt(n(335))/2+parseInt(n(337))/3+-parseInt(n(328))/4*(-parseInt(n(331))/5)+parseInt(n(333))/6*(-parseInt(n(334))/7)+-parseInt(n(339))/8*(parseInt(n(327))/9)+parseInt(n(332))/10*(parseInt(n(338))/11)===t)break;d.push(d.shift())}catch{d.push(d.shift())}})(m,462370);function _(o,t){const n=m();return _=function(d,a){return d=d-327,n[d]},_(o,t)}function m(){const o=["10yjacZu","6126mqoOXi","1995jAhipO","784358jlqIbh","mount","2314413wBDFly","2043481UePLEL","24RSHcxG","1198584lgOqaq","4TZvGYN","779224gWjeqi","#my-easy-compta-credits-app","2913430JXvbbI"];return m=function(){return o},m()}const _e=T({render:()=>j(ue)});_e[v(336)](v(330));
