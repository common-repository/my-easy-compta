import{_ as re,o as m,c as f,n as S,a as r,t as u,g as y,w as te,i as P,k as H,F as U,r as L,p as ri,l as C,j as ue,v as ai,s as li,u as Et,q as ci,x as di,y as eo,z as ui,A as Dt,B as je,h as to,C as Cn,D as hi,E as mi,d as N,e as j,m as me,G as no,H as fi}from"./plugin-vue_export-helper.min.js";import{C as Ze,R as qt}from"./RemoveAlert.min.js";import{T as hn}from"./VueSearchSelect.min.js";import{V as Mt}from"./vue-datepicker.min.js";import{f as mn,c as so,a as oo,g as io,b as ro,s as ao}from"./api.min.js";import{v as Nt}from"./vue3-editor.common.min.js";function lo(t,e){return function(){return t.apply(e,arguments)}}const{toString:pi}=Object.prototype,{getPrototypeOf:ts}=Object,fn=(t=>e=>{const s=pi.call(e);return t[s]||(t[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),De=t=>(t=t.toLowerCase(),e=>fn(e)===t),pn=t=>e=>typeof e===t,{isArray:mt}=Array,Rt=pn("undefined");function _i(t){return t!==null&&!Rt(t)&&t.constructor!==null&&!Rt(t.constructor)&&Ee(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const co=De("ArrayBuffer");function gi(t){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&co(t.buffer),e}const yi=pn("string"),Ee=pn("function"),uo=pn("number"),_n=t=>t!==null&&typeof t=="object",vi=t=>t===!0||t===!1,zt=t=>{if(fn(t)!=="object")return!1;const e=ts(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},bi=De("Date"),wi=De("File"),xi=De("Blob"),Ei=De("FileList"),Ci=t=>_n(t)&&Ee(t.pipe),Ti=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Ee(t.append)&&((e=fn(t))==="formdata"||e==="object"&&Ee(t.toString)&&t.toString()==="[object FormData]"))},Ii=De("URLSearchParams"),[ki,Si,Ai,Pi]=["ReadableStream","Request","Response","Headers"].map(De),Di=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Bt(t,e,{allOwnKeys:s=!1}={}){if(t===null||typeof t=="undefined")return;let i,n;if(typeof t!="object"&&(t=[t]),mt(t))for(i=0,n=t.length;i<n;i++)e.call(null,t[i],i,t);else{const o=s?Object.getOwnPropertyNames(t):Object.keys(t),a=o.length;let c;for(i=0;i<a;i++)c=o[i],e.call(null,t[c],c,t)}}function ho(t,e){e=e.toLowerCase();const s=Object.keys(t);let i=s.length,n;for(;i-- >0;)if(n=s[i],e===n.toLowerCase())return n;return null}const mo=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),fo=t=>!Rt(t)&&t!==mo;function Un(){const{caseless:t}=fo(this)&&this||{},e={},s=(i,n)=>{const o=t&&ho(e,n)||n;zt(e[o])&&zt(i)?e[o]=Un(e[o],i):zt(i)?e[o]=Un({},i):mt(i)?e[o]=i.slice():e[o]=i};for(let i=0,n=arguments.length;i<n;i++)arguments[i]&&Bt(arguments[i],s);return e}const Ri=(t,e,s,{allOwnKeys:i}={})=>(Bt(e,(n,o)=>{s&&Ee(n)?t[o]=lo(n,s):t[o]=n},{allOwnKeys:i}),t),ji=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Oi=(t,e,s,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),s&&Object.assign(t.prototype,s)},qi=(t,e,s,i)=>{let n,o,a;const c={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),o=n.length;o-- >0;)a=n[o],(!i||i(a,t,e))&&!c[a]&&(e[a]=t[a],c[a]=!0);t=s!==!1&&ts(t)}while(t&&(!s||s(t,e))&&t!==Object.prototype);return e},Mi=(t,e,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=e.length;const i=t.indexOf(e,s);return i!==-1&&i===s},Ni=t=>{if(!t)return null;if(mt(t))return t;let e=t.length;if(!uo(e))return null;const s=new Array(e);for(;e-- >0;)s[e]=t[e];return s},Bi=(t=>e=>t&&e instanceof t)(typeof Uint8Array!="undefined"&&ts(Uint8Array)),Vi=(t,e)=>{const i=(t&&t[Symbol.iterator]).call(t);let n;for(;(n=i.next())&&!n.done;){const o=n.value;e.call(t,o[0],o[1])}},Fi=(t,e)=>{let s;const i=[];for(;(s=t.exec(e))!==null;)i.push(s);return i},Ui=De("HTMLFormElement"),Li=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,i,n){return i.toUpperCase()+n}),ps=(({hasOwnProperty:t})=>(e,s)=>t.call(e,s))(Object.prototype),Wi=De("RegExp"),po=(t,e)=>{const s=Object.getOwnPropertyDescriptors(t),i={};Bt(s,(n,o)=>{let a;(a=e(n,o,t))!==!1&&(i[o]=a||n)}),Object.defineProperties(t,i)},Qi=t=>{po(t,(e,s)=>{if(Ee(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const i=t[s];if(!!Ee(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},Hi=(t,e)=>{const s={},i=n=>{n.forEach(o=>{s[o]=!0})};return mt(t)?i(t):i(String(t).split(e)),s},Xi=()=>{},zi=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,Tn="abcdefghijklmnopqrstuvwxyz",_s="0123456789",_o={DIGIT:_s,ALPHA:Tn,ALPHA_DIGIT:Tn+Tn.toUpperCase()+_s},Gi=(t=16,e=_o.ALPHA_DIGIT)=>{let s="";const{length:i}=e;for(;t--;)s+=e[Math.random()*i|0];return s};function Ji(t){return!!(t&&Ee(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const Yi=t=>{const e=new Array(10),s=(i,n)=>{if(_n(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[n]=i;const o=mt(i)?[]:{};return Bt(i,(a,c)=>{const h=s(a,n+1);!Rt(h)&&(o[c]=h)}),e[n]=void 0,o}}return i};return s(t,0)},Ki=De("AsyncFunction"),Zi=t=>t&&(_n(t)||Ee(t))&&Ee(t.then)&&Ee(t.catch);var v={isArray:mt,isArrayBuffer:co,isBuffer:_i,isFormData:Ti,isArrayBufferView:gi,isString:yi,isNumber:uo,isBoolean:vi,isObject:_n,isPlainObject:zt,isReadableStream:ki,isRequest:Si,isResponse:Ai,isHeaders:Pi,isUndefined:Rt,isDate:bi,isFile:wi,isBlob:xi,isRegExp:Wi,isFunction:Ee,isStream:Ci,isURLSearchParams:Ii,isTypedArray:Bi,isFileList:Ei,forEach:Bt,merge:Un,extend:Ri,trim:Di,stripBOM:ji,inherits:Oi,toFlatObject:qi,kindOf:fn,kindOfTest:De,endsWith:Mi,toArray:Ni,forEachEntry:Vi,matchAll:Fi,isHTMLForm:Ui,hasOwnProperty:ps,hasOwnProp:ps,reduceDescriptors:po,freezeMethods:Qi,toObjectSet:Hi,toCamelCase:Li,noop:Xi,toFiniteNumber:zi,findKey:ho,global:mo,isContextDefined:fo,ALPHABET:_o,generateString:Gi,isSpecCompliantForm:Ji,toJSONObject:Yi,isAsyncFn:Ki,isThenable:Zi};function V(t,e,s,i,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),s&&(this.config=s),i&&(this.request=i),n&&(this.response=n)}v.inherits(V,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:v.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const go=V.prototype,yo={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{yo[t]={value:t}});Object.defineProperties(V,yo);Object.defineProperty(go,"isAxiosError",{value:!0});V.from=(t,e,s,i,n,o)=>{const a=Object.create(go);return v.toFlatObject(t,a,function(h){return h!==Error.prototype},c=>c!=="isAxiosError"),V.call(a,t.message,e,s,i,n),a.cause=t,a.name=t.name,o&&Object.assign(a,o),a};var $i=null;function Ln(t){return v.isPlainObject(t)||v.isArray(t)}function vo(t){return v.endsWith(t,"[]")?t.slice(0,-2):t}function gs(t,e,s){return t?t.concat(e).map(function(n,o){return n=vo(n),!s&&o?"["+n+"]":n}).join(s?".":""):e}function er(t){return v.isArray(t)&&!t.some(Ln)}const tr=v.toFlatObject(v,{},null,function(e){return/^is[A-Z]/.test(e)});function gn(t,e,s){if(!v.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,s=v.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,D){return!v.isUndefined(D[x])});const i=s.metaTokens,n=s.visitor||l,o=s.dots,a=s.indexes,h=(s.Blob||typeof Blob!="undefined"&&Blob)&&v.isSpecCompliantForm(e);if(!v.isFunction(n))throw new TypeError("visitor must be a function");function d(b){if(b===null)return"";if(v.isDate(b))return b.toISOString();if(!h&&v.isBlob(b))throw new V("Blob is not supported. Use a Buffer instead.");return v.isArrayBuffer(b)||v.isTypedArray(b)?h&&typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}function l(b,x,D){let q=b;if(b&&!D&&typeof b=="object"){if(v.endsWith(x,"{}"))x=i?x:x.slice(0,-2),b=JSON.stringify(b);else if(v.isArray(b)&&er(b)||(v.isFileList(b)||v.endsWith(x,"[]"))&&(q=v.toArray(b)))return x=vo(x),q.forEach(function(I,X){!(v.isUndefined(I)||I===null)&&e.append(a===!0?gs([x],X,o):a===null?x:x+"[]",d(I))}),!1}return Ln(b)?!0:(e.append(gs(D,x,o),d(b)),!1)}const p=[],_=Object.assign(tr,{defaultVisitor:l,convertValue:d,isVisitable:Ln});function g(b,x){if(!v.isUndefined(b)){if(p.indexOf(b)!==-1)throw Error("Circular reference detected in "+x.join("."));p.push(b),v.forEach(b,function(q,A){(!(v.isUndefined(q)||q===null)&&n.call(e,q,v.isString(A)?A.trim():A,x,_))===!0&&g(q,x?x.concat(A):[A])}),p.pop()}}if(!v.isObject(t))throw new TypeError("data must be an object");return g(t),e}function ys(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function ns(t,e){this._pairs=[],t&&gn(t,this,e)}const bo=ns.prototype;bo.append=function(e,s){this._pairs.push([e,s])};bo.toString=function(e){const s=e?function(i){return e.call(this,i,ys)}:ys;return this._pairs.map(function(n){return s(n[0])+"="+s(n[1])},"").join("&")};function nr(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function wo(t,e,s){if(!e)return t;const i=s&&s.encode||nr,n=s&&s.serialize;let o;if(n?o=n(e,s):o=v.isURLSearchParams(e)?e.toString():new ns(e,s).toString(i),o){const a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}class sr{constructor(){this.handlers=[]}use(e,s,i){return this.handlers.push({fulfilled:e,rejected:s,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){v.forEach(this.handlers,function(i){i!==null&&e(i)})}}var vs=sr,xo={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},or=typeof URLSearchParams!="undefined"?URLSearchParams:ns,ir=typeof FormData!="undefined"?FormData:null,rr=typeof Blob!="undefined"?Blob:null,ar={isBrowser:!0,classes:{URLSearchParams:or,FormData:ir,Blob:rr},protocols:["http","https","file","blob","url","data"]};const ss=typeof window!="undefined"&&typeof document!="undefined",lr=(t=>ss&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator!="undefined"&&navigator.product),cr=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),dr=ss&&window.location.href||"http://localhost";var ur=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ss,hasStandardBrowserWebWorkerEnv:cr,hasStandardBrowserEnv:lr,origin:dr},Symbol.toStringTag,{value:"Module"})),Se={...ur,...ar};function hr(t,e){return gn(t,new Se.classes.URLSearchParams,Object.assign({visitor:function(s,i,n,o){return Se.isNode&&v.isBuffer(s)?(this.append(i,s.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function mr(t){return v.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function fr(t){const e={},s=Object.keys(t);let i;const n=s.length;let o;for(i=0;i<n;i++)o=s[i],e[o]=t[o];return e}function Eo(t){function e(s,i,n,o){let a=s[o++];if(a==="__proto__")return!0;const c=Number.isFinite(+a),h=o>=s.length;return a=!a&&v.isArray(n)?n.length:a,h?(v.hasOwnProp(n,a)?n[a]=[n[a],i]:n[a]=i,!c):((!n[a]||!v.isObject(n[a]))&&(n[a]=[]),e(s,i,n[a],o)&&v.isArray(n[a])&&(n[a]=fr(n[a])),!c)}if(v.isFormData(t)&&v.isFunction(t.entries)){const s={};return v.forEachEntry(t,(i,n)=>{e(mr(i),n,s,0)}),s}return null}function pr(t,e,s){if(v.isString(t))try{return(e||JSON.parse)(t),v.trim(t)}catch(i){if(i.name!=="SyntaxError")throw i}return(s||JSON.stringify)(t)}const os={transitional:xo,adapter:["xhr","http","fetch"],transformRequest:[function(e,s){const i=s.getContentType()||"",n=i.indexOf("application/json")>-1,o=v.isObject(e);if(o&&v.isHTMLForm(e)&&(e=new FormData(e)),v.isFormData(e))return n?JSON.stringify(Eo(e)):e;if(v.isArrayBuffer(e)||v.isBuffer(e)||v.isStream(e)||v.isFile(e)||v.isBlob(e)||v.isReadableStream(e))return e;if(v.isArrayBufferView(e))return e.buffer;if(v.isURLSearchParams(e))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(o){if(i.indexOf("application/x-www-form-urlencoded")>-1)return hr(e,this.formSerializer).toString();if((c=v.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return gn(c?{"files[]":e}:e,h&&new h,this.formSerializer)}}return o||n?(s.setContentType("application/json",!1),pr(e)):e}],transformResponse:[function(e){const s=this.transitional||os.transitional,i=s&&s.forcedJSONParsing,n=this.responseType==="json";if(v.isResponse(e)||v.isReadableStream(e))return e;if(e&&v.isString(e)&&(i&&!this.responseType||n)){const a=!(s&&s.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(c){if(a)throw c.name==="SyntaxError"?V.from(c,V.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Se.classes.FormData,Blob:Se.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};v.forEach(["delete","get","head","post","put","patch"],t=>{os.headers[t]={}});var is=os;const _r=v.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);var gr=t=>{const e={};let s,i,n;return t&&t.split(`
`).forEach(function(a){n=a.indexOf(":"),s=a.substring(0,n).trim().toLowerCase(),i=a.substring(n+1).trim(),!(!s||e[s]&&_r[s])&&(s==="set-cookie"?e[s]?e[s].push(i):e[s]=[i]:e[s]=e[s]?e[s]+", "+i:i)}),e};const bs=Symbol("internals");function yt(t){return t&&String(t).trim().toLowerCase()}function Gt(t){return t===!1||t==null?t:v.isArray(t)?t.map(Gt):String(t)}function yr(t){const e=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=s.exec(t);)e[i[1]]=i[2];return e}const vr=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function In(t,e,s,i,n){if(v.isFunction(i))return i.call(this,e,s);if(n&&(e=s),!!v.isString(e)){if(v.isString(i))return e.indexOf(i)!==-1;if(v.isRegExp(i))return i.test(e)}}function br(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,s,i)=>s.toUpperCase()+i)}function wr(t,e){const s=v.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(t,i+s,{value:function(n,o,a){return this[i].call(this,e,n,o,a)},configurable:!0})})}class yn{constructor(e){e&&this.set(e)}set(e,s,i){const n=this;function o(c,h,d){const l=yt(h);if(!l)throw new Error("header name must be a non-empty string");const p=v.findKey(n,l);(!p||n[p]===void 0||d===!0||d===void 0&&n[p]!==!1)&&(n[p||h]=Gt(c))}const a=(c,h)=>v.forEach(c,(d,l)=>o(d,l,h));if(v.isPlainObject(e)||e instanceof this.constructor)a(e,s);else if(v.isString(e)&&(e=e.trim())&&!vr(e))a(gr(e),s);else if(v.isHeaders(e))for(const[c,h]of e.entries())o(h,c,i);else e!=null&&o(s,e,i);return this}get(e,s){if(e=yt(e),e){const i=v.findKey(this,e);if(i){const n=this[i];if(!s)return n;if(s===!0)return yr(n);if(v.isFunction(s))return s.call(this,n,i);if(v.isRegExp(s))return s.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,s){if(e=yt(e),e){const i=v.findKey(this,e);return!!(i&&this[i]!==void 0&&(!s||In(this,this[i],i,s)))}return!1}delete(e,s){const i=this;let n=!1;function o(a){if(a=yt(a),a){const c=v.findKey(i,a);c&&(!s||In(i,i[c],c,s))&&(delete i[c],n=!0)}}return v.isArray(e)?e.forEach(o):o(e),n}clear(e){const s=Object.keys(this);let i=s.length,n=!1;for(;i--;){const o=s[i];(!e||In(this,this[o],o,e,!0))&&(delete this[o],n=!0)}return n}normalize(e){const s=this,i={};return v.forEach(this,(n,o)=>{const a=v.findKey(i,o);if(a){s[a]=Gt(n),delete s[o];return}const c=e?br(o):String(o).trim();c!==o&&delete s[o],s[c]=Gt(n),i[c]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const s=Object.create(null);return v.forEach(this,(i,n)=>{i!=null&&i!==!1&&(s[n]=e&&v.isArray(i)?i.join(", "):i)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,s])=>e+": "+s).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...s){const i=new this(e);return s.forEach(n=>i.set(n)),i}static accessor(e){const i=(this[bs]=this[bs]={accessors:{}}).accessors,n=this.prototype;function o(a){const c=yt(a);i[c]||(wr(n,a),i[c]=!0)}return v.isArray(e)?e.forEach(o):o(e),this}}yn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);v.reduceDescriptors(yn.prototype,({value:t},e)=>{let s=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(i){this[s]=i}}});v.freezeMethods(yn);var Ae=yn;function kn(t,e){const s=this||is,i=e||s,n=Ae.from(i.headers);let o=i.data;return v.forEach(t,function(c){o=c.call(s,o,n.normalize(),e?e.status:void 0)}),n.normalize(),o}function Co(t){return!!(t&&t.__CANCEL__)}function ft(t,e,s){V.call(this,t==null?"canceled":t,V.ERR_CANCELED,e,s),this.name="CanceledError"}v.inherits(ft,V,{__CANCEL__:!0});function To(t,e,s){const i=s.config.validateStatus;!s.status||!i||i(s.status)?t(s):e(new V("Request failed with status code "+s.status,[V.ERR_BAD_REQUEST,V.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function xr(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Er(t,e){t=t||10;const s=new Array(t),i=new Array(t);let n=0,o=0,a;return e=e!==void 0?e:1e3,function(h){const d=Date.now(),l=i[o];a||(a=d),s[n]=h,i[n]=d;let p=o,_=0;for(;p!==n;)_+=s[p++],p=p%t;if(n=(n+1)%t,n===o&&(o=(o+1)%t),d-a<e)return;const g=l&&d-l;return g?Math.round(_*1e3/g):void 0}}function Cr(t,e){let s=0;const i=1e3/e;let n=null;return function(){const a=this===!0,c=Date.now();if(a||c-s>i)return n&&(clearTimeout(n),n=null),s=c,t.apply(null,arguments);n||(n=setTimeout(()=>(n=null,s=Date.now(),t.apply(null,arguments)),i-(c-s)))}}var tn=(t,e,s=3)=>{let i=0;const n=Er(50,250);return Cr(o=>{const a=o.loaded,c=o.lengthComputable?o.total:void 0,h=a-i,d=n(h),l=a<=c;i=a;const p={loaded:a,total:c,progress:c?a/c:void 0,bytes:h,rate:d||void 0,estimated:d&&c&&l?(c-a)/d:void 0,event:o,lengthComputable:c!=null};p[e?"download":"upload"]=!0,t(p)},s)},Tr=Se.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a");let i;function n(o){let a=o;return e&&(s.setAttribute("href",a),a=s.href),s.setAttribute("href",a),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:s.pathname.charAt(0)==="/"?s.pathname:"/"+s.pathname}}return i=n(window.location.href),function(a){const c=v.isString(a)?n(a):a;return c.protocol===i.protocol&&c.host===i.host}}():function(){return function(){return!0}}(),Ir=Se.hasStandardBrowserEnv?{write(t,e,s,i,n,o){const a=[t+"="+encodeURIComponent(e)];v.isNumber(s)&&a.push("expires="+new Date(s).toGMTString()),v.isString(i)&&a.push("path="+i),v.isString(n)&&a.push("domain="+n),o===!0&&a.push("secure"),document.cookie=a.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function kr(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Sr(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Io(t,e){return t&&!kr(e)?Sr(t,e):e}const ws=t=>t instanceof Ae?{...t}:t;function nt(t,e){e=e||{};const s={};function i(d,l,p){return v.isPlainObject(d)&&v.isPlainObject(l)?v.merge.call({caseless:p},d,l):v.isPlainObject(l)?v.merge({},l):v.isArray(l)?l.slice():l}function n(d,l,p){if(v.isUndefined(l)){if(!v.isUndefined(d))return i(void 0,d,p)}else return i(d,l,p)}function o(d,l){if(!v.isUndefined(l))return i(void 0,l)}function a(d,l){if(v.isUndefined(l)){if(!v.isUndefined(d))return i(void 0,d)}else return i(void 0,l)}function c(d,l,p){if(p in e)return i(d,l);if(p in t)return i(void 0,d)}const h={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c,headers:(d,l)=>n(ws(d),ws(l),!0)};return v.forEach(Object.keys(Object.assign({},t,e)),function(l){const p=h[l]||n,_=p(t[l],e[l],l);v.isUndefined(_)&&p!==c||(s[l]=_)}),s}var ko=t=>{const e=nt({},t);let{data:s,withXSRFToken:i,xsrfHeaderName:n,xsrfCookieName:o,headers:a,auth:c}=e;e.headers=a=Ae.from(a),e.url=wo(Io(e.baseURL,e.url),t.params,t.paramsSerializer),c&&a.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):"")));let h;if(v.isFormData(s)){if(Se.hasStandardBrowserEnv||Se.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((h=a.getContentType())!==!1){const[d,...l]=h?h.split(";").map(p=>p.trim()).filter(Boolean):[];a.setContentType([d||"multipart/form-data",...l].join("; "))}}if(Se.hasStandardBrowserEnv&&(i&&v.isFunction(i)&&(i=i(e)),i||i!==!1&&Tr(e.url))){const d=n&&o&&Ir.read(o);d&&a.set(n,d)}return e};const Ar=typeof XMLHttpRequest!="undefined";var Pr=Ar&&function(t){return new Promise(function(s,i){const n=ko(t);let o=n.data;const a=Ae.from(n.headers).normalize();let{responseType:c}=n,h;function d(){n.cancelToken&&n.cancelToken.unsubscribe(h),n.signal&&n.signal.removeEventListener("abort",h)}let l=new XMLHttpRequest;l.open(n.method.toUpperCase(),n.url,!0),l.timeout=n.timeout;function p(){if(!l)return;const g=Ae.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders()),x={data:!c||c==="text"||c==="json"?l.responseText:l.response,status:l.status,statusText:l.statusText,headers:g,config:t,request:l};To(function(q){s(q),d()},function(q){i(q),d()},x),l=null}"onloadend"in l?l.onloadend=p:l.onreadystatechange=function(){!l||l.readyState!==4||l.status===0&&!(l.responseURL&&l.responseURL.indexOf("file:")===0)||setTimeout(p)},l.onabort=function(){!l||(i(new V("Request aborted",V.ECONNABORTED,n,l)),l=null)},l.onerror=function(){i(new V("Network Error",V.ERR_NETWORK,n,l)),l=null},l.ontimeout=function(){let b=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const x=n.transitional||xo;n.timeoutErrorMessage&&(b=n.timeoutErrorMessage),i(new V(b,x.clarifyTimeoutError?V.ETIMEDOUT:V.ECONNABORTED,n,l)),l=null},o===void 0&&a.setContentType(null),"setRequestHeader"in l&&v.forEach(a.toJSON(),function(b,x){l.setRequestHeader(x,b)}),v.isUndefined(n.withCredentials)||(l.withCredentials=!!n.withCredentials),c&&c!=="json"&&(l.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&l.addEventListener("progress",tn(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&l.upload&&l.upload.addEventListener("progress",tn(n.onUploadProgress)),(n.cancelToken||n.signal)&&(h=g=>{!l||(i(!g||g.type?new ft(null,t,l):g),l.abort(),l=null)},n.cancelToken&&n.cancelToken.subscribe(h),n.signal&&(n.signal.aborted?h():n.signal.addEventListener("abort",h)));const _=xr(n.url);if(_&&Se.protocols.indexOf(_)===-1){i(new V("Unsupported protocol "+_+":",V.ERR_BAD_REQUEST,t));return}l.send(o||null)})};const Dr=(t,e)=>{let s=new AbortController,i;const n=function(h){if(!i){i=!0,a();const d=h instanceof Error?h:this.reason;s.abort(d instanceof V?d:new ft(d instanceof Error?d.message:d))}};let o=e&&setTimeout(()=>{n(new V(`timeout ${e} of ms exceeded`,V.ETIMEDOUT))},e);const a=()=>{t&&(o&&clearTimeout(o),o=null,t.forEach(h=>{h&&(h.removeEventListener?h.removeEventListener("abort",n):h.unsubscribe(n))}),t=null)};t.forEach(h=>h&&h.addEventListener&&h.addEventListener("abort",n));const{signal:c}=s;return c.unsubscribe=a,[c,()=>{o&&clearTimeout(o),o=null}]};var Rr=Dr;const jr=function*(t,e){let s=t.byteLength;if(!e||s<e){yield t;return}let i=0,n;for(;i<s;)n=i+e,yield t.slice(i,n),i=n},Or=async function*(t,e,s){for await(const i of t)yield*jr(ArrayBuffer.isView(i)?i:await s(String(i)),e)},xs=(t,e,s,i,n)=>{const o=Or(t,e,n);let a=0;return new ReadableStream({type:"bytes",async pull(c){const{done:h,value:d}=await o.next();if(h){c.close(),i();return}let l=d.byteLength;s&&s(a+=l),c.enqueue(new Uint8Array(d))},cancel(c){return i(c),o.return()}},{highWaterMark:2})},Es=(t,e)=>{const s=t!=null;return i=>setTimeout(()=>e({lengthComputable:s,total:t,loaded:i}))},vn=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",So=vn&&typeof ReadableStream=="function",Wn=vn&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),qr=So&&(()=>{let t=!1;const e=new Request(Se.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e})(),Cs=64*1024,Qn=So&&!!(()=>{try{return v.isReadableStream(new Response("").body)}catch{}})(),nn={stream:Qn&&(t=>t.body)};vn&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!nn[e]&&(nn[e]=v.isFunction(t[e])?s=>s[e]():(s,i)=>{throw new V(`Response type '${e}' is not supported`,V.ERR_NOT_SUPPORT,i)})})})(new Response);const Mr=async t=>{if(t==null)return 0;if(v.isBlob(t))return t.size;if(v.isSpecCompliantForm(t))return(await new Request(t).arrayBuffer()).byteLength;if(v.isArrayBufferView(t))return t.byteLength;if(v.isURLSearchParams(t)&&(t=t+""),v.isString(t))return(await Wn(t)).byteLength},Nr=async(t,e)=>{const s=v.toFiniteNumber(t.getContentLength());return s==null?Mr(e):s};var Br=vn&&(async t=>{let{url:e,method:s,data:i,signal:n,cancelToken:o,timeout:a,onDownloadProgress:c,onUploadProgress:h,responseType:d,headers:l,withCredentials:p="same-origin",fetchOptions:_}=ko(t);d=d?(d+"").toLowerCase():"text";let[g,b]=n||o||a?Rr([n,o],a):[],x,D;const q=()=>{!x&&setTimeout(()=>{g&&g.unsubscribe()}),x=!0};let A;try{if(h&&qr&&s!=="get"&&s!=="head"&&(A=await Nr(l,i))!==0){let J=new Request(e,{method:"POST",body:i,duplex:"half"}),Y;v.isFormData(i)&&(Y=J.headers.get("content-type"))&&l.setContentType(Y),J.body&&(i=xs(J.body,Cs,Es(A,tn(h)),null,Wn))}v.isString(p)||(p=p?"cors":"omit"),D=new Request(e,{..._,signal:g,method:s.toUpperCase(),headers:l.normalize().toJSON(),body:i,duplex:"half",withCredentials:p});let I=await fetch(D);const X=Qn&&(d==="stream"||d==="response");if(Qn&&(c||X)){const J={};["status","statusText","headers"].forEach(Re=>{J[Re]=I[Re]});const Y=v.toFiniteNumber(I.headers.get("content-length"));I=new Response(xs(I.body,Cs,c&&Es(Y,tn(c,!0)),X&&q,Wn),J)}d=d||"text";let le=await nn[v.findKey(nn,d)||"text"](I,t);return!X&&q(),b&&b(),await new Promise((J,Y)=>{To(J,Y,{data:le,headers:Ae.from(I.headers),status:I.status,statusText:I.statusText,config:t,request:D})})}catch(I){throw q(),I&&I.name==="TypeError"&&/fetch/i.test(I.message)?Object.assign(new V("Network Error",V.ERR_NETWORK,t,D),{cause:I.cause||I}):V.from(I,I&&I.code,t,D)}});const Hn={http:$i,xhr:Pr,fetch:Br};v.forEach(Hn,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const Ts=t=>`- ${t}`,Vr=t=>v.isFunction(t)||t===null||t===!1;var Ao={getAdapter:t=>{t=v.isArray(t)?t:[t];const{length:e}=t;let s,i;const n={};for(let o=0;o<e;o++){s=t[o];let a;if(i=s,!Vr(s)&&(i=Hn[(a=String(s)).toLowerCase()],i===void 0))throw new V(`Unknown adapter '${a}'`);if(i)break;n[a||"#"+o]=i}if(!i){const o=Object.entries(n).map(([c,h])=>`adapter ${c} `+(h===!1?"is not supported by the environment":"is not available in the build"));let a=e?o.length>1?`since :
`+o.map(Ts).join(`
`):" "+Ts(o[0]):"as no adapter specified";throw new V("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return i},adapters:Hn};function Sn(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new ft(null,t)}function Is(t){return Sn(t),t.headers=Ae.from(t.headers),t.data=kn.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Ao.getAdapter(t.adapter||is.adapter)(t).then(function(i){return Sn(t),i.data=kn.call(t,t.transformResponse,i),i.headers=Ae.from(i.headers),i},function(i){return Co(i)||(Sn(t),i&&i.response&&(i.response.data=kn.call(t,t.transformResponse,i.response),i.response.headers=Ae.from(i.response.headers))),Promise.reject(i)})}const Po="1.7.2",rs={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{rs[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}});const ks={};rs.transitional=function(e,s,i){function n(o,a){return"[Axios v"+Po+"] Transitional option '"+o+"'"+a+(i?". "+i:"")}return(o,a,c)=>{if(e===!1)throw new V(n(a," has been removed"+(s?" in "+s:"")),V.ERR_DEPRECATED);return s&&!ks[a]&&(ks[a]=!0,console.warn(n(a," has been deprecated since v"+s+" and will be removed in the near future"))),e?e(o,a,c):!0}};function Fr(t,e,s){if(typeof t!="object")throw new V("options must be an object",V.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let n=i.length;for(;n-- >0;){const o=i[n],a=e[o];if(a){const c=t[o],h=c===void 0||a(c,o,t);if(h!==!0)throw new V("option "+o+" must be "+h,V.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new V("Unknown option "+o,V.ERR_BAD_OPTION)}}var Xn={assertOptions:Fr,validators:rs};const Xe=Xn.validators;class sn{constructor(e){this.defaults=e,this.interceptors={request:new vs,response:new vs}}async request(e,s){try{return await this._request(e,s)}catch(i){if(i instanceof Error){let n;Error.captureStackTrace?Error.captureStackTrace(n={}):n=new Error;const o=n.stack?n.stack.replace(/^.+\n/,""):"";try{i.stack?o&&!String(i.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+o):i.stack=o}catch{}}throw i}}_request(e,s){typeof e=="string"?(s=s||{},s.url=e):s=e||{},s=nt(this.defaults,s);const{transitional:i,paramsSerializer:n,headers:o}=s;i!==void 0&&Xn.assertOptions(i,{silentJSONParsing:Xe.transitional(Xe.boolean),forcedJSONParsing:Xe.transitional(Xe.boolean),clarifyTimeoutError:Xe.transitional(Xe.boolean)},!1),n!=null&&(v.isFunction(n)?s.paramsSerializer={serialize:n}:Xn.assertOptions(n,{encode:Xe.function,serialize:Xe.function},!0)),s.method=(s.method||this.defaults.method||"get").toLowerCase();let a=o&&v.merge(o.common,o[s.method]);o&&v.forEach(["delete","get","head","post","put","patch","common"],b=>{delete o[b]}),s.headers=Ae.concat(a,o);const c=[];let h=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(s)===!1||(h=h&&x.synchronous,c.unshift(x.fulfilled,x.rejected))});const d=[];this.interceptors.response.forEach(function(x){d.push(x.fulfilled,x.rejected)});let l,p=0,_;if(!h){const b=[Is.bind(this),void 0];for(b.unshift.apply(b,c),b.push.apply(b,d),_=b.length,l=Promise.resolve(s);p<_;)l=l.then(b[p++],b[p++]);return l}_=c.length;let g=s;for(p=0;p<_;){const b=c[p++],x=c[p++];try{g=b(g)}catch(D){x.call(this,D);break}}try{l=Is.call(this,g)}catch(b){return Promise.reject(b)}for(p=0,_=d.length;p<_;)l=l.then(d[p++],d[p++]);return l}getUri(e){e=nt(this.defaults,e);const s=Io(e.baseURL,e.url);return wo(s,e.params,e.paramsSerializer)}}v.forEach(["delete","get","head","options"],function(e){sn.prototype[e]=function(s,i){return this.request(nt(i||{},{method:e,url:s,data:(i||{}).data}))}});v.forEach(["post","put","patch"],function(e){function s(i){return function(o,a,c){return this.request(nt(c||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:a}))}}sn.prototype[e]=s(),sn.prototype[e+"Form"]=s(!0)});var Jt=sn;class as{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(o){s=o});const i=this;this.promise.then(n=>{if(!i._listeners)return;let o=i._listeners.length;for(;o-- >0;)i._listeners[o](n);i._listeners=null}),this.promise.then=n=>{let o;const a=new Promise(c=>{i.subscribe(c),o=c}).then(n);return a.cancel=function(){i.unsubscribe(o)},a},e(function(o,a,c){i.reason||(i.reason=new ft(o,a,c),s(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const s=this._listeners.indexOf(e);s!==-1&&this._listeners.splice(s,1)}static source(){let e;return{token:new as(function(n){e=n}),cancel:e}}}var Ur=as;function Lr(t){return function(s){return t.apply(null,s)}}function Wr(t){return v.isObject(t)&&t.isAxiosError===!0}const zn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(zn).forEach(([t,e])=>{zn[e]=t});var Qr=zn;function Do(t){const e=new Jt(t),s=lo(Jt.prototype.request,e);return v.extend(s,Jt.prototype,e,{allOwnKeys:!0}),v.extend(s,e,null,{allOwnKeys:!0}),s.create=function(n){return Do(nt(t,n))},s}const ie=Do(is);ie.Axios=Jt;ie.CanceledError=ft;ie.CancelToken=Ur;ie.isCancel=Co;ie.VERSION=Po;ie.toFormData=gn;ie.AxiosError=V;ie.Cancel=ie.CanceledError;ie.all=function(e){return Promise.all(e)};ie.spread=Lr;ie.isAxiosError=Wr;ie.mergeConfig=nt;ie.AxiosHeaders=Ae;ie.formToJSON=t=>Eo(v.isHTMLForm(t)?new FormData(t):t);ie.getAdapter=Ao.getAdapter;ie.HttpStatusCode=Qr;ie.default=ie;var Ss=ie;const Hr={data(){const t=window.myEasyComptaAdmin.easyComptaTranslations;return{formData:{siret:"",company_name:"",siren_number:"",manager_name:"",address:"",city:"",postal_code:"",country:"",phone:"",mobile_phone:"",email:"",website:"",currency_id:"",note:"",user_create:""},fields:{company_name:{label:t.company_name,type:"text",required:!0},manager_name:{label:t.manager_name,type:"text"},address:{label:t.address,type:"text",required:!0},city:{label:t.city,type:"text",required:!0},postal_code:{label:t.postal_code,type:"text"},country:{label:t.country,type:"text"},phone:{label:t.phone,type:"tel",required:!0},mobile_phone:{label:t.mobile,type:"tel"},email:{label:t.email,type:"email",required:!0},website:{label:t.website,type:"url"},currency_id:{label:t.currency,type:"text",required:!0}},options:{currency_options:[],default_currency:"",addon_user_active:!1,addon_siret_active:!1},toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},loadingBtn:!1,loadingSiret:!1}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{submitForm(){this.loadingBtn=!0,Ss.post("/wp-json/my-easy-compta/v1/clients/add",this.formData,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>{t.data.success?(this.showToast(t.data.message,"alert-success"),this.loadingBtn=!1,this.resetForm(),this.closeModal(),this.$emit("clientAdded")):(this.showToast(t.data.message,"alert-error"),this.loadingBtn=!1)}).catch(t=>{const e=t.response&&t.response.data&&t.response.data.message?t.response.data.message:"Erreur serveur";console.error(t),this.showToast(e,"alert-error"),this.loadingBtn=!1})},closeModal(){document.getElementById("modal_clients").close()},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)},resetForm(){for(let t in this.formData)this.formData[t]=""},getOptions(t){return t==="currency_id"?this.options.currency_options:[]},fetchOptions(){Ss.get("/wp-json/my-easy-compta/v1/options",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>{this.options.currency_options=t.data.currency_options,this.options.default_currency=t.data.default_currency,this.options.addon_user_active=t.data.addon_user_active,this.options.addon_siret_active=t.data.addon_siret_active}).catch(t=>{console.error("Erreur lors de la r\xE9cup\xE9ration des options",t)})},fetchCompanyInfo(t){t.preventDefault(),this.loadingSiret=!0;const e=this.formData.siret;e?fetch(`/wp-json/my-easy-compta/v1/fetch-company-info/${e}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(s=>{if(!s.ok)throw new Error("Network response was not ok");return s.json()}).then(s=>{s?(this.formData.company_name=s.company_name,this.formData.manager_name=s.manager_name,this.formData.address=s.address,this.formData.postal_code=s.postal_code,this.formData.city=s.city,this.formData.siren_number=s.siren,this.showToast("Informations charg\xE9es avec succ\xE8s","alert-success"),this.loadingSiret=!1):(this.showToast("Aucune information trouv\xE9e pour ce SIRET","alert-error"),this.loadingSiret=!1)}).catch(s=>{console.error("Error fetching company info:",s),this.showToast("Erreur lors du chargement des informations","alert-error"),this.loadingSiret=!1}):(this.showToast("Veuillez saisir un num\xE9ro SIRET","alert-error"),this.loadingSiret=!1)}},mounted(){this.fetchOptions()}},Xr={id:"modal_clients",class:"modal"},zr={class:"modal-box"},Gr={class:"font-bold text-lg"},Jr={key:0,class:"grid grid-cols-1 gap-4"},Yr={class:"ecwp-group form-group relative join"},Kr={for:"siret",class:"ecwp-label form-label"},Zr=["disabled"],$r={key:0,class:"loading loading-spinner loading-sm"},ea={key:1},ta={class:"grid grid-cols-1 gap-4"},na={class:"ecwp-group form-group relative"},sa={for:"siren",class:"ecwp-label form-label"},oa={class:"grid grid-cols-1 gap-4"},ia={class:"ecwp-group form-group relative"},ra={for:"tax_number",class:"ecwp-label form-label"},aa={class:"grid grid-cols-2 gap-4"},la=["for"],ca=["id","onUpdate:modelValue","required"],da=["value"],ua=["value"],ha=["type","id","onUpdate:modelValue","required"],ma={class:"ecwp-group form-group mt-4 relative"},fa=["for"],pa={key:1,class:"ecwp-group form-group mt-6 w-52 flex justify-between"},_a={class:"form-group mt-4 flex justify-end"},ga=["disabled"],ya={key:0,class:"loading loading-spinner loading-sm"};function va(t,e,s,i,n,o){return m(),f("div",null,[n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),r("dialog",Xr,[r("div",zr,[r("h3",Gr,u(o.translations.new_client),1),r("form",{onSubmit:e[7]||(e[7]=te((...a)=>o.submitForm&&o.submitForm(...a),["prevent"]))},[r("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=a=>o.closeModal())}," \u2715 "),n.options.addon_siret_active?(m(),f("div",Jr,[r("div",Yr,[r("label",Kr,u(o.translations.siret),1),P(r("input",{type:"number",id:"siret","onUpdate:modelValue":e[1]||(e[1]=a=>n.formData.siret=a),class:"ecwp-input input input-bordered w-full"},null,512),[[H,n.formData.siret]]),r("button",{onClick:e[2]||(e[2]=(...a)=>o.fetchCompanyInfo&&o.fetchCompanyInfo(...a)),class:"btn join-item rounded-r-full mt-5",disabled:n.loadingSiret},[n.loadingSiret?(m(),f("span",$r)):(m(),f("span",ea,u(o.translations.search),1))],8,Zr)])])):y("",!0),r("div",ta,[r("div",na,[r("label",sa,u(o.translations.siren),1),P(r("input",{type:"number",id:"siren","onUpdate:modelValue":e[3]||(e[3]=a=>n.formData.siren_number=a),class:"ecwp-input input input-bordered w-full"},null,512),[[H,n.formData.siren_number]])])]),r("div",oa,[r("div",ia,[r("label",ra,u(o.translations.tax_number),1),P(r("input",{type:"text",id:"tax_number","onUpdate:modelValue":e[4]||(e[4]=a=>n.formData.tax_number=a),class:"ecwp-input input input-bordered w-full"},null,512),[[H,n.formData.tax_number]])])]),r("div",aa,[(m(!0),f(U,null,L(n.fields,(a,c)=>(m(),f("div",{key:c,class:"ecwp-group form-group relative"},[r("label",{for:c,class:"ecwp-label form-label"},u(a.label),9,la),c==="currency_id"?P((m(),f("select",{key:0,id:c,"onUpdate:modelValue":h=>n.formData[c]=h,class:"ecwp-input input input-bordered w-full peer",required:a.required},[r("option",{value:n.options.default_currency},u(o.translations.default_currency),9,da),(m(!0),f(U,null,L(o.getOptions(c),h=>(m(),f("option",{key:h.id,value:h.id},u(h.name)+" - "+u(h.code)+" ("+u(h.symbol)+") ",9,ua))),128))],8,ca)),[[ue,n.formData[c]]]):P((m(),f("input",{key:1,type:a.type,id:c,"onUpdate:modelValue":h=>n.formData[c]=h,class:"ecwp-input input input-bordered w-full peer",placeholder:" ",required:a.required},null,8,ha)),[[ai,n.formData[c]]])]))),128))]),r("div",ma,[r("label",{for:t.key,class:"ecwp-label form-label"},u(o.translations.note),9,fa),P(r("textarea",{id:"note","onUpdate:modelValue":e[5]||(e[5]=a=>n.formData.note=a),class:"ecwp-input textarea textarea-bordered w-full peer",rows:"4",placeholder:" "},null,512),[[H,n.formData.note]])]),n.options.addon_user_active?(m(),f("div",pa,[r("label",null,u(o.translations.create_user),1),P(r("input",{class:"ecwp-switch",type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=a=>n.formData.user_create=a)},null,512),[[ri,n.formData.user_create]])])):y("",!0),r("div",_a,[r("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[C(u(o.translations.add)+" ",1),n.loadingBtn?(m(),f("span",ya)):y("",!0)],8,ga)])],32)])])])}var Ro=re(Hr,[["render",va]]);/*!
  * vue-router v4.4.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const rt=typeof document!="undefined";function ba(t){return t.__esModule||t[Symbol.toStringTag]==="Module"}const G=Object.assign;function An(t,e){const s={};for(const i in e){const n=e[i];s[i]=Pe(n)?n.map(t):t(n)}return s}const Ct=()=>{},Pe=Array.isArray,jo=/#/g,wa=/&/g,xa=/\//g,Ea=/=/g,Ca=/\?/g,Oo=/\+/g,Ta=/%5B/g,Ia=/%5D/g,qo=/%5E/g,ka=/%60/g,Mo=/%7B/g,Sa=/%7C/g,No=/%7D/g,Aa=/%20/g;function ls(t){return encodeURI(""+t).replace(Sa,"|").replace(Ta,"[").replace(Ia,"]")}function Pa(t){return ls(t).replace(Mo,"{").replace(No,"}").replace(qo,"^")}function Gn(t){return ls(t).replace(Oo,"%2B").replace(Aa,"+").replace(jo,"%23").replace(wa,"%26").replace(ka,"`").replace(Mo,"{").replace(No,"}").replace(qo,"^")}function Da(t){return Gn(t).replace(Ea,"%3D")}function Ra(t){return ls(t).replace(jo,"%23").replace(Ca,"%3F")}function ja(t){return t==null?"":Ra(t).replace(xa,"%2F")}function jt(t){try{return decodeURIComponent(""+t)}catch{}return""+t}const Oa=/\/$/,qa=t=>t.replace(Oa,"");function Pn(t,e,s="/"){let i,n={},o="",a="";const c=e.indexOf("#");let h=e.indexOf("?");return c<h&&c>=0&&(h=-1),h>-1&&(i=e.slice(0,h),o=e.slice(h+1,c>-1?c:e.length),n=t(o)),c>-1&&(i=i||e.slice(0,c),a=e.slice(c,e.length)),i=Va(i!=null?i:e,s),{fullPath:i+(o&&"?")+o+a,path:i,query:n,hash:jt(a)}}function Ma(t,e){const s=e.query?t(e.query):"";return e.path+(s&&"?")+s+(e.hash||"")}function As(t,e){return!e||!t.toLowerCase().startsWith(e.toLowerCase())?t:t.slice(e.length)||"/"}function Na(t,e,s){const i=e.matched.length-1,n=s.matched.length-1;return i>-1&&i===n&&dt(e.matched[i],s.matched[n])&&Bo(e.params,s.params)&&t(e.query)===t(s.query)&&e.hash===s.hash}function dt(t,e){return(t.aliasOf||t)===(e.aliasOf||e)}function Bo(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const s in t)if(!Ba(t[s],e[s]))return!1;return!0}function Ba(t,e){return Pe(t)?Ps(t,e):Pe(e)?Ps(e,t):t===e}function Ps(t,e){return Pe(e)?t.length===e.length&&t.every((s,i)=>s===e[i]):t.length===1&&t[0]===e}function Va(t,e){if(t.startsWith("/"))return t;if(!t)return e;const s=e.split("/"),i=t.split("/"),n=i[i.length-1];(n===".."||n===".")&&i.push("");let o=s.length-1,a,c;for(a=0;a<i.length;a++)if(c=i[a],c!==".")if(c==="..")o>1&&o--;else break;return s.slice(0,o).join("/")+"/"+i.slice(a).join("/")}const ze={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Ot;(function(t){t.pop="pop",t.push="push"})(Ot||(Ot={}));var Tt;(function(t){t.back="back",t.forward="forward",t.unknown=""})(Tt||(Tt={}));function Fa(t){if(!t)if(rt){const e=document.querySelector("base");t=e&&e.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),qa(t)}const Ua=/^[^#]+#/;function La(t,e){return t.replace(Ua,"#")+e}function Wa(t,e){const s=document.documentElement.getBoundingClientRect(),i=t.getBoundingClientRect();return{behavior:e.behavior,left:i.left-s.left-(e.left||0),top:i.top-s.top-(e.top||0)}}const bn=()=>({left:window.scrollX,top:window.scrollY});function Qa(t){let e;if("el"in t){const s=t.el,i=typeof s=="string"&&s.startsWith("#"),n=typeof s=="string"?i?document.getElementById(s.slice(1)):document.querySelector(s):s;if(!n)return;e=Wa(n,t)}else e=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Ds(t,e){return(history.state?history.state.position-e:-1)+t}const Jn=new Map;function Ha(t,e){Jn.set(t,e)}function Xa(t){const e=Jn.get(t);return Jn.delete(t),e}let za=()=>location.protocol+"//"+location.host;function Vo(t,e){const{pathname:s,search:i,hash:n}=e,o=t.indexOf("#");if(o>-1){let c=n.includes(t.slice(o))?t.slice(o).length:1,h=n.slice(c);return h[0]!=="/"&&(h="/"+h),As(h,"")}return As(s,t)+i+n}function Ga(t,e,s,i){let n=[],o=[],a=null;const c=({state:_})=>{const g=Vo(t,location),b=s.value,x=e.value;let D=0;if(_){if(s.value=g,e.value=_,a&&a===b){a=null;return}D=x?_.position-x.position:0}else i(g);n.forEach(q=>{q(s.value,b,{delta:D,type:Ot.pop,direction:D?D>0?Tt.forward:Tt.back:Tt.unknown})})};function h(){a=s.value}function d(_){n.push(_);const g=()=>{const b=n.indexOf(_);b>-1&&n.splice(b,1)};return o.push(g),g}function l(){const{history:_}=window;!_.state||_.replaceState(G({},_.state,{scroll:bn()}),"")}function p(){for(const _ of o)_();o=[],window.removeEventListener("popstate",c),window.removeEventListener("beforeunload",l)}return window.addEventListener("popstate",c),window.addEventListener("beforeunload",l,{passive:!0}),{pauseListeners:h,listen:d,destroy:p}}function Rs(t,e,s,i=!1,n=!1){return{back:t,current:e,forward:s,replaced:i,position:window.history.length,scroll:n?bn():null}}function Ja(t){const{history:e,location:s}=window,i={value:Vo(t,s)},n={value:e.state};n.value||o(i.value,{back:null,current:i.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function o(h,d,l){const p=t.indexOf("#"),_=p>-1?(s.host&&document.querySelector("base")?t:t.slice(p))+h:za()+t+h;try{e[l?"replaceState":"pushState"](d,"",_),n.value=d}catch(g){console.error(g),s[l?"replace":"assign"](_)}}function a(h,d){const l=G({},e.state,Rs(n.value.back,h,n.value.forward,!0),d,{position:n.value.position});o(h,l,!0),i.value=h}function c(h,d){const l=G({},n.value,e.state,{forward:h,scroll:bn()});o(l.current,l,!0);const p=G({},Rs(i.value,h,null),{position:l.position+1},d);o(h,p,!1),i.value=h}return{location:i,state:n,push:c,replace:a}}function Ya(t){t=Fa(t);const e=Ja(t),s=Ga(t,e.state,e.location,e.replace);function i(o,a=!0){a||s.pauseListeners(),history.go(o)}const n=G({location:"",base:t,go:i,createHref:La.bind(null,t)},e,s);return Object.defineProperty(n,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(n,"state",{enumerable:!0,get:()=>e.state.value}),n}function Ka(t){return t=location.host?t||location.pathname+location.search:"",t.includes("#")||(t+="#"),Ya(t)}function Za(t){return typeof t=="string"||t&&typeof t=="object"}function Fo(t){return typeof t=="string"||typeof t=="symbol"}const Uo=Symbol("");var js;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(js||(js={}));function ut(t,e){return G(new Error,{type:t,[Uo]:!0},e)}function Fe(t,e){return t instanceof Error&&Uo in t&&(e==null||!!(t.type&e))}const Os="[^/]+?",$a={sensitive:!1,strict:!1,start:!0,end:!0},el=/[.+*?^${}()[\]/\\]/g;function tl(t,e){const s=G({},$a,e),i=[];let n=s.start?"^":"";const o=[];for(const d of t){const l=d.length?[]:[90];s.strict&&!d.length&&(n+="/");for(let p=0;p<d.length;p++){const _=d[p];let g=40+(s.sensitive?.25:0);if(_.type===0)p||(n+="/"),n+=_.value.replace(el,"\\$&"),g+=40;else if(_.type===1){const{value:b,repeatable:x,optional:D,regexp:q}=_;o.push({name:b,repeatable:x,optional:D});const A=q||Os;if(A!==Os){g+=10;try{new RegExp(`(${A})`)}catch(X){throw new Error(`Invalid custom RegExp for param "${b}" (${A}): `+X.message)}}let I=x?`((?:${A})(?:/(?:${A}))*)`:`(${A})`;p||(I=D&&d.length<2?`(?:/${I})`:"/"+I),D&&(I+="?"),n+=I,g+=20,D&&(g+=-8),x&&(g+=-20),A===".*"&&(g+=-50)}l.push(g)}i.push(l)}if(s.strict&&s.end){const d=i.length-1;i[d][i[d].length-1]+=.7000000000000001}s.strict||(n+="/?"),s.end?n+="$":s.strict&&(n+="(?:/|$)");const a=new RegExp(n,s.sensitive?"":"i");function c(d){const l=d.match(a),p={};if(!l)return null;for(let _=1;_<l.length;_++){const g=l[_]||"",b=o[_-1];p[b.name]=g&&b.repeatable?g.split("/"):g}return p}function h(d){let l="",p=!1;for(const _ of t){(!p||!l.endsWith("/"))&&(l+="/"),p=!1;for(const g of _)if(g.type===0)l+=g.value;else if(g.type===1){const{value:b,repeatable:x,optional:D}=g,q=b in d?d[b]:"";if(Pe(q)&&!x)throw new Error(`Provided param "${b}" is an array but it is not repeatable (* or + modifiers)`);const A=Pe(q)?q.join("/"):q;if(!A)if(D)_.length<2&&(l.endsWith("/")?l=l.slice(0,-1):p=!0);else throw new Error(`Missing required param "${b}"`);l+=A}}return l||"/"}return{re:a,score:i,keys:o,parse:c,stringify:h}}function nl(t,e){let s=0;for(;s<t.length&&s<e.length;){const i=e[s]-t[s];if(i)return i;s++}return t.length<e.length?t.length===1&&t[0]===40+40?-1:1:t.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function Lo(t,e){let s=0;const i=t.score,n=e.score;for(;s<i.length&&s<n.length;){const o=nl(i[s],n[s]);if(o)return o;s++}if(Math.abs(n.length-i.length)===1){if(qs(i))return 1;if(qs(n))return-1}return n.length-i.length}function qs(t){const e=t[t.length-1];return t.length>0&&e[e.length-1]<0}const sl={type:0,value:""},ol=/[a-zA-Z0-9_]/;function il(t){if(!t)return[[]];if(t==="/")return[[sl]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function e(g){throw new Error(`ERR (${s})/"${d}": ${g}`)}let s=0,i=s;const n=[];let o;function a(){o&&n.push(o),o=[]}let c=0,h,d="",l="";function p(){!d||(s===0?o.push({type:0,value:d}):s===1||s===2||s===3?(o.length>1&&(h==="*"||h==="+")&&e(`A repeatable param (${d}) must be alone in its segment. eg: '/:ids+.`),o.push({type:1,value:d,regexp:l,repeatable:h==="*"||h==="+",optional:h==="*"||h==="?"})):e("Invalid state to consume buffer"),d="")}function _(){d+=h}for(;c<t.length;){if(h=t[c++],h==="\\"&&s!==2){i=s,s=4;continue}switch(s){case 0:h==="/"?(d&&p(),a()):h===":"?(p(),s=1):_();break;case 4:_(),s=i;break;case 1:h==="("?s=2:ol.test(h)?_():(p(),s=0,h!=="*"&&h!=="?"&&h!=="+"&&c--);break;case 2:h===")"?l[l.length-1]=="\\"?l=l.slice(0,-1)+h:s=3:l+=h;break;case 3:p(),s=0,h!=="*"&&h!=="?"&&h!=="+"&&c--,l="";break;default:e("Unknown state");break}}return s===2&&e(`Unfinished custom RegExp for param "${d}"`),p(),a(),n}function rl(t,e,s){const i=tl(il(t.path),s),n=G(i,{record:t,parent:e,children:[],alias:[]});return e&&!n.record.aliasOf==!e.record.aliasOf&&e.children.push(n),n}function al(t,e){const s=[],i=new Map;e=Bs({strict:!1,end:!0,sensitive:!1},e);function n(p){return i.get(p)}function o(p,_,g){const b=!g,x=ll(p);x.aliasOf=g&&g.record;const D=Bs(e,p),q=[x];if("alias"in p){const X=typeof p.alias=="string"?[p.alias]:p.alias;for(const le of X)q.push(G({},x,{components:g?g.record.components:x.components,path:le,aliasOf:g?g.record:x}))}let A,I;for(const X of q){const{path:le}=X;if(_&&le[0]!=="/"){const J=_.record.path,Y=J[J.length-1]==="/"?"":"/";X.path=_.record.path+(le&&Y+le)}if(A=rl(X,_,D),g?g.alias.push(A):(I=I||A,I!==A&&I.alias.push(A),b&&p.name&&!Ns(A)&&a(p.name)),Wo(A)&&h(A),x.children){const J=x.children;for(let Y=0;Y<J.length;Y++)o(J[Y],A,g&&g.children[Y])}g=g||A}return I?()=>{a(I)}:Ct}function a(p){if(Fo(p)){const _=i.get(p);_&&(i.delete(p),s.splice(s.indexOf(_),1),_.children.forEach(a),_.alias.forEach(a))}else{const _=s.indexOf(p);_>-1&&(s.splice(_,1),p.record.name&&i.delete(p.record.name),p.children.forEach(a),p.alias.forEach(a))}}function c(){return s}function h(p){const _=ul(p,s);s.splice(_,0,p),p.record.name&&!Ns(p)&&i.set(p.record.name,p)}function d(p,_){let g,b={},x,D;if("name"in p&&p.name){if(g=i.get(p.name),!g)throw ut(1,{location:p});D=g.record.name,b=G(Ms(_.params,g.keys.filter(I=>!I.optional).concat(g.parent?g.parent.keys.filter(I=>I.optional):[]).map(I=>I.name)),p.params&&Ms(p.params,g.keys.map(I=>I.name))),x=g.stringify(b)}else if(p.path!=null)x=p.path,g=s.find(I=>I.re.test(x)),g&&(b=g.parse(x),D=g.record.name);else{if(g=_.name?i.get(_.name):s.find(I=>I.re.test(_.path)),!g)throw ut(1,{location:p,currentLocation:_});D=g.record.name,b=G({},_.params,p.params),x=g.stringify(b)}const q=[];let A=g;for(;A;)q.unshift(A.record),A=A.parent;return{name:D,path:x,params:b,matched:q,meta:dl(q)}}t.forEach(p=>o(p));function l(){s.length=0,i.clear()}return{addRoute:o,resolve:d,removeRoute:a,clearRoutes:l,getRoutes:c,getRecordMatcher:n}}function Ms(t,e){const s={};for(const i of e)i in t&&(s[i]=t[i]);return s}function ll(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:cl(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}}}function cl(t){const e={},s=t.props||!1;if("component"in t)e.default=s;else for(const i in t.components)e[i]=typeof s=="object"?s[i]:s;return e}function Ns(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function dl(t){return t.reduce((e,s)=>G(e,s.meta),{})}function Bs(t,e){const s={};for(const i in t)s[i]=i in e?e[i]:t[i];return s}function ul(t,e){let s=0,i=e.length;for(;s!==i;){const o=s+i>>1;Lo(t,e[o])<0?i=o:s=o+1}const n=hl(t);return n&&(i=e.lastIndexOf(n,i-1)),i}function hl(t){let e=t;for(;e=e.parent;)if(Wo(e)&&Lo(t,e)===0)return e}function Wo({record:t}){return!!(t.name||t.components&&Object.keys(t.components).length||t.redirect)}function ml(t){const e={};if(t===""||t==="?")return e;const i=(t[0]==="?"?t.slice(1):t).split("&");for(let n=0;n<i.length;++n){const o=i[n].replace(Oo," "),a=o.indexOf("="),c=jt(a<0?o:o.slice(0,a)),h=a<0?null:jt(o.slice(a+1));if(c in e){let d=e[c];Pe(d)||(d=e[c]=[d]),d.push(h)}else e[c]=h}return e}function Vs(t){let e="";for(let s in t){const i=t[s];if(s=Da(s),i==null){i!==void 0&&(e+=(e.length?"&":"")+s);continue}(Pe(i)?i.map(o=>o&&Gn(o)):[i&&Gn(i)]).forEach(o=>{o!==void 0&&(e+=(e.length?"&":"")+s,o!=null&&(e+="="+o))})}return e}function fl(t){const e={};for(const s in t){const i=t[s];i!==void 0&&(e[s]=Pe(i)?i.map(n=>n==null?null:""+n):i==null?i:""+i)}return e}const pl=Symbol(""),Fs=Symbol(""),cs=Symbol(""),Qo=Symbol(""),Yn=Symbol("");function vt(){let t=[];function e(i){return t.push(i),()=>{const n=t.indexOf(i);n>-1&&t.splice(n,1)}}function s(){t=[]}return{add:e,list:()=>t.slice(),reset:s}}function Ge(t,e,s,i,n,o=a=>a()){const a=i&&(i.enterCallbacks[n]=i.enterCallbacks[n]||[]);return()=>new Promise((c,h)=>{const d=_=>{_===!1?h(ut(4,{from:s,to:e})):_ instanceof Error?h(_):Za(_)?h(ut(2,{from:e,to:_})):(a&&i.enterCallbacks[n]===a&&typeof _=="function"&&a.push(_),c())},l=o(()=>t.call(i&&i.instances[n],e,s,d));let p=Promise.resolve(l);t.length<3&&(p=p.then(d)),p.catch(_=>h(_))})}function Dn(t,e,s,i,n=o=>o()){const o=[];for(const a of t)for(const c in a.components){let h=a.components[c];if(!(e!=="beforeRouteEnter"&&!a.instances[c]))if(_l(h)){const l=(h.__vccOpts||h)[e];l&&o.push(Ge(l,s,i,a,c,n))}else{let d=h();o.push(()=>d.then(l=>{if(!l)return Promise.reject(new Error(`Couldn't resolve component "${c}" at "${a.path}"`));const p=ba(l)?l.default:l;a.components[c]=p;const g=(p.__vccOpts||p)[e];return g&&Ge(g,s,i,a,c,n)()}))}}return o}function _l(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function Us(t){const e=Dt(cs),s=Dt(Qo),i=je(()=>{const h=Et(t.to);return e.resolve(h)}),n=je(()=>{const{matched:h}=i.value,{length:d}=h,l=h[d-1],p=s.matched;if(!l||!p.length)return-1;const _=p.findIndex(dt.bind(null,l));if(_>-1)return _;const g=Ls(h[d-2]);return d>1&&Ls(l)===g&&p[p.length-1].path!==g?p.findIndex(dt.bind(null,h[d-2])):_}),o=je(()=>n.value>-1&&bl(s.params,i.value.params)),a=je(()=>n.value>-1&&n.value===s.matched.length-1&&Bo(s.params,i.value.params));function c(h={}){return vl(h)?e[Et(t.replace)?"replace":"push"](Et(t.to)).catch(Ct):Promise.resolve()}return{route:i,href:je(()=>i.value.href),isActive:o,isExactActive:a,navigate:c}}const gl=eo({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Us,setup(t,{slots:e}){const s=ui(Us(t)),{options:i}=Dt(cs),n=je(()=>({[Ws(t.activeClass,i.linkActiveClass,"router-link-active")]:s.isActive,[Ws(t.exactActiveClass,i.linkExactActiveClass,"router-link-exact-active")]:s.isExactActive}));return()=>{const o=e.default&&e.default(s);return t.custom?o:to("a",{"aria-current":s.isExactActive?t.ariaCurrentValue:null,href:s.href,onClick:s.navigate,class:n.value},o)}}}),yl=gl;function vl(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return t.preventDefault&&t.preventDefault(),!0}}function bl(t,e){for(const s in e){const i=e[s],n=t[s];if(typeof i=="string"){if(i!==n)return!1}else if(!Pe(n)||n.length!==i.length||i.some((o,a)=>o!==n[a]))return!1}return!0}function Ls(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const Ws=(t,e,s)=>t!=null?t:e!=null?e:s,wl=eo({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:e,slots:s}){const i=Dt(Yn),n=je(()=>t.route||i.value),o=Dt(Fs,0),a=je(()=>{let d=Et(o);const{matched:l}=n.value;let p;for(;(p=l[d])&&!p.components;)d++;return d}),c=je(()=>n.value.matched[a.value]);Cn(Fs,je(()=>a.value+1)),Cn(pl,c),Cn(Yn,n);const h=hi();return mi(()=>[h.value,c.value,t.name],([d,l,p],[_,g,b])=>{l&&(l.instances[p]=d,g&&g!==l&&d&&d===_&&(l.leaveGuards.size||(l.leaveGuards=g.leaveGuards),l.updateGuards.size||(l.updateGuards=g.updateGuards))),d&&l&&(!g||!dt(l,g)||!_)&&(l.enterCallbacks[p]||[]).forEach(x=>x(d))},{flush:"post"}),()=>{const d=n.value,l=t.name,p=c.value,_=p&&p.components[l];if(!_)return Qs(s.default,{Component:_,route:d});const g=p.props[l],b=g?g===!0?d.params:typeof g=="function"?g(d):g:null,D=to(_,G({},b,e,{onVnodeUnmounted:q=>{q.component.isUnmounted&&(p.instances[l]=null)},ref:h}));return Qs(s.default,{Component:D,route:d})||D}}});function Qs(t,e){if(!t)return null;const s=t(e);return s.length===1?s[0]:s}const xl=wl;function El(t){const e=al(t.routes,t),s=t.parseQuery||ml,i=t.stringifyQuery||Vs,n=t.history,o=vt(),a=vt(),c=vt(),h=li(ze);let d=ze;rt&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const l=An.bind(null,w=>""+w),p=An.bind(null,ja),_=An.bind(null,jt);function g(w,k){let T,R;return Fo(w)?(T=e.getRecordMatcher(w),R=k):R=w,e.addRoute(R,T)}function b(w){const k=e.getRecordMatcher(w);k&&e.removeRoute(k)}function x(){return e.getRoutes().map(w=>w.record)}function D(w){return!!e.getRecordMatcher(w)}function q(w,k){if(k=G({},k||h.value),typeof w=="string"){const F=Pn(s,w,k.path),ae=e.resolve({path:F.path},k),gt=n.createHref(F.fullPath);return G(F,ae,{params:_(ae.params),hash:jt(F.hash),redirectedFrom:void 0,href:gt})}let T;if(w.path!=null)T=G({},w,{path:Pn(s,w.path,k.path).path});else{const F=G({},w.params);for(const ae in F)F[ae]==null&&delete F[ae];T=G({},w,{params:p(F)}),k.params=p(k.params)}const R=e.resolve(T,k),K=w.hash||"";R.params=l(_(R.params));const ne=Ma(i,G({},w,{hash:Pa(K),path:R.path})),W=n.createHref(ne);return G({fullPath:ne,hash:K,query:i===Vs?fl(w.query):w.query||{}},R,{redirectedFrom:void 0,href:W})}function A(w){return typeof w=="string"?Pn(s,w,h.value.path):G({},w)}function I(w,k){if(d!==w)return ut(8,{from:k,to:w})}function X(w){return Y(w)}function le(w){return X(G(A(w),{replace:!0}))}function J(w){const k=w.matched[w.matched.length-1];if(k&&k.redirect){const{redirect:T}=k;let R=typeof T=="function"?T(w):T;return typeof R=="string"&&(R=R.includes("?")||R.includes("#")?R=A(R):{path:R},R.params={}),G({query:w.query,hash:w.hash,params:R.path!=null?{}:w.params},R)}}function Y(w,k){const T=d=q(w),R=h.value,K=w.state,ne=w.force,W=w.replace===!0,F=J(T);if(F)return Y(G(A(F),{state:typeof F=="object"?G({},K,F.state):K,force:ne,replace:W}),k||T);const ae=T;ae.redirectedFrom=k;let gt;return!ne&&Na(i,R,T)&&(gt=ut(16,{to:ae,from:R}),pt(R,R,!0,!1)),(gt?Promise.resolve(gt):Qe(ae,R)).catch(_e=>Fe(_e)?Fe(_e,2)?_e:Ut(_e):Ve(_e,ae,R)).then(_e=>{if(_e){if(Fe(_e,2))return Y(G({replace:W},A(_e.to),{state:typeof _e.to=="object"?G({},K,_e.to.state):K,force:ne}),k||ae)}else _e=He(ae,R,!0,W,K);return Ce(ae,R,_e),_e})}function Re(w,k){const T=I(w,k);return T?Promise.reject(T):Promise.resolve()}function ce(w){const k=Lt.values().next().value;return k&&typeof k.runWithContext=="function"?k.runWithContext(w):w()}function Qe(w,k){let T;const[R,K,ne]=Cl(w,k);T=Dn(R.reverse(),"beforeRouteLeave",w,k);for(const F of R)F.leaveGuards.forEach(ae=>{T.push(Ge(ae,w,k))});const W=Re.bind(null,w,k);return T.push(W),st(T).then(()=>{T=[];for(const F of o.list())T.push(Ge(F,w,k));return T.push(W),st(T)}).then(()=>{T=Dn(K,"beforeRouteUpdate",w,k);for(const F of K)F.updateGuards.forEach(ae=>{T.push(Ge(ae,w,k))});return T.push(W),st(T)}).then(()=>{T=[];for(const F of ne)if(F.beforeEnter)if(Pe(F.beforeEnter))for(const ae of F.beforeEnter)T.push(Ge(ae,w,k));else T.push(Ge(F.beforeEnter,w,k));return T.push(W),st(T)}).then(()=>(w.matched.forEach(F=>F.enterCallbacks={}),T=Dn(ne,"beforeRouteEnter",w,k,ce),T.push(W),st(T))).then(()=>{T=[];for(const F of a.list())T.push(Ge(F,w,k));return T.push(W),st(T)}).catch(F=>Fe(F,8)?F:Promise.reject(F))}function Ce(w,k,T){c.list().forEach(R=>ce(()=>R(w,k,T)))}function He(w,k,T,R,K){const ne=I(w,k);if(ne)return ne;const W=k===ze,F=rt?history.state:{};T&&(R||W?n.replace(w.fullPath,G({scroll:W&&F&&F.scroll},K)):n.push(w.fullPath,K)),h.value=w,pt(w,k,T,W),Ut()}let fe;function Me(){fe||(fe=n.listen((w,k,T)=>{if(!fs.listening)return;const R=q(w),K=J(R);if(K){Y(G(K,{replace:!0}),R).catch(Ct);return}d=R;const ne=h.value;rt&&Ha(Ds(ne.fullPath,T.delta),bn()),Qe(R,ne).catch(W=>Fe(W,12)?W:Fe(W,2)?(Y(W.to,R).then(F=>{Fe(F,20)&&!T.delta&&T.type===Ot.pop&&n.go(-1,!1)}).catch(Ct),Promise.reject()):(T.delta&&n.go(-T.delta,!1),Ve(W,R,ne))).then(W=>{W=W||He(R,ne,!1),W&&(T.delta&&!Fe(W,8)?n.go(-T.delta,!1):T.type===Ot.pop&&Fe(W,20)&&n.go(-1,!1)),Ce(R,ne,W)}).catch(Ct)}))}let Ne=vt(),Te=vt(),Be;function Ve(w,k,T){Ut(w);const R=Te.list();return R.length?R.forEach(K=>K(w,k,T)):console.error(w),Promise.reject(w)}function xn(){return Be&&h.value!==ze?Promise.resolve():new Promise((w,k)=>{Ne.add([w,k])})}function Ut(w){return Be||(Be=!w,Me(),Ne.list().forEach(([k,T])=>w?T(w):k()),Ne.reset()),w}function pt(w,k,T,R){const{scrollBehavior:K}=t;if(!rt||!K)return Promise.resolve();const ne=!T&&Xa(Ds(w.fullPath,0))||(R||!T)&&history.state&&history.state.scroll||null;return di().then(()=>K(w,k,ne)).then(W=>W&&Qa(W)).catch(W=>Ve(W,w,k))}const _t=w=>n.go(w);let En;const Lt=new Set,fs={currentRoute:h,listening:!0,addRoute:g,removeRoute:b,clearRoutes:e.clearRoutes,hasRoute:D,getRoutes:x,resolve:q,options:t,push:X,replace:le,go:_t,back:()=>_t(-1),forward:()=>_t(1),beforeEach:o.add,beforeResolve:a.add,afterEach:c.add,onError:Te.add,isReady:xn,install(w){const k=this;w.component("RouterLink",yl),w.component("RouterView",xl),w.config.globalProperties.$router=k,Object.defineProperty(w.config.globalProperties,"$route",{enumerable:!0,get:()=>Et(h)}),rt&&!En&&h.value===ze&&(En=!0,X(n.location).catch(K=>{}));const T={};for(const K in ze)Object.defineProperty(T,K,{get:()=>h.value[K],enumerable:!0});w.provide(cs,k),w.provide(Qo,ci(T)),w.provide(Yn,h);const R=w.unmount;Lt.add(w),w.unmount=function(){Lt.delete(w),Lt.size<1&&(d=ze,fe&&fe(),fe=null,h.value=ze,En=!1,Be=!1),R()}}};function st(w){return w.reduce((k,T)=>k.then(()=>ce(T)),Promise.resolve())}return fs}function Cl(t,e){const s=[],i=[],n=[],o=Math.max(e.matched.length,t.matched.length);for(let a=0;a<o;a++){const c=e.matched[a];c&&(t.matched.find(d=>dt(d,c))?i.push(c):s.push(c));const h=t.matched[a];h&&(e.matched.find(d=>dt(d,h))||n.push(h))}return[s,i,n]}const Tl={name:"QuoteEdit",components:{Card:Ze,ModelSelect:hn,VueDatePicker:Mt},data(){return{quote:{quote_number:"",due_date:"",provisional_start_date:"",client_id:"",client:null,status:""},showError:!1,loading:!1,loadingBtn:!1,clients:[],clientOptions:[],settings:[],toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},formattedDate(){return t=>{if(!t)return"";const e=t.getDate().toString().padStart(2,"0"),s=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getFullYear();return`${e}-${s}-${i}`}}},mounted(){this.fetchClients(),this.fetchSettings(),this.fetchQuoteDetails()},methods:{cancelAction(){this.$router.push("/quotes")},fetchClients(){this.loading=!0,fetch("/wp-json/my-easy-compta/v1/list-clients",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.clients=t.clients,this.clientOptions=this.clients.map(e=>({value:e.id,text:`${e.company_name} - ${e.email} (${e.currency_symbol})`})),this.quote.client_id&&this.setClientById(this.quote.client_id)}).catch(t=>{console.error("Error fetching clients:",t)}).finally(()=>{this.loading=!1})},async fetchSettings(){try{this.loading=!0;const t=await fetch("/wp-json/my-easy-compta/v1/settings/get",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}});if(this.loading=!1,t.ok){const e=await t.json();this.settings=e}else{const e=await t.json();console.error("Error fetching settings:",e)}}catch(t){this.loading=!1,console.error("Error fetching settings:",t)}},fetchQuoteDetails(){const t=this.$route.params.id;!t||(this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>e.json()).then(e=>{e?(this.quote=e,this.setClientById(this.quote.client_id)):(console.error("Error fetching quote details:",e.message),this.showToast(e.message,"alert-error"))}).catch(e=>{console.error("Error fetching quote details:",e),this.showToast(e,"alert-error")}).finally(()=>{this.loading=!1}))},setClientById(t){this.quote.client=this.clients.find(e=>e.id===t)||null,this.quote.client_id=t},submitQuote(){if(!this.quote.due_date||!this.quote.provisional_start_date||!this.quote.client_id||!this.quote.status){this.showError=!0,this.showToast("Veuillez remplir tous les champs obligatoires.","alert-error");return}this.loadingBtn=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/${this.$route.params.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.quote)}).then(t=>{if(!t.ok)throw this.loadingBtn=!1,new Error("Network response was not ok");return t.json()}).then(t=>{t.success?(this.loadingBtn=!1,this.showToast(t.message,"alert-success"),this.$router.push({name:"QuoteViewDetail",params:{id:t.id}})):(console.error("Error submitting quote:",t.message),this.showToast(t.message,"alert-error"),this.loadingBtn=!1)}).catch(t=>{console.error("Error submitting quote:",t),this.showToast(t,"alert-error"),this.loadingBtn=!1})},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},Il={class:"pt-2 pr-4"},kl={class:"flex justify-between items-center mb-4"},Sl={class:"card-title"},Al=r("div",{class:"divider mt-2"},null,-1),Pl={key:0,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},Dl={class:"grid grid-cols-3 gap-4"},Rl={class:"ecwp-group form-group mb-4"},jl={for:"quoteNumber",class:"ecwp-label"},Ol={class:"ecwp-group form-group mb-4"},ql={for:"quoteDate",class:"ecwp-label"},Ml={class:"ecwp-group form-group mb-4"},Nl={for:"quoteProvisanalDate",class:"ecwp-label"},Bl={class:"grid grid-cols-2 gap-4"},Vl={class:"ecwp-group form-group mb-4"},Fl={for:"client",class:"ecwp-label"},Ul={class:"ecwp-group form-group mb-4"},Ll={for:"status",class:"ecwp-label"},Wl={value:"draft"},Ql={value:"pending"},Hl={value:"approved"},Xl={value:"rejected"},zl={class:"flex justify-between"},Gl=["disabled"],Jl={key:0,class:"loading loading-spinner loading-sm"};function Yl(t,e,s,i,n,o){const a=N("VueDatePicker"),c=N("model-select"),h=N("Card");return m(),f("div",Il,[n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),j(h,{topMargin:"mt-8",modalType:"modal_quote_new"},{default:me(()=>[r("div",kl,[r("h2",Sl,u(o.translations.edit_quote),1)]),Al,n.loading?(m(),f("div",Pl)):y("",!0),r("form",{onSubmit:e[6]||(e[6]=te((...d)=>o.submitQuote&&o.submitQuote(...d),["prevent"]))},[r("div",Dl,[r("div",Rl,[r("label",jl,u(o.translations.quote_number),1),P(r("input",{type:"text",id:"quoteNumber","onUpdate:modelValue":e[0]||(e[0]=d=>n.quote.quote_number=d),class:"ecwp-input input input-bordered w-full",disabled:"true"},null,512),[[H,n.quote.quote_number]])]),r("div",Ol,[r("label",ql,u(o.translations.due_date),1),j(a,{class:S(["ecwp-input ecwp-date input input-bordered w-full",[!n.quote.due_date&&n.showError?"input-error":""]]),id:"quoteDate",modelValue:n.quote.due_date,"onUpdate:modelValue":e[1]||(e[1]=d=>n.quote.due_date=d),"enable-time-picker":!1,"auto-apply":"",format:o.formattedDate,"min-date":new Date},null,8,["class","modelValue","format","min-date"])]),r("div",Ml,[r("label",Nl,u(o.translations.provisional_date),1),j(a,{class:S(["ecwp-input ecwp-date input input-bordered w-full",[!n.quote.provisional_start_date&&n.showError?"input-error":""]]),id:"quoteProvisanalDate",modelValue:n.quote.provisional_start_date,"onUpdate:modelValue":e[2]||(e[2]=d=>n.quote.provisional_start_date=d),"enable-time-picker":!1,"auto-apply":"",format:o.formattedDate,"min-date":new Date},null,8,["class","modelValue","format","min-date"])])]),r("div",Bl,[r("div",Vl,[r("label",Fl,u(o.translations.company_name),1),j(c,{modelValue:n.quote.client_id,"onUpdate:modelValue":e[3]||(e[3]=d=>n.quote.client_id=d),options:n.clientOptions,label:"text","track-by":"value",placeholder:o.translations.select,class:S(["ecwp-input input input-bordered w-full",[!n.quote.client_id&&n.showError?"input-error":""]])},null,8,["modelValue","options","placeholder","class"])]),r("div",Ul,[r("label",Ll,u(o.translations.status),1),P(r("select",{id:"status","onUpdate:modelValue":e[4]||(e[4]=d=>n.quote.status=d),required:"",class:S(["ecwp-input select select-bordered w-full",[!n.quote.status&&n.showError?"input-error":""]])},[r("option",Wl,u(o.translations.draft),1),r("option",Ql,u(o.translations.pending),1),r("option",Hl,u(o.translations.approved),1),r("option",Xl,u(o.translations.rejected),1)],2),[[ue,n.quote.status]])])]),r("div",zl,[r("button",{type:"button",class:"btn btn-secondary rounded-full",onClick:e[5]||(e[5]=(...d)=>o.cancelAction&&o.cancelAction(...d))},u(o.translations.cancel),1),r("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[C(u(o.translations.save)+" ",1),n.loadingBtn?(m(),f("span",Jl)):y("",!0)],8,Gl)])],32)]),_:1})])}var Ho=re(Tl,[["render",Yl]]);const Kl={props:{isVisible:{type:Boolean,default:!1},title:{type:String,default:"Confirmation"},message:{type:String,default:"Are you sure?"},confirmText:{type:String,default:"Confirm"},cancelText:{type:String,default:"Cancel"},status:{type:String}},data(){return{selectedPaymentMethod:""}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{onConfirm(){this.$emit("confirm"),this.closeModal()},onCancel(){this.$emit("cancel"),this.closeModal()},closeModal(){document.getElementById("modal_confirm").close()}}},Zl=["open"],$l={class:"modal-box"},ec={class:"font-bold text-lg"},tc=r("div",{class:"text-center text-red-400 mb-2"},[r("i",{class:"fas fa-exclamation-triangle text-4xl"})],-1),nc={class:"text-lg font-semibold text-center"},sc={class:"my-4 text-center text-xl"},oc={class:"flex justify-between space-x-4"};function ic(t,e,s,i,n,o){return m(),f("div",null,[r("dialog",{id:"modal_confirm",class:"modal",open:t.showModal},[r("div",$l,[r("h3",ec,u(t.modalTitle),1),r("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=(...a)=>o.closeModal&&o.closeModal(...a))}," \u2715 "),tc,r("h2",nc,u(s.title),1),r("p",sc,u(s.message),1),r("div",oc,[r("button",{onClick:e[1]||(e[1]=(...a)=>o.onCancel&&o.onCancel(...a)),class:"btn btn-secondary rounded-full"},u(s.cancelText),1),r("button",{onClick:e[2]||(e[2]=(...a)=>o.onConfirm&&o.onConfirm(...a)),class:"btn rounded-full btn-error text-white"},u(s.confirmText),1)])])],8,Zl)])}var ds=re(Kl,[["render",ic]]);const rc={name:"QuotesList",components:{Card:Ze,QuoteEditModal:Ho,ConfirmModal:ds,RemoveModal:qt},data(){return{quotes:[],filteredQuotes:[],filters:{quote_number:"",client:"",status:"",total_amount:"",due_date:"",created_at:""},showQuoteDetailsModal:!1,editQuoteModal:!1,selectedQuote:null,currentPage:1,totalCount:0,totalPages:1,paginationButtons:[],loading:!0,loadingPrice:!0,loadingModal:!1,skeletonRows:5,perPage:10,perPageOptions:[5,10,20,50],clients:[],client_currency:"",default_vat:"",default_currency:"",default_currency_symbol:"",settings:{},toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},created(){this.fetchQuotesWithFilters(),this.loadSettings(),this.fetchClients()},methods:{fetchQuotes(t=1){this.loading=!0;const{perPage:e}=this;fetch(`/wp-json/my-easy-compta/v1/quotes?page=${t}&per_page=${e}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(s=>s.json()).then(s=>{this.quotes=s.quotes,this.totalCount=s.total_count,this.totalPages=s.total_pages,this.currentPage=t,this.perPage=e,this.generatePaginationButtons()}).catch(s=>{console.error("Error fetching quotes:",s)}).finally(()=>{this.loading=!1})},fetchQuotesWithFilters(t=1){this.loading=!0;const{perPage:e,filters:s}=this,i=new URLSearchParams({page:t,per_page:e,...s}).toString();fetch(`/wp-json/my-easy-compta/v1/quotes?${i}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(n=>n.json()).then(n=>{this.quotes=n.quotes,this.totalCount=n.total_count,this.totalPages=n.total_pages,this.currentPage=t,this.perPage=e,this.generatePaginationButtons()}).catch(n=>{console.error("Error fetching quotes with filters:",n)}).finally(()=>{this.loading=!1})},fetchClients(){fetch("/wp-json/my-easy-compta/v1/clients",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.clients=t.clients}).catch(t=>{console.error("Error fetching clients:",t)})},async loadSettings(){try{this.loadingPrice=!0;const{settings:t,currencySymbol:e,vatData:s}=await mn();this.settings=t,this.default_currency_symbol=e,this.default_vat=s,this.loadingPrice=!1}catch(t){this.showToast(t.message,"alert-error"),this.loadingPrice=!1}},calculateVAT(t){return so(t,this.default_vat.rate)},calculateWithoutVAT(t){return oo(t)},generatePaginationButtons(){this.paginationButtons=io(this.currentPage,this.totalPages)},goToPage(t){t!=="..."&&this.fetchQuotesWithFilters(t)},perPageChanged(){this.fetchQuotesWithFilters()},formatAmount(t,e){return ro(t,e,this.settings.currency_position)},confirmDuplicateQuote(t){this.selectedQuote=t,modal_confirm.showModal(),this.showRemoveModal=!0},duplicateQuote(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/duplicate/${t}`,{method:"POST",headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{e.success?(this.fetchQuotesWithFilters(),this.showToast(e.message,"alert-success")):(this.showToast(e.message,"alert-error"),console.error("Error duplicate quote:",e.statusText))}).catch(e=>{console.log(e.message),this.showToast(e.message,"alert-error")})},confirmDeleteQuote(t){this.selectedQuote=t,modal_remove.showModal(),this.showRemoveModal=!0},deleteQuote(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/delete/${t}`,{method:"DELETE",headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{e.success?(this.fetchQuotesWithFilters(),this.showToast(e.message,"alert-success")):(this.showToast(e.message,"alert-error"),console.error("Error deleting quote:",e.statusText))}).catch(e=>{console.log(e.message),this.showToast(e.message,"alert-error")})},showToast(t,e){ao(this.toast,t,e)}},computed:{skeletonItems(){return Array.from({length:5},(t,e)=>e)},totalPages(){return Math.ceil(this.totalCount/this.perPage)},translations(){return window.myEasyComptaAdmin.easyComptaTranslations}}},ac={class:"pt-2 pr-4"},lc={class:"flex justify-between items-center"},cc={class:"card-title"},dc={class:"btn btn-primary rounded-full"},uc=r("i",{class:"fas fa-plus-circle"},null,-1),hc={key:0,class:"ms-2"},mc={class:"btn btn-outline btn-accent rounded-full hover:text-white",href:"/wp-admin/admin.php?page=my-easy-compta-export#tab2"},fc=r("i",{class:"fas fa-file-export"},null,-1),pc=["data-tip"],_c={class:"btn btn-outline btn-accent rounded-full",disabled:""},gc=r("i",{class:"fas fa-file-export"},null,-1),yc=r("div",{class:"divider mt-2"},null,-1),vc={class:"flex items-center mb-4"},bc={for:"perPageSelect",class:"mr-2"},wc=["value"],xc={class:"overflow-x-auto"},Ec={class:"table w-full"},Cc={value:""},Tc=["value"],Ic={value:""},kc={value:"draft"},Sc={value:"pending"},Ac={value:"approved"},Pc={value:"rejected"},Dc={class:"flex justify-center"},Rc={key:0},jc={key:0,class:"badge badge-warning badge-outline badge-sm"},Oc={key:1,class:"badge badge-secondary badge-outline badge-sm"},qc={key:2,class:"badge badge-success badge-outline badge-sm"},Mc={key:3,class:"badge badge-error badge-outline badge-sm"},Nc={key:0},Bc={key:0},Vc={key:0},Fc={key:1},Uc={key:1},Lc={key:0},Wc={key:1},Qc={key:1},Hc=r("span",{class:"loading loading-bars loading-sm"},null,-1),Xc=[Hc],zc={key:0},Gc={key:1},Jc=r("span",{class:"loading loading-bars loading-sm"},null,-1),Yc=[Jc],Kc={key:0},Zc={key:1},$c=r("span",{class:"loading loading-bars loading-sm"},null,-1),ed=[$c],td={class:"flex justify-end"},nd=["data-tip"],sd=r("button",{class:"btn btn-circle mx-1"},[r("i",{class:"far fa-eye"})],-1),od=["data-tip"],id=r("button",{class:"btn btn-circle mx-1"},[r("i",{class:"fas fa-pencil-alt"})],-1),rd=["data-tip"],ad=["onClick"],ld=r("i",{class:"far fa-copy"},null,-1),cd=[ld],dd=["data-tip"],ud=["onClick"],hd=r("i",{class:"far fa-trash-alt"},null,-1),md=[hd],fd={key:0},pd=r("div",{class:"flex gap-4 items-center"},[r("div",{class:"skeleton w-16 h-16 rounded-full shrink-0"}),r("div",{class:"flex flex-col gap-4 w-full"},[r("div",{class:"skeleton h-4 w-full"}),r("div",{class:"skeleton h-4 w-full"})])],-1),_d=r("div",{class:"divider my-1"},null,-1),gd=[pd,_d],yd={class:"join ecwp_pagination mt-6 pt-4"},vd=["onClick"];function bd(t,e,s,i,n,o){const a=N("confirm-modal"),c=N("remove-modal"),h=N("router-link"),d=N("Card");return m(),f("div",ac,[n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),j(a,{"show-modal":t.showConfirmModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_confirm_it,cancelText:o.translations.cancel,onConfirm:e[0]||(e[0]=l=>this.duplicateQuote(n.selectedQuote)),onCancel:e[1]||(e[1]=l=>t.showConfirmModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),j(c,{"show-modal":t.showRemoveModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_delete_it,cancelText:o.translations.cancel,onConfirm:e[2]||(e[2]=l=>this.deleteQuote(n.selectedQuote)),onCancel:e[3]||(e[3]=l=>t.showRemoveModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),j(d,{topMargin:"mt-8"},{default:me(()=>[r("div",lc,[r("h2",cc,u(o.translations.quotes),1),r("div",null,[j(h,{to:{name:"QuoteNew"}},{default:me(()=>[r("button",dc,[C(u(o.translations.add)+" ",1),uc])]),_:1}),n.settings.easy_compta_export_addon_active==1?(m(),f("span",hc,[r("a",mc,[C(u(o.translations.export)+" ",1),fc])])):(m(),f("span",{key:1,class:"tooltip tooltip-left tooltip-warning ms-2","data-tip":o.translations.active_export_addon},[r("button",_c,[C(u(o.translations.export)+" ",1),gc])],8,pc))])]),yc,r("div",vc,[r("label",bc,u(o.translations.display_per_page),1),P(r("select",{id:"perPageSelect","onUpdate:modelValue":e[4]||(e[4]=l=>n.perPage=l),onChange:e[5]||(e[5]=(...l)=>o.perPageChanged&&o.perPageChanged(...l))},[(m(!0),f(U,null,L(n.perPageOptions,l=>(m(),f("option",{key:l,value:l},u(l),9,wc))),128))],544),[[ue,n.perPage]])]),r("div",xc,[r("table",Ec,[r("thead",null,[r("tr",null,[r("th",null,[r("div",null,u(o.translations.quote_number),1),P(r("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>n.filters.quote_number=l),onInput:e[7]||(e[7]=l=>o.fetchQuotesWithFilters()),type:"text",class:"ecwp-input input-xs input-bordered mt-2"},null,544),[[H,n.filters.quote_number]])]),r("th",null,[r("div",null,u(o.translations.client),1),P(r("select",{"onUpdate:modelValue":e[8]||(e[8]=l=>n.filters.client=l),onChange:e[9]||(e[9]=l=>o.fetchQuotesWithFilters()),class:"ecwp-input input-xs input-bordered mt-2"},[r("option",Cc,u(o.translations.all),1),(m(!0),f(U,null,L(n.clients,l=>(m(),f("option",{key:l.id,value:l.company_name},u(l.company_name),9,Tc))),128))],544),[[ue,n.filters.client]])]),r("th",null,[r("div",null,u(o.translations.status),1),P(r("select",{"onUpdate:modelValue":e[10]||(e[10]=l=>n.filters.status=l),onChange:e[11]||(e[11]=l=>o.fetchQuotesWithFilters()),class:"ecwp-input input-xs input-bordered mt-2"},[r("option",Ic,u(o.translations.all_statuses),1),r("option",kc,u(o.translations.draft),1),r("option",Sc,u(o.translations.pending),1),r("option",Ac,u(o.translations.approved),1),r("option",Pc,u(o.translations.rejected),1)],544),[[ue,n.filters.status]])]),r("th",null,[r("div",null,u(o.translations.total),1),P(r("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>n.filters.total_amount=l),onInput:e[13]||(e[13]=l=>o.fetchQuotesWithFilters()),type:"text",class:"ecwp-input input-xs input-bordered mt-2"},null,544),[[H,n.filters.total_amount]])]),r("th",null,[r("div",null,u(o.translations.due_date),1),P(r("input",{"onUpdate:modelValue":e[14]||(e[14]=l=>n.filters.due_date=l),onInput:e[15]||(e[15]=l=>o.fetchQuotesWithFilters()),type:"date",class:"ecwp-input input-xs input-bordered mt-2"},null,544),[[H,n.filters.due_date]])]),r("th",null,[r("div",null,u(o.translations.created_at),1),P(r("input",{"onUpdate:modelValue":e[16]||(e[16]=l=>n.filters.created_at=l),onInput:e[17]||(e[17]=l=>o.fetchQuotesWithFilters()),type:"date",class:"ecwp-input input-xs input-bordered mt-2"},null,544),[[H,n.filters.created_at]])]),r("th",Dc,u(o.translations.actions),1)])]),n.loading?y("",!0):(m(),f("tbody",Rc,[(m(!0),f(U,null,L(n.quotes,l=>(m(),f("tr",{key:l.id},[r("td",null,u(l.quote_number),1),r("td",null,u(l.client_name),1),r("td",null,[l.status=="draft"?(m(),f("span",jc,u(o.translations.draft),1)):y("",!0),l.status=="pending"?(m(),f("span",Oc,u(o.translations.pending),1)):y("",!0),l.status=="approved"?(m(),f("span",qc,u(o.translations.approved),1)):y("",!0),l.status=="rejected"?(m(),f("span",Mc,u(o.translations.rejected),1)):y("",!0)]),r("td",null,[n.loadingPrice?(m(),f("div",Qc,Xc)):(m(),f("div",Nc,[n.settings.vat_active==1?(m(),f("div",Bc,[n.default_currency_symbol==l.client_currency||l.client_currency==null?(m(),f("span",Vc,u(o.formatAmount(l.total_amount,n.default_currency_symbol)),1)):(m(),f("span",Fc,u(o.formatAmount(l.total_amount,l.client_currency)),1))])):(m(),f("div",Uc,[n.default_currency_symbol==l.client_currency||l.client_currency==null?(m(),f("span",Lc,u(o.formatAmount(l.total_amount,n.default_currency_symbol)),1)):(m(),f("span",Wc,u(o.formatAmount(l.total_amount,l.client_currency)),1))]))]))]),r("td",null,[n.loadingPrice?(m(),f("div",Gc,Yc)):(m(),f("div",zc,u(l.due_date),1))]),r("td",null,[n.loadingPrice?(m(),f("div",Zc,ed)):(m(),f("div",Kc,u(l.created),1))]),r("td",td,[r("span",{class:"lg:tooltip","data-tip":o.translations.view},[j(h,{to:{name:"QuoteViewDetail",params:{id:l.id}}},{default:me(()=>[sd]),_:2},1032,["to"])],8,nd),r("span",{class:"lg:tooltip","data-tip":o.translations.edit},[j(h,{to:{name:"QuoteEdit",params:{id:l.id}}},{default:me(()=>[id]),_:2},1032,["to"])],8,od),r("span",{class:"lg:tooltip","data-tip":o.translations.duplicate},[r("button",{onClick:p=>o.confirmDuplicateQuote(l.id),class:"btn btn-circle text-purple-600 hover:text-purple-900 mx-1"},cd,8,ad)],8,rd),r("span",{class:"lg:tooltip","data-tip":o.translations.delete},[r("button",{onClick:p=>o.confirmDeleteQuote(l.id),class:"btn btn-circle text-red-500 hover:text-red-700 mx-1"},md,8,ud)],8,dd)])]))),128))]))]),n.loading?(m(),f("div",fd,[(m(!0),f(U,null,L(n.skeletonRows,l=>(m(),f("div",{key:l,class:"flex flex-col gap-4 w-full"},gd))),128))])):y("",!0)]),r("div",yd,[(m(!0),f(U,null,L(n.paginationButtons,l=>(m(),f("button",{key:l,class:S(["join-item btn",{"btn-disabled":l==="..."||l===n.currentPage}]),onClick:p=>o.goToPage(l)},u(l),11,vd))),128))])]),_:1})])}var wd=re(rc,[["render",bd]]);const xd={name:"sendQuote",components:{VueEditor:Nt.exports.VueEditor},props:{showModal:Boolean,modalId:String,client:Object,quoteId:Number,loading:Boolean,subject:String,content:String},data(){const t=window.myEasyComptaAdmin.easyComptaTranslations;return{loading:!1,loadingBtn:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},toolbarOptions:[["bold","italic","underline","strike"],["link"],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{align:[]}],[{align:"right"},{align:"center"},{align:"justify"}],["clean"]],fields:{client_email:{label:t.client,value:"",disabled:!0},email_subject:{label:t.email_subject,value:""},email_message:{label:t.email_content,value:"",type:"textarea"}}}},watch:{client:{immediate:!0,handler(t){this.fields.client_email.value=(t==null?void 0:t.email)||""}},subject:{immediate:!0,handler(t){this.fields.email_subject.value=t||""}},content:{immediate:!0,handler(t){this.fields.email_message.value=t||""}}},computed:{skeletonItems(){return Array.from({length:10},(t,e)=>e)},translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{closeModal(){document.getElementById(this.modalId).close()},async submitForm(){this.loadingBtn=!0;try{const t=await fetch("/wp-json/my-easy-compta/v1/emails/send-email",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({type:"quote",id:this.quoteId,client_email:this.client.email,email_subject:this.fields.email_subject.value,email_message:this.fields.email_message.value})});if(t.ok){const e=await t.json();this.loadingBtn=!1,this.closeModal(),this.showToast(e.message,"alert-success")}else{const e=`Error sending email: ${t.statusText}`;this.showToast(e,"alert-error"),console.error(e),this.loadingBtn=!1}}catch(t){const e=t.response&&t.response.data&&t.response.data.message?t.response.data.message:"Error sending email";this.showToast(e,"alert-error"),console.error("Error sending email:",t),this.loadingBtn=!1}},updateFieldValue(t,e){this.fields[t].value=e},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},Ed=["id","open"],Cd={class:"modal-box"},Td={class:"font-bold text-lg"},Id={key:0},kd={class:"grid grid-cols-1 gap-4"},Sd=r("div",{class:"skeleton h-4 w-full mb-2"},null,-1),Ad=r("div",{class:"skeleton h-4 w-full"},null,-1),Pd=[Sd,Ad],Dd={class:"grid grid-cols-1 gap-4"},Rd=["type"],jd=["for"],Od=["id","value","disabled","onInput"],qd={key:1},Md=["for"],Nd={class:"form-group mt-4 flex justify-end"},Bd=["disabled"],Vd={key:0,class:"loading loading-spinner loading-sm"};function Fd(t,e,s,i,n,o){const a=N("vue-editor");return m(),f("div",null,[n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),r("dialog",{id:s.modalId,class:"modal",open:s.showModal},[r("div",Cd,[r("h3",Td,u(o.translations.send_quote),1),r("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=c=>o.closeModal())}," \u2715 "),n.loading?(m(),f("div",Id,[r("div",kd,[(m(!0),f(U,null,L(o.skeletonItems,c=>(m(),f("div",{key:c,class:"py-2"},Pd))),128))])])):(m(),f("form",{key:1,onSubmit:e[1]||(e[1]=te((...c)=>o.submitForm&&o.submitForm(...c),["prevent"])),class:"form"},[r("div",Dd,[(m(!0),f(U,null,L(n.fields,(c,h)=>(m(),f("div",{key:h,class:"ecwp-group form-group"},[c.type!=="textarea"?(m(),f("div",{key:0,type:c.type||"text"},[r("label",{for:h,class:"ecwp-label form-label"},u(c.label),9,jd),r("input",{id:h,class:S(["ecwp-input input input-bordered",c.class||"w-full"]),value:c.value,disabled:c.disabled,onInput:d=>o.updateFieldValue(h,d.target.value)},null,42,Od)],8,Rd)):(m(),f("div",qd,[r("label",{for:h,class:"form-label"},u(c.label),9,Md),j(a,{modelValue:c.value,"onUpdate:modelValue":d=>c.value=d,editorToolbar:n.toolbarOptions},null,8,["modelValue","onUpdate:modelValue","editorToolbar"])]))]))),128))]),r("div",Nd,[r("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[C(u(o.translations.send)+" ",1),n.loadingBtn?(m(),f("span",Vd)):y("",!0)],8,Bd)])],32))])],8,Ed)])}var Ud=re(xd,[["render",Fd]]);const Ld={components:{VueDatePicker:Mt},props:{isVisible:{type:Boolean,default:!1},title:{type:String,default:"Confirmation"},message:{type:String,default:"Are you sure?"},confirmText:{type:String,default:"Confirm"},cancelText:{type:String,default:"Cancel"},totalAmount:{type:String,required:!0},currency:{type:String,required:!0},advanceSold:{type:String,required:!0},quoteId:{type:Number,required:!0}},data(){return{showError:!1,selectedType:"",inputValue:0,due_date:"",invoiceSolded:!1,establishedAdvances:[],loading:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},formattedDate(){return t=>{if(!t)return"";const e=t.getDate().toString().padStart(2,"0"),s=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getFullYear();return`${e}-${s}-${i}`}},remainingAmount(){this.loading=!0;const t=this.establishedAdvances.reduce((e,s)=>{const i=parseFloat(s.advance_amount);return isNaN(i)?(console.error("Erreur: advance_amount n'est pas un nombre valide",s.advance_amount),e):e+i},0);return this.totalAmount-t},inputValueExceeds(){return this.remainingAmount==0?!0:this.selectedType==="percentage"?this.calculatedAmount>this.remainingAmount:this.selectedType==="fixed"?this.inputValue>this.remainingAmount:!1},calculatedAmount(){return this.selectedType==="percentage"?this.inputValue/100*this.remainingAmount:this.inputValue}},created(){this.fetchEstablishedAdvances(this.quoteId)},methods:{fetchEstablishedAdvances(t){const e=`/wp-json/my-easy-compta/v1/advance/${t}`;fetch(e,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(s=>s.json()).then(s=>{this.establishedAdvances=s}).catch(s=>{console.error("Error fetching advances:",s)})},onConfirm(){if(!this.inputValueExceeds){if(this.advanceSold=="no_sold"){if(!this.inputValue||!this.due_date||this.advanceSold=="no_sold"&&!this.selectedType){this.showError=!0,this.showToast("Veuillez remplir tous les champs obligatoires.","alert-error");return}this.$emit("confirm",{type:this.selectedType,value:this.inputValue,date:this.due_date})}else{if(!this.due_date){this.showError=!0,this.showToast("Veuillez remplir tous les champs obligatoires.","alert-error");return}this.$emit("confirm",{type:"fixed",value:this.remainingAmount,date:this.due_date})}this.closeModal()}},onCancel(){this.$emit("cancel"),this.closeModal()},closeModal(){document.getElementById("modal_advance").close()},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},Wd=["open"],Qd={class:"modal-box overflow-visible"},Hd={class:"font-bold text-lg"},Xd={class:"text-lg font-semibold text-center"},zd={class:"my-4 text-center text-xl"},Gd={key:0,class:"text-red-500 text-sm"},Jd={class:"grid grid-cols-2 gap-4"},Yd={key:0},Kd={class:"flex ecwp-group form-group mb-4"},Zd=r("label",{for:"advance-type",class:"ecwp-label"},"Type",-1),$d=r("option",{value:"percentage"},"Pourcentage",-1),eu=r("option",{value:"fixed"},"Montant fixe",-1),tu=[$d,eu],nu={key:1},su={class:"flex ecwp-group form-group mb-4"},ou=r("label",{for:"advance-type",class:"ecwp-label"},"Valeur",-1),iu={class:"absolute items-center border rounded-md right-0 top-6"},ru={class:"px-3 py-2.5 rounded-l-md bg-base-300 border-r"},au={key:0},lu={key:1},cu={key:1,class:"mt-2"},du={class:"text-sm"},uu={key:2,class:"flex ecwp-group form-group mb-4"},hu={for:"quoteDate",class:"ecwp-label"},mu={key:3},fu={class:"flex justify-between space-x-4 mt-4"},pu=["disabled"];function _u(t,e,s,i,n,o){const a=N("VueDatePicker");return m(),f("div",null,[n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),r("dialog",{id:"modal_advance",class:"modal",open:s.isVisible},[r("div",Qd,[r("h3",Hd,u(t.modalTitle),1),r("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=(...c)=>o.closeModal&&o.closeModal(...c))}," \u2715 "),r("h2",Xd,u(s.title),1),r("p",zd," Montant total restant : "+u(o.remainingAmount)+" "+u(s.currency),1),o.inputValueExceeds&&!n.invoiceSolded?(m(),f("p",Gd," Le montant s\xE9lectionn\xE9 d\xE9passe le montant total du devis. ")):y("",!0),r("div",Jd,[s.advanceSold=="no_sold"&&!n.invoiceSolded?(m(),f("div",Yd,[r("div",Kd,[Zd,P(r("select",{"onUpdate:modelValue":e[1]||(e[1]=c=>n.selectedType=c),id:"advance-type",class:S(["ecwp-select ecwp-input input input-bordered w-full",{"input-error":!n.selectedType&&n.showError}])},tu,2),[[ue,n.selectedType]])])])):y("",!0),n.selectedType&&s.advanceSold=="no_sold"&&!n.invoiceSolded?(m(),f("div",nu,[r("div",su,[ou,P(r("input",{"onUpdate:modelValue":e[2]||(e[2]=c=>n.inputValue=c),type:"text",id:"advance-value",class:S([{"input-error":!n.inputValue&&n.showError},"ecwp-input input input-bordered w-full"])},null,2),[[H,n.inputValue]]),r("div",iu,[r("div",ru,[n.selectedType==="percentage"?(m(),f("span",au,"%")):(m(),f("span",lu,u(s.currency),1))])])])])):y("",!0)]),n.selectedType==="percentage"&&!o.inputValueExceeds&!n.invoiceSolded?(m(),f("div",cu,[r("p",du," Montant bas\xE9 sur le pourcentage: "+u(o.calculatedAmount)+" "+u(s.currency),1)])):y("",!0),n.invoiceSolded?y("",!0):(m(),f("div",uu,[r("label",hu,u(o.translations.due_date),1),j(a,{class:S(["ecwp-input ecwp-date input input-bordered w-full",[!n.inputValue&&n.showError?"input-error":""]]),id:"quoteDate",modelValue:n.due_date,"onUpdate:modelValue":e[3]||(e[3]=c=>n.due_date=c),"enable-time-picker":!1,"auto-apply":"",format:o.formattedDate,"min-date":new Date,locale:"fr",required:""},null,8,["modelValue","format","min-date","class"])])),n.invoiceSolded?(m(),f("div",mu,"Facture d\xE9j\xE0 sold\xE9")):y("",!0),r("div",fu,[r("button",{onClick:e[4]||(e[4]=(...c)=>o.onCancel&&o.onCancel(...c)),class:"btn btn-secondary rounded-full"},u(s.cancelText),1),r("button",{onClick:e[5]||(e[5]=(...c)=>o.onConfirm&&o.onConfirm(...c)),disabled:o.inputValueExceeds,class:"btn rounded-full btn-error text-white"},u(s.confirmText),9,pu)])])],8,Wd)])}var gu=re(Ld,[["render",_u]]);const yu={name:"QuoteNavBar",components:{SendQuoteModal:Ud,ConfirmModal:ds,AdvanceModal:gu},props:{quoteInfo:Object,emailActive:Number,advanceActive:Number,currency:String,noItems:Boolean},data(){return{selectedQuote:null,advanceSold:!1,sendQuoteModal:!1,loadingModal:!1,loadingPdf:!1,loading:!1,client_detail:null,subject:"",content:"",toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{async changeQuoteStatus(t){try{const s=await(await fetch("/wp-json/my-easy-compta/v1/quotes/update-status",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({id:this.quoteInfo.id,status:t})})).json();s.success?(this.quoteInfo.status=t,this.quoteInfo.total_amount=s.total_amount,this.showToast(s.message,"alert-success")):(console.error("Failed to update quote status:",s.message),this.showToast(s.message,"alert-error"))}catch(e){console.error("An error occurred while updating quote status:",e),this.showToast(e,"alert-error")}},convertToInvoice(t){fetch(`/wp-json/my-easy-compta/v1/quotes/convert-quote/${t}`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>e.json()).then(e=>{e.success?(this.showToast(e.message,"alert-success"),this.$router.push({name:"InvoiceViewDetail",params:{id:e.id}})):this.showToast(e.message,"alert-error")}).catch(e=>{console.error("Error converting quote:",e),this.showToast(e.message,"alert-error")})},handleAdvanceInvoiceConfirm(t){const{type:e,value:s,date:i}=t;this.convertAdvanceInvoice(this.selectedQuote,e,s,i)},convertAdvanceInvoice(t,e,s,i){fetch(`/wp-json/my-easy-compta/v1/quotes/convert-advance/${t}`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({advance_type:e,advance_value:s,advance_date:i})}).then(n=>n.json()).then(n=>{n.success?(this.showToast(n.message,"alert-success"),this.$router.push({name:"InvoiceViewDetail",params:{id:n.id}})):this.showToast(n.message,"alert-error")}).catch(n=>{console.error("Error converting quote:",n),this.showToast(n.message,"alert-error")})},confirmConvertQuote(t){this.selectedQuote=t,modal_confirm.showModal(),this.showRemoveModal=!0},ConvertAdvanceQuote(t,e){this.selectedQuote=t,this.advanceSold=e,modal_advance.showModal(),this.showRemoveModal=!0},exportToPDF(){this.loadingPdf=!0;const t=this.quoteInfo.id;fetch(`/wp-json/my-easy-compta/v1/quotes/pdf/${t}`,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw this.loadingPdf=!1,new Error("Network response was not ok");return this.loadingPdf=!1,e.blob()}).then(e=>{const s=URL.createObjectURL(e);window.open(s),this.loadingPdf=!1}).catch(e=>{console.error("There was a problem with the fetch operation:",e),this.loadingPdf=!1})},sendQuote(t){this.loadingModal=!0,this.sendQuoteModal=!0,modal_send_quote.showModal(),this.fetchClient(t),this.fetchSettings()},fetchClient(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/clients/details/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Client not found");return e.json()}).then(e=>{this.client_detail=e,this.loading=!1}).catch(e=>{console.error("Error fetching client info:",e),this.loading=!1})},async fetchSettings(){try{this.loading=!0;const t=await fetch("/wp-json/my-easy-compta/v1/settings/get",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}});if(t.ok){const e=await t.json();this.subject=e.email_quote_subject,this.content=e.email_quote_content,this.loading=!1}else{const e=await t.json();this.showToast(e.message,"alert-error"),this.loading=!1}}catch(t){this.loading=!1,this.showToast(t.message,"alert-error")}},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},vu={key:0},bu={key:1},wu={key:3,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},xu=r("span",{class:"loading loading-spinner text-primary loading-lg"},null,-1),Eu=[xu],Cu={class:"navbar bg-base-100 mb-4 shadow-xl rounded-box flex justify-between"},Tu=r("div",{class:"dropdown"},[r("div",{tabindex:"0",role:"button",class:"btn btn-ghost lg:hidden"},[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h8m-8 6h16"})])]),r("ul",{tabindex:"0",class:"menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52"},[r("li",null,[r("a",null,"Item 1")]),r("li",null,[r("a",null,"Parent"),r("ul",{class:"p-2"},[r("li",null,[r("a",null,"Submenu 1")]),r("li",null,[r("a",null,"Submenu 2")])])]),r("li",null,[r("a",null,"Item 3")])])],-1),Iu={class:"hidden lg:flex gap-2"},ku={class:"btn btn-sm"},Su=r("i",{class:"far fa-edit"},null,-1),Au=r("i",{class:"fa fa-check"},null,-1),Pu=["data-tip"],Du={click:"#",class:"btn btn-outline btn-primary btn-sm hover:text-white",disabled:""},Ru=r("i",{class:"fas fa-check"},null,-1),ju=r("i",{class:"fa fa-check"},null,-1),Ou=r("i",{class:"fa fa-times"},null,-1),qu={key:4},Mu={class:"dropdown"},Nu={tabindex:"0",role:"button",class:"btn btn-sm"},Bu=r("i",{class:"fas fa-exchange-alt"},null,-1),Vu={tabindex:"0",class:"dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2 shadow"},Fu={key:0},Uu={key:5},Lu=r("i",{class:"fas fa-exchange-alt"},null,-1),Wu={class:"flex gap-2"},Qu=r("i",{class:"fas fa-paper-plane"},null,-1),Hu={key:0,class:"far fa-envelope"},Xu=["data-tip"],zu={click:"#",class:"btn btn-outline btn-primary btn-sm hover:text-white",disabled:""},Gu=r("i",{class:"fas fa-paper-plane"},null,-1),Ju=["data-tip"],Yu={click:"#",class:"btn btn-outline btn-primary btn-sm hover:text-white",disabled:""},Ku=r("i",{class:"fas fa-paper-plane"},null,-1),Zu=["disabled"],$u=r("i",{class:"far fa-file-pdf"},null,-1),eh={key:0,class:"loading loading-spinner loading-sm"};function th(t,e,s,i,n,o){const a=N("send-quote-modal"),c=N("confirm-modal"),h=N("advance-modal"),d=N("router-link");return m(),f("div",null,[s.emailActive==1?(m(),f("div",vu,[j(a,{loading:n.loadingModal,"show-modal":n.sendQuoteModal,"modal-id":"modal_send_quote",client:n.client_detail,"quote-id":s.quoteInfo.id,subject:n.subject,content:n.content,onClose:e[0]||(e[0]=l=>n.sendQuoteModal=!1)},null,8,["loading","show-modal","client","quote-id","subject","content"])])):y("",!0),j(c,{"show-modal":t.showConfirmModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_confirm_it,cancelText:o.translations.cancel,onConfirm:e[1]||(e[1]=l=>this.convertToInvoice(n.selectedQuote)),onCancel:e[2]||(e[2]=l=>t.showConfirmModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),s.advanceActive==1?(m(),f("div",bu,[j(h,{"show-modal":t.showConfirmModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_confirm_it,cancelText:o.translations.cancel,"total-amount":s.quoteInfo.total_amount,currency:s.currency,quoteId:s.quoteInfo.id,"advance-sold":n.advanceSold,onConfirm:o.handleAdvanceInvoiceConfirm,onCancel:e[3]||(e[3]=l=>t.showConfirmModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText","total-amount","currency","quoteId","advance-sold","onConfirm"])])):y("",!0),n.toast.visible?(m(),f("div",{key:2,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),n.loading?(m(),f("div",wu,Eu)):y("",!0),r("div",Cu,[r("div",null,[Tu,r("div",Iu,[j(d,{to:{name:"QuoteEdit",params:{id:s.quoteInfo.id}}},{default:me(()=>[r("button",ku,[Su,C(u(o.translations.edit_quote),1)])]),_:1},8,["to"]),s.quoteInfo.status=="draft"&&!s.noItems?(m(),f("button",{key:0,class:"btn btn-outline btn-success btn-sm",onClick:e[4]||(e[4]=l=>o.changeQuoteStatus("pending"))},[Au,C(" "+u(o.translations.validate_quote),1)])):y("",!0),s.quoteInfo.status=="draft"&&s.noItems?(m(),f("div",{key:1,class:"tooltip tooltip-bottom tooltip-warning","data-tip":o.translations.min_article},[r("button",Du,[Ru,C(" "+u(o.translations.validate_quote),1)])],8,Pu)):y("",!0),(s.quoteInfo.status=="pending"||s.quoteInfo.status=="rejected")&&!s.noItems?(m(),f("button",{key:2,class:"btn btn-outline btn-success btn-sm",onClick:e[5]||(e[5]=l=>o.changeQuoteStatus("approved"))},[ju,C(" "+u(o.translations.mark_as_accepted),1)])):y("",!0),(s.quoteInfo.status=="pending"||s.quoteInfo.status=="approved")&&!s.noItems?(m(),f("button",{key:3,class:"btn btn-outline btn-error btn-sm",onClick:e[6]||(e[6]=l=>o.changeQuoteStatus("rejected"))},[Ou,C(" "+u(o.translations.mark_as_rejected),1)])):y("",!0),s.advanceActive==1&&s.quoteInfo.converted!=1&&s.quoteInfo.status=="approved"&&!s.noItems?(m(),f("div",qu,[r("div",Mu,[r("div",Nu,[Bu,C(" "+u(o.translations.convertToInvoice),1)]),r("ul",Vu,[s.quoteInfo.advance!=1?(m(),f("li",Fu,[r("a",{href:"#",onClick:e[7]||(e[7]=te(l=>o.confirmConvertQuote(s.quoteInfo.id),["prevent"]))}," Facture global ")])):y("",!0),r("li",null,[r("a",{href:"#",onClick:e[8]||(e[8]=te(l=>o.ConvertAdvanceQuote(s.quoteInfo.id,"no_sold"),["prevent"]))}," Facture d'acompte "),s.quoteInfo.advance!=0?(m(),f("a",{key:0,href:"#",onClick:e[9]||(e[9]=te(l=>o.ConvertAdvanceQuote(s.quoteInfo.id,"sold"),["prevent"]))}," Facture du solde ")):y("",!0)])])])])):y("",!0),s.advanceActive!=1&&s.quoteInfo.converted!=1&&s.quoteInfo.status=="approved"&&!s.noItems?(m(),f("div",Uu,[r("button",{onClick:e[10]||(e[10]=l=>o.confirmConvertQuote(s.quoteInfo.id)),class:"btn btn-sm"},[Lu,C(" "+u(o.translations.convertToInvoice),1)])])):y("",!0)])]),r("div",Wu,[s.emailActive==1&&!s.noItems?(m(),f("button",{key:0,onClick:e[11]||(e[11]=te(l=>o.sendQuote(s.quoteInfo.client_id),["prevent"])),class:"btn btn-outline btn-primary btn-sm hover:text-white"},[Qu,C(" "+u(o.translations.send_quote)+" ",1),s.quoteInfo.sent==1?(m(),f("i",Hu)):y("",!0)])):s.emailActive==0?(m(),f("div",{key:1,class:"tooltip tooltip-bottom tooltip-warning","data-tip":o.translations.active_email_addon},[r("button",zu,[Gu,C(" "+u(o.translations.send_quote),1)])],8,Xu)):s.emailActive==1&&s.noItems?(m(),f("div",{key:2,class:"tooltip tooltip-bottom tooltip-warning","data-tip":o.translations.min_article},[r("button",Yu,[Ku,C(" "+u(o.translations.send_quote),1)])],8,Ju)):y("",!0),r("button",{onClick:e[12]||(e[12]=(...l)=>o.exportToPDF&&o.exportToPDF(...l)),class:"btn btn-outline btn-success btn-sm",disabled:n.loadingPdf},[$u,C(" "+u(o.translations.exportToPDF)+" ",1),n.loadingPdf?(m(),f("span",eh)):y("",!0)],8,Zu)])])])}var nh=re(yu,[["render",th]]);const sh={components:{VueEditor:Nt.exports.VueEditor},props:{loading:Boolean,showModal:Boolean,modalId:String,modalTitle:String,item:Object},data(){const t=window.myEasyComptaAdmin.easyComptaTranslations;return{editedItem:{...this.item},loading:this.loading,loadingBtn:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},fields:{item_name:{label:t.item_name},item_description:{label:t.description,type:"textarea"},quantity:{label:t.quantity,type:"number"},vat_rate:{label:"Taux de TVA",type:"number"},unit_price:{label:t.unit_price,type:"number"},discount:{label:t.discount,type:"number"}}}},computed:{skeletonItems(){return Array.from({length:10},(t,e)=>e)},translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{closeModal(){document.getElementById(this.modalId).close()},async submitForm(){this.loadingBtn=!0;try{const t=await fetch(`/wp-json/my-easy-compta/v1/quotes/edit-item/${this.editedItem.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.editedItem)});if(t.ok){const e=await t.json();this.loadingBtn=!1,this.closeModal(),this.showToast(e.message,"alert-success"),this.$emit("itemEdited")}else{const e=`Error editing item: ${t.statusText}`;this.showToast(e,"alert-error"),console.error(e),this.loadingBtn=!1}}catch(t){const e=t.response&&t.response.data&&t.response.data.message?t.response.data.message:"Error editing item";this.showToast(e,"alert-error"),console.error("Error editing item:",t),this.loadingBtn=!1}},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)},resize(){let t=this.$refs.textarea;t.style.height="auto",t.style.height=t.scrollHeight+"px"},increase(){this.newItem.quantity++},decrease(){this.newItem.quantity>1&&this.newItem.quantity--}},watch:{item:{handler(t){this.editedItem={...t}},immediate:!0}}},oh=["id","open"],ih={class:"modal-box"},rh={class:"font-bold text-lg"},ah={key:0},lh={class:"grid grid-cols-1 gap-4"},ch=r("div",{class:"skeleton h-4 w-full mb-2"},null,-1),dh=r("div",{class:"skeleton h-4 w-full"},null,-1),uh=[ch,dh],hh={class:"grid grid-cols-1 gap-4"},mh=["type"],fh=["for"],ph=["id","onUpdate:modelValue"],_h={key:1},gh=["for"],yh={class:"form-group mt-4 flex justify-end"},vh=["disabled"],bh={key:0,class:"loading loading-spinner loading-sm"};function wh(t,e,s,i,n,o){const a=N("vue-editor");return m(),f("div",null,[n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),r("dialog",{id:s.modalId,class:"modal",open:s.showModal},[r("div",ih,[r("h3",rh,u(s.modalTitle),1),r("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=c=>o.closeModal())}," \u2715 "),n.loading?(m(),f("div",ah,[r("div",lh,[(m(!0),f(U,null,L(o.skeletonItems,c=>(m(),f("div",{key:c,class:"py-2"},uh))),128))])])):(m(),f("form",{key:1,onSubmit:e[1]||(e[1]=te((...c)=>o.submitForm&&o.submitForm(...c),["prevent"])),class:"form"},[r("div",hh,[(m(!0),f(U,null,L(n.fields,(c,h)=>(m(),f("div",{key:h,class:"ecwp-group form-group"},[c.type!=="textarea"?(m(),f("div",{key:0,type:c.type||"text"},[r("label",{for:h,class:"ecwp-label form-label"},u(c.label),9,fh),P(r("input",{id:h,"onUpdate:modelValue":d=>n.editedItem[h]=d,class:S(["ecwp-input input input-bordered",c.class||"w-full"])},null,10,ph),[[H,n.editedItem[h]]])],8,mh)):(m(),f("div",_h,[r("label",{for:h,class:"form-label"},u(c.label),9,gh),j(a,{id:h,modelValue:n.editedItem[h],"onUpdate:modelValue":d=>n.editedItem[h]=d,editorToolbar:t.toolbarOptions},null,8,["id","modelValue","onUpdate:modelValue","editorToolbar"])]))]))),128))]),r("div",yh,[r("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[C(u(o.translations.save)+" ",1),n.loadingBtn?(m(),f("span",bh)):y("",!0)],8,vh)])],32))])],8,oh)])}var xh=re(sh,[["render",wh]]);/**!
 * Sortable 1.15.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Hs(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,i)}return s}function qe(t){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?Hs(Object(s),!0).forEach(function(i){Eh(t,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Hs(Object(s)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(s,i))})}return t}function Yt(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Yt=function(e){return typeof e}:Yt=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yt(t)}function Eh(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function Le(){return Le=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},Le.apply(this,arguments)}function Ch(t,e){if(t==null)return{};var s={},i=Object.keys(t),n,o;for(o=0;o<i.length;o++)n=i[o],!(e.indexOf(n)>=0)&&(s[n]=t[n]);return s}function Th(t,e){if(t==null)return{};var s=Ch(t,e),i,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)i=o[n],!(e.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(t,i)||(s[i]=t[i]))}return s}var Ih="1.15.2";function Ue(t){if(typeof window!="undefined"&&window.navigator)return!!navigator.userAgent.match(t)}var We=Ue(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Vt=Ue(/Edge/i),Xs=Ue(/firefox/i),It=Ue(/safari/i)&&!Ue(/chrome/i)&&!Ue(/android/i),Xo=Ue(/iP(ad|od|hone)/i),zo=Ue(/chrome/i)&&Ue(/android/i),Go={capture:!1,passive:!1};function z(t,e,s){t.addEventListener(e,s,!We&&Go)}function Q(t,e,s){t.removeEventListener(e,s,!We&&Go)}function on(t,e){if(!!e){if(e[0]===">"&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch{return!1}return!1}}function kh(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function ke(t,e,s,i){if(t){s=s||document;do{if(e!=null&&(e[0]===">"?t.parentNode===s&&on(t,e):on(t,e))||i&&t===s)return t;if(t===s)break}while(t=kh(t))}return null}var zs=/\s+/g;function ye(t,e,s){if(t&&e)if(t.classList)t.classList[s?"add":"remove"](e);else{var i=(" "+t.className+" ").replace(zs," ").replace(" "+e+" "," ");t.className=(i+(s?" "+e:"")).replace(zs," ")}}function M(t,e,s){var i=t&&t.style;if(i){if(s===void 0)return document.defaultView&&document.defaultView.getComputedStyle?s=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(s=t.currentStyle),e===void 0?s:s[e];!(e in i)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),i[e]=s+(typeof s=="string"?"":"px")}}function ct(t,e){var s="";if(typeof t=="string")s=t;else do{var i=M(t,"transform");i&&i!=="none"&&(s=i+" "+s)}while(!e&&(t=t.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(s)}function Jo(t,e,s){if(t){var i=t.getElementsByTagName(e),n=0,o=i.length;if(s)for(;n<o;n++)s(i[n],n);return i}return[]}function Oe(){var t=document.scrollingElement;return t||document.documentElement}function oe(t,e,s,i,n){if(!(!t.getBoundingClientRect&&t!==window)){var o,a,c,h,d,l,p;if(t!==window&&t.parentNode&&t!==Oe()?(o=t.getBoundingClientRect(),a=o.top,c=o.left,h=o.bottom,d=o.right,l=o.height,p=o.width):(a=0,c=0,h=window.innerHeight,d=window.innerWidth,l=window.innerHeight,p=window.innerWidth),(e||s)&&t!==window&&(n=n||t.parentNode,!We))do if(n&&n.getBoundingClientRect&&(M(n,"transform")!=="none"||s&&M(n,"position")!=="static")){var _=n.getBoundingClientRect();a-=_.top+parseInt(M(n,"border-top-width")),c-=_.left+parseInt(M(n,"border-left-width")),h=a+o.height,d=c+o.width;break}while(n=n.parentNode);if(i&&t!==window){var g=ct(n||t),b=g&&g.a,x=g&&g.d;g&&(a/=x,c/=b,p/=b,l/=x,h=a+l,d=c+p)}return{top:a,left:c,bottom:h,right:d,width:p,height:l}}}function Gs(t,e,s){for(var i=Ke(t,!0),n=oe(t)[e];i;){var o=oe(i)[s],a=void 0;if(s==="top"||s==="left"?a=n>=o:a=n<=o,!a)return i;if(i===Oe())break;i=Ke(i,!1)}return!1}function ht(t,e,s,i){for(var n=0,o=0,a=t.children;o<a.length;){if(a[o].style.display!=="none"&&a[o]!==O.ghost&&(i||a[o]!==O.dragged)&&ke(a[o],s.draggable,t,!1)){if(n===e)return a[o];n++}o++}return null}function us(t,e){for(var s=t.lastElementChild;s&&(s===O.ghost||M(s,"display")==="none"||e&&!on(s,e));)s=s.previousElementSibling;return s||null}function xe(t,e){var s=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==O.clone&&(!e||on(t,e))&&s++;return s}function Js(t){var e=0,s=0,i=Oe();if(t)do{var n=ct(t),o=n.a,a=n.d;e+=t.scrollLeft*o,s+=t.scrollTop*a}while(t!==i&&(t=t.parentNode));return[e,s]}function Sh(t,e){for(var s in t)if(!!t.hasOwnProperty(s)){for(var i in e)if(e.hasOwnProperty(i)&&e[i]===t[s][i])return Number(s)}return-1}function Ke(t,e){if(!t||!t.getBoundingClientRect)return Oe();var s=t,i=!1;do if(s.clientWidth<s.scrollWidth||s.clientHeight<s.scrollHeight){var n=M(s);if(s.clientWidth<s.scrollWidth&&(n.overflowX=="auto"||n.overflowX=="scroll")||s.clientHeight<s.scrollHeight&&(n.overflowY=="auto"||n.overflowY=="scroll")){if(!s.getBoundingClientRect||s===document.body)return Oe();if(i||e)return s;i=!0}}while(s=s.parentNode);return Oe()}function Ah(t,e){if(t&&e)for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t}function Rn(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}var kt;function Yo(t,e){return function(){if(!kt){var s=arguments,i=this;s.length===1?t.call(i,s[0]):t.apply(i,s),kt=setTimeout(function(){kt=void 0},e)}}}function Ph(){clearTimeout(kt),kt=void 0}function Ko(t,e,s){t.scrollLeft+=e,t.scrollTop+=s}function Zo(t){var e=window.Polymer,s=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):s?s(t).clone(!0)[0]:t.cloneNode(!0)}function $o(t,e,s){var i={};return Array.from(t.children).forEach(function(n){var o,a,c,h;if(!(!ke(n,e.draggable,t,!1)||n.animated||n===s)){var d=oe(n);i.left=Math.min((o=i.left)!==null&&o!==void 0?o:1/0,d.left),i.top=Math.min((a=i.top)!==null&&a!==void 0?a:1/0,d.top),i.right=Math.max((c=i.right)!==null&&c!==void 0?c:-1/0,d.right),i.bottom=Math.max((h=i.bottom)!==null&&h!==void 0?h:-1/0,d.bottom)}}),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var be="Sortable"+new Date().getTime();function Dh(){var t=[],e;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(n){if(!(M(n,"display")==="none"||n===O.ghost)){t.push({target:n,rect:oe(n)});var o=qe({},t[t.length-1].rect);if(n.thisAnimationDuration){var a=ct(n,!0);a&&(o.top-=a.f,o.left-=a.e)}n.fromRect=o}})}},addAnimationState:function(i){t.push(i)},removeAnimationState:function(i){t.splice(Sh(t,{target:i}),1)},animateAll:function(i){var n=this;if(!this.options.animation){clearTimeout(e),typeof i=="function"&&i();return}var o=!1,a=0;t.forEach(function(c){var h=0,d=c.target,l=d.fromRect,p=oe(d),_=d.prevFromRect,g=d.prevToRect,b=c.rect,x=ct(d,!0);x&&(p.top-=x.f,p.left-=x.e),d.toRect=p,d.thisAnimationDuration&&Rn(_,p)&&!Rn(l,p)&&(b.top-p.top)/(b.left-p.left)===(l.top-p.top)/(l.left-p.left)&&(h=jh(b,_,g,n.options)),Rn(p,l)||(d.prevFromRect=l,d.prevToRect=p,h||(h=n.options.animation),n.animate(d,b,p,h)),h&&(o=!0,a=Math.max(a,h),clearTimeout(d.animationResetTimer),d.animationResetTimer=setTimeout(function(){d.animationTime=0,d.prevFromRect=null,d.fromRect=null,d.prevToRect=null,d.thisAnimationDuration=null},h),d.thisAnimationDuration=h)}),clearTimeout(e),o?e=setTimeout(function(){typeof i=="function"&&i()},a):typeof i=="function"&&i(),t=[]},animate:function(i,n,o,a){if(a){M(i,"transition",""),M(i,"transform","");var c=ct(this.el),h=c&&c.a,d=c&&c.d,l=(n.left-o.left)/(h||1),p=(n.top-o.top)/(d||1);i.animatingX=!!l,i.animatingY=!!p,M(i,"transform","translate3d("+l+"px,"+p+"px,0)"),this.forRepaintDummy=Rh(i),M(i,"transition","transform "+a+"ms"+(this.options.easing?" "+this.options.easing:"")),M(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){M(i,"transition",""),M(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},a)}}}}function Rh(t){return t.offsetWidth}function jh(t,e,s,i){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-s.top,2)+Math.pow(e.left-s.left,2))*i.animation}var ot=[],jn={initializeByDefault:!0},Ft={mount:function(e){for(var s in jn)jn.hasOwnProperty(s)&&!(s in e)&&(e[s]=jn[s]);ot.forEach(function(i){if(i.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),ot.push(e)},pluginEvent:function(e,s,i){var n=this;this.eventCanceled=!1,i.cancel=function(){n.eventCanceled=!0};var o=e+"Global";ot.forEach(function(a){!s[a.pluginName]||(s[a.pluginName][o]&&s[a.pluginName][o](qe({sortable:s},i)),s.options[a.pluginName]&&s[a.pluginName][e]&&s[a.pluginName][e](qe({sortable:s},i)))})},initializePlugins:function(e,s,i,n){ot.forEach(function(c){var h=c.pluginName;if(!(!e.options[h]&&!c.initializeByDefault)){var d=new c(e,s,e.options);d.sortable=e,d.options=e.options,e[h]=d,Le(i,d.defaults)}});for(var o in e.options)if(!!e.options.hasOwnProperty(o)){var a=this.modifyOption(e,o,e.options[o]);typeof a!="undefined"&&(e.options[o]=a)}},getEventProperties:function(e,s){var i={};return ot.forEach(function(n){typeof n.eventProperties=="function"&&Le(i,n.eventProperties.call(s[n.pluginName],e))}),i},modifyOption:function(e,s,i){var n;return ot.forEach(function(o){!e[o.pluginName]||o.optionListeners&&typeof o.optionListeners[s]=="function"&&(n=o.optionListeners[s].call(e[o.pluginName],i))}),n}};function Oh(t){var e=t.sortable,s=t.rootEl,i=t.name,n=t.targetEl,o=t.cloneEl,a=t.toEl,c=t.fromEl,h=t.oldIndex,d=t.newIndex,l=t.oldDraggableIndex,p=t.newDraggableIndex,_=t.originalEvent,g=t.putSortable,b=t.extraEventProperties;if(e=e||s&&s[be],!!e){var x,D=e.options,q="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!We&&!Vt?x=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(x=document.createEvent("Event"),x.initEvent(i,!0,!0)),x.to=a||s,x.from=c||s,x.item=n||s,x.clone=o,x.oldIndex=h,x.newIndex=d,x.oldDraggableIndex=l,x.newDraggableIndex=p,x.originalEvent=_,x.pullMode=g?g.lastPutMode:void 0;var A=qe(qe({},b),Ft.getEventProperties(i,e));for(var I in A)x[I]=A[I];s&&s.dispatchEvent(x),D[q]&&D[q].call(e,x)}}var qh=["evt"],ge=function(e,s){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=i.evt,o=Th(i,qh);Ft.pluginEvent.bind(O)(e,s,qe({dragEl:E,parentEl:ee,ghostEl:B,rootEl:Z,nextEl:tt,lastDownEl:Kt,cloneEl:$,cloneHidden:Ye,dragStarted:bt,putSortable:de,activeSortable:O.active,originalEvent:n,oldIndex:lt,oldDraggableIndex:St,newIndex:ve,newDraggableIndex:Je,hideGhostForTarget:si,unhideGhostForTarget:oi,cloneNowHidden:function(){Ye=!0},cloneNowShown:function(){Ye=!1},dispatchSortableEvent:function(c){pe({sortable:s,name:c,originalEvent:n})}},o))};function pe(t){Oh(qe({putSortable:de,cloneEl:$,targetEl:E,rootEl:Z,oldIndex:lt,oldDraggableIndex:St,newIndex:ve,newDraggableIndex:Je},t))}var E,ee,B,Z,tt,Kt,$,Ye,lt,ve,St,Je,Wt,de,at=!1,rn=!1,an=[],$e,Ie,On,qn,Ys,Ks,bt,it,At,Pt=!1,Qt=!1,Zt,he,Mn=[],Kn=!1,ln=[],wn=typeof document!="undefined",Ht=Xo,Zs=Vt||We?"cssFloat":"float",Mh=wn&&!zo&&!Xo&&"draggable"in document.createElement("div"),ei=function(){if(!!wn){if(We)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),ti=function(e,s){var i=M(e),n=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),o=ht(e,0,s),a=ht(e,1,s),c=o&&M(o),h=a&&M(a),d=c&&parseInt(c.marginLeft)+parseInt(c.marginRight)+oe(o).width,l=h&&parseInt(h.marginLeft)+parseInt(h.marginRight)+oe(a).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&c.float&&c.float!=="none"){var p=c.float==="left"?"left":"right";return a&&(h.clear==="both"||h.clear===p)?"vertical":"horizontal"}return o&&(c.display==="block"||c.display==="flex"||c.display==="table"||c.display==="grid"||d>=n&&i[Zs]==="none"||a&&i[Zs]==="none"&&d+l>n)?"vertical":"horizontal"},Nh=function(e,s,i){var n=i?e.left:e.top,o=i?e.right:e.bottom,a=i?e.width:e.height,c=i?s.left:s.top,h=i?s.right:s.bottom,d=i?s.width:s.height;return n===c||o===h||n+a/2===c+d/2},Bh=function(e,s){var i;return an.some(function(n){var o=n[be].options.emptyInsertThreshold;if(!(!o||us(n))){var a=oe(n),c=e>=a.left-o&&e<=a.right+o,h=s>=a.top-o&&s<=a.bottom+o;if(c&&h)return i=n}}),i},ni=function(e){function s(o,a){return function(c,h,d,l){var p=c.options.group.name&&h.options.group.name&&c.options.group.name===h.options.group.name;if(o==null&&(a||p))return!0;if(o==null||o===!1)return!1;if(a&&o==="clone")return o;if(typeof o=="function")return s(o(c,h,d,l),a)(c,h,d,l);var _=(a?c:h).options.group.name;return o===!0||typeof o=="string"&&o===_||o.join&&o.indexOf(_)>-1}}var i={},n=e.group;(!n||Yt(n)!="object")&&(n={name:n}),i.name=n.name,i.checkPull=s(n.pull,!0),i.checkPut=s(n.put),i.revertClone=n.revertClone,e.group=i},si=function(){!ei&&B&&M(B,"display","none")},oi=function(){!ei&&B&&M(B,"display","")};wn&&!zo&&document.addEventListener("click",function(t){if(rn)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),rn=!1,!1},!0);var et=function(e){if(E){e=e.touches?e.touches[0]:e;var s=Bh(e.clientX,e.clientY);if(s){var i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);i.target=i.rootEl=s,i.preventDefault=void 0,i.stopPropagation=void 0,s[be]._onDragOver(i)}}},Vh=function(e){E&&E.parentNode[be]._isOutsideThisEl(e.target)};function O(t,e){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=Le({},e),t[be]=this;var s={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return ti(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(a,c){a.setData("Text",c.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:O.supportPointer!==!1&&"PointerEvent"in window&&!It,emptyInsertThreshold:5};Ft.initializePlugins(this,t,s);for(var i in s)!(i in e)&&(e[i]=s[i]);ni(e);for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this));this.nativeDraggable=e.forceFallback?!1:Mh,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?z(t,"pointerdown",this._onTapStart):(z(t,"mousedown",this._onTapStart),z(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(z(t,"dragover",this),z(t,"dragenter",this)),an.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Le(this,Dh())}O.prototype={constructor:O,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(it=null)},_getDirection:function(e,s){return typeof this.options.direction=="function"?this.options.direction.call(this,e,s,E):this.options.direction},_onTapStart:function(e){if(!!e.cancelable){var s=this,i=this.el,n=this.options,o=n.preventOnFilter,a=e.type,c=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,h=(c||e).target,d=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||h,l=n.filter;if(zh(i),!E&&!(/mousedown|pointerdown/.test(a)&&e.button!==0||n.disabled)&&!d.isContentEditable&&!(!this.nativeDraggable&&It&&h&&h.tagName.toUpperCase()==="SELECT")&&(h=ke(h,n.draggable,i,!1),!(h&&h.animated)&&Kt!==h)){if(lt=xe(h),St=xe(h,n.draggable),typeof l=="function"){if(l.call(this,e,h,this)){pe({sortable:s,rootEl:d,name:"filter",targetEl:h,toEl:i,fromEl:i}),ge("filter",s,{evt:e}),o&&e.cancelable&&e.preventDefault();return}}else if(l&&(l=l.split(",").some(function(p){if(p=ke(d,p.trim(),i,!1),p)return pe({sortable:s,rootEl:p,name:"filter",targetEl:h,fromEl:i,toEl:i}),ge("filter",s,{evt:e}),!0}),l)){o&&e.cancelable&&e.preventDefault();return}n.handle&&!ke(d,n.handle,i,!1)||this._prepareDragStart(e,c,h)}}},_prepareDragStart:function(e,s,i){var n=this,o=n.el,a=n.options,c=o.ownerDocument,h;if(i&&!E&&i.parentNode===o){var d=oe(i);if(Z=o,E=i,ee=E.parentNode,tt=E.nextSibling,Kt=i,Wt=a.group,O.dragged=E,$e={target:E,clientX:(s||e).clientX,clientY:(s||e).clientY},Ys=$e.clientX-d.left,Ks=$e.clientY-d.top,this._lastX=(s||e).clientX,this._lastY=(s||e).clientY,E.style["will-change"]="all",h=function(){if(ge("delayEnded",n,{evt:e}),O.eventCanceled){n._onDrop();return}n._disableDelayedDragEvents(),!Xs&&n.nativeDraggable&&(E.draggable=!0),n._triggerDragStart(e,s),pe({sortable:n,name:"choose",originalEvent:e}),ye(E,a.chosenClass,!0)},a.ignore.split(",").forEach(function(l){Jo(E,l.trim(),Nn)}),z(c,"dragover",et),z(c,"mousemove",et),z(c,"touchmove",et),z(c,"mouseup",n._onDrop),z(c,"touchend",n._onDrop),z(c,"touchcancel",n._onDrop),Xs&&this.nativeDraggable&&(this.options.touchStartThreshold=4,E.draggable=!0),ge("delayStart",this,{evt:e}),a.delay&&(!a.delayOnTouchOnly||s)&&(!this.nativeDraggable||!(Vt||We))){if(O.eventCanceled){this._onDrop();return}z(c,"mouseup",n._disableDelayedDrag),z(c,"touchend",n._disableDelayedDrag),z(c,"touchcancel",n._disableDelayedDrag),z(c,"mousemove",n._delayedDragTouchMoveHandler),z(c,"touchmove",n._delayedDragTouchMoveHandler),a.supportPointer&&z(c,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(h,a.delay)}else h()}},_delayedDragTouchMoveHandler:function(e){var s=e.touches?e.touches[0]:e;Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){E&&Nn(E),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;Q(e,"mouseup",this._disableDelayedDrag),Q(e,"touchend",this._disableDelayedDrag),Q(e,"touchcancel",this._disableDelayedDrag),Q(e,"mousemove",this._delayedDragTouchMoveHandler),Q(e,"touchmove",this._delayedDragTouchMoveHandler),Q(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,s){s=s||e.pointerType=="touch"&&e,!this.nativeDraggable||s?this.options.supportPointer?z(document,"pointermove",this._onTouchMove):s?z(document,"touchmove",this._onTouchMove):z(document,"mousemove",this._onTouchMove):(z(E,"dragend",this),z(Z,"dragstart",this._onDragStart));try{document.selection?$t(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,s){if(at=!1,Z&&E){ge("dragStarted",this,{evt:s}),this.nativeDraggable&&z(document,"dragover",Vh);var i=this.options;!e&&ye(E,i.dragClass,!1),ye(E,i.ghostClass,!0),O.active=this,e&&this._appendGhost(),pe({sortable:this,name:"start",originalEvent:s})}else this._nulling()},_emulateDragOver:function(){if(Ie){this._lastX=Ie.clientX,this._lastY=Ie.clientY,si();for(var e=document.elementFromPoint(Ie.clientX,Ie.clientY),s=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Ie.clientX,Ie.clientY),e!==s);)s=e;if(E.parentNode[be]._isOutsideThisEl(e),s)do{if(s[be]){var i=void 0;if(i=s[be]._onDragOver({clientX:Ie.clientX,clientY:Ie.clientY,target:e,rootEl:s}),i&&!this.options.dragoverBubble)break}e=s}while(s=s.parentNode);oi()}},_onTouchMove:function(e){if($e){var s=this.options,i=s.fallbackTolerance,n=s.fallbackOffset,o=e.touches?e.touches[0]:e,a=B&&ct(B,!0),c=B&&a&&a.a,h=B&&a&&a.d,d=Ht&&he&&Js(he),l=(o.clientX-$e.clientX+n.x)/(c||1)+(d?d[0]-Mn[0]:0)/(c||1),p=(o.clientY-$e.clientY+n.y)/(h||1)+(d?d[1]-Mn[1]:0)/(h||1);if(!O.active&&!at){if(i&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<i)return;this._onDragStart(e,!0)}if(B){a?(a.e+=l-(On||0),a.f+=p-(qn||0)):a={a:1,b:0,c:0,d:1,e:l,f:p};var _="matrix(".concat(a.a,",").concat(a.b,",").concat(a.c,",").concat(a.d,",").concat(a.e,",").concat(a.f,")");M(B,"webkitTransform",_),M(B,"mozTransform",_),M(B,"msTransform",_),M(B,"transform",_),On=l,qn=p,Ie=o}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!B){var e=this.options.fallbackOnBody?document.body:Z,s=oe(E,!0,Ht,!0,e),i=this.options;if(Ht){for(he=e;M(he,"position")==="static"&&M(he,"transform")==="none"&&he!==document;)he=he.parentNode;he!==document.body&&he!==document.documentElement?(he===document&&(he=Oe()),s.top+=he.scrollTop,s.left+=he.scrollLeft):he=Oe(),Mn=Js(he)}B=E.cloneNode(!0),ye(B,i.ghostClass,!1),ye(B,i.fallbackClass,!0),ye(B,i.dragClass,!0),M(B,"transition",""),M(B,"transform",""),M(B,"box-sizing","border-box"),M(B,"margin",0),M(B,"top",s.top),M(B,"left",s.left),M(B,"width",s.width),M(B,"height",s.height),M(B,"opacity","0.8"),M(B,"position",Ht?"absolute":"fixed"),M(B,"zIndex","100000"),M(B,"pointerEvents","none"),O.ghost=B,e.appendChild(B),M(B,"transform-origin",Ys/parseInt(B.style.width)*100+"% "+Ks/parseInt(B.style.height)*100+"%")}},_onDragStart:function(e,s){var i=this,n=e.dataTransfer,o=i.options;if(ge("dragStart",this,{evt:e}),O.eventCanceled){this._onDrop();return}ge("setupClone",this),O.eventCanceled||($=Zo(E),$.removeAttribute("id"),$.draggable=!1,$.style["will-change"]="",this._hideClone(),ye($,this.options.chosenClass,!1),O.clone=$),i.cloneId=$t(function(){ge("clone",i),!O.eventCanceled&&(i.options.removeCloneOnHide||Z.insertBefore($,E),i._hideClone(),pe({sortable:i,name:"clone"}))}),!s&&ye(E,o.dragClass,!0),s?(rn=!0,i._loopId=setInterval(i._emulateDragOver,50)):(Q(document,"mouseup",i._onDrop),Q(document,"touchend",i._onDrop),Q(document,"touchcancel",i._onDrop),n&&(n.effectAllowed="move",o.setData&&o.setData.call(i,n,E)),z(document,"drop",i),M(E,"transform","translateZ(0)")),at=!0,i._dragStartId=$t(i._dragStarted.bind(i,s,e)),z(document,"selectstart",i),bt=!0,It&&M(document.body,"user-select","none")},_onDragOver:function(e){var s=this.el,i=e.target,n,o,a,c=this.options,h=c.group,d=O.active,l=Wt===h,p=c.sort,_=de||d,g,b=this,x=!1;if(Kn)return;function D(Ve,xn){ge(Ve,b,qe({evt:e,isOwner:l,axis:g?"vertical":"horizontal",revert:a,dragRect:n,targetRect:o,canSort:p,fromSortable:_,target:i,completed:A,onMove:function(pt,_t){return Xt(Z,s,E,n,pt,oe(pt),e,_t)},changed:I},xn))}function q(){D("dragOverAnimationCapture"),b.captureAnimationState(),b!==_&&_.captureAnimationState()}function A(Ve){return D("dragOverCompleted",{insertion:Ve}),Ve&&(l?d._hideClone():d._showClone(b),b!==_&&(ye(E,de?de.options.ghostClass:d.options.ghostClass,!1),ye(E,c.ghostClass,!0)),de!==b&&b!==O.active?de=b:b===O.active&&de&&(de=null),_===b&&(b._ignoreWhileAnimating=i),b.animateAll(function(){D("dragOverAnimationComplete"),b._ignoreWhileAnimating=null}),b!==_&&(_.animateAll(),_._ignoreWhileAnimating=null)),(i===E&&!E.animated||i===s&&!i.animated)&&(it=null),!c.dragoverBubble&&!e.rootEl&&i!==document&&(E.parentNode[be]._isOutsideThisEl(e.target),!Ve&&et(e)),!c.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),x=!0}function I(){ve=xe(E),Je=xe(E,c.draggable),pe({sortable:b,name:"change",toEl:s,newIndex:ve,newDraggableIndex:Je,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),i=ke(i,c.draggable,s,!0),D("dragOver"),O.eventCanceled)return x;if(E.contains(e.target)||i.animated&&i.animatingX&&i.animatingY||b._ignoreWhileAnimating===i)return A(!1);if(rn=!1,d&&!c.disabled&&(l?p||(a=ee!==Z):de===this||(this.lastPutMode=Wt.checkPull(this,d,E,e))&&h.checkPut(this,d,E,e))){if(g=this._getDirection(e,i)==="vertical",n=oe(E),D("dragOverValid"),O.eventCanceled)return x;if(a)return ee=Z,q(),this._hideClone(),D("revert"),O.eventCanceled||(tt?Z.insertBefore(E,tt):Z.appendChild(E)),A(!0);var X=us(s,c.draggable);if(!X||Wh(e,g,this)&&!X.animated){if(X===E)return A(!1);if(X&&s===e.target&&(i=X),i&&(o=oe(i)),Xt(Z,s,E,n,i,o,e,!!i)!==!1)return q(),X&&X.nextSibling?s.insertBefore(E,X.nextSibling):s.appendChild(E),ee=s,I(),A(!0)}else if(X&&Lh(e,g,this)){var le=ht(s,0,c,!0);if(le===E)return A(!1);if(i=le,o=oe(i),Xt(Z,s,E,n,i,o,e,!1)!==!1)return q(),s.insertBefore(E,le),ee=s,I(),A(!0)}else if(i.parentNode===s){o=oe(i);var J=0,Y,Re=E.parentNode!==s,ce=!Nh(E.animated&&E.toRect||n,i.animated&&i.toRect||o,g),Qe=g?"top":"left",Ce=Gs(i,"top","top")||Gs(E,"top","top"),He=Ce?Ce.scrollTop:void 0;it!==i&&(Y=o[Qe],Pt=!1,Qt=!ce&&c.invertSwap||Re),J=Qh(e,i,o,g,ce?1:c.swapThreshold,c.invertedSwapThreshold==null?c.swapThreshold:c.invertedSwapThreshold,Qt,it===i);var fe;if(J!==0){var Me=xe(E);do Me-=J,fe=ee.children[Me];while(fe&&(M(fe,"display")==="none"||fe===B))}if(J===0||fe===i)return A(!1);it=i,At=J;var Ne=i.nextElementSibling,Te=!1;Te=J===1;var Be=Xt(Z,s,E,n,i,o,e,Te);if(Be!==!1)return(Be===1||Be===-1)&&(Te=Be===1),Kn=!0,setTimeout(Uh,30),q(),Te&&!Ne?s.appendChild(E):i.parentNode.insertBefore(E,Te?Ne:i),Ce&&Ko(Ce,0,He-Ce.scrollTop),ee=E.parentNode,Y!==void 0&&!Qt&&(Zt=Math.abs(Y-oe(i)[Qe])),I(),A(!0)}if(s.contains(E))return A(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){Q(document,"mousemove",this._onTouchMove),Q(document,"touchmove",this._onTouchMove),Q(document,"pointermove",this._onTouchMove),Q(document,"dragover",et),Q(document,"mousemove",et),Q(document,"touchmove",et)},_offUpEvents:function(){var e=this.el.ownerDocument;Q(e,"mouseup",this._onDrop),Q(e,"touchend",this._onDrop),Q(e,"pointerup",this._onDrop),Q(e,"touchcancel",this._onDrop),Q(document,"selectstart",this)},_onDrop:function(e){var s=this.el,i=this.options;if(ve=xe(E),Je=xe(E,i.draggable),ge("drop",this,{evt:e}),ee=E&&E.parentNode,ve=xe(E),Je=xe(E,i.draggable),O.eventCanceled){this._nulling();return}at=!1,Qt=!1,Pt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Zn(this.cloneId),Zn(this._dragStartId),this.nativeDraggable&&(Q(document,"drop",this),Q(s,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),It&&M(document.body,"user-select",""),M(E,"transform",""),e&&(bt&&(e.cancelable&&e.preventDefault(),!i.dropBubble&&e.stopPropagation()),B&&B.parentNode&&B.parentNode.removeChild(B),(Z===ee||de&&de.lastPutMode!=="clone")&&$&&$.parentNode&&$.parentNode.removeChild($),E&&(this.nativeDraggable&&Q(E,"dragend",this),Nn(E),E.style["will-change"]="",bt&&!at&&ye(E,de?de.options.ghostClass:this.options.ghostClass,!1),ye(E,this.options.chosenClass,!1),pe({sortable:this,name:"unchoose",toEl:ee,newIndex:null,newDraggableIndex:null,originalEvent:e}),Z!==ee?(ve>=0&&(pe({rootEl:ee,name:"add",toEl:ee,fromEl:Z,originalEvent:e}),pe({sortable:this,name:"remove",toEl:ee,originalEvent:e}),pe({rootEl:ee,name:"sort",toEl:ee,fromEl:Z,originalEvent:e}),pe({sortable:this,name:"sort",toEl:ee,originalEvent:e})),de&&de.save()):ve!==lt&&ve>=0&&(pe({sortable:this,name:"update",toEl:ee,originalEvent:e}),pe({sortable:this,name:"sort",toEl:ee,originalEvent:e})),O.active&&((ve==null||ve===-1)&&(ve=lt,Je=St),pe({sortable:this,name:"end",toEl:ee,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){ge("nulling",this),Z=E=ee=B=tt=$=Kt=Ye=$e=Ie=bt=ve=Je=lt=St=it=At=de=Wt=O.dragged=O.ghost=O.clone=O.active=null,ln.forEach(function(e){e.checked=!0}),ln.length=On=qn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":E&&(this._onDragOver(e),Fh(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],s,i=this.el.children,n=0,o=i.length,a=this.options;n<o;n++)s=i[n],ke(s,a.draggable,this.el,!1)&&e.push(s.getAttribute(a.dataIdAttr)||Xh(s));return e},sort:function(e,s){var i={},n=this.el;this.toArray().forEach(function(o,a){var c=n.children[a];ke(c,this.options.draggable,n,!1)&&(i[o]=c)},this),s&&this.captureAnimationState(),e.forEach(function(o){i[o]&&(n.removeChild(i[o]),n.appendChild(i[o]))}),s&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,s){return ke(e,s||this.options.draggable,this.el,!1)},option:function(e,s){var i=this.options;if(s===void 0)return i[e];var n=Ft.modifyOption(this,e,s);typeof n!="undefined"?i[e]=n:i[e]=s,e==="group"&&ni(i)},destroy:function(){ge("destroy",this);var e=this.el;e[be]=null,Q(e,"mousedown",this._onTapStart),Q(e,"touchstart",this._onTapStart),Q(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(Q(e,"dragover",this),Q(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(s){s.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),an.splice(an.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Ye){if(ge("hideClone",this),O.eventCanceled)return;M($,"display","none"),this.options.removeCloneOnHide&&$.parentNode&&$.parentNode.removeChild($),Ye=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Ye){if(ge("showClone",this),O.eventCanceled)return;E.parentNode==Z&&!this.options.group.revertClone?Z.insertBefore($,E):tt?Z.insertBefore($,tt):Z.appendChild($),this.options.group.revertClone&&this.animate(E,$),M($,"display",""),Ye=!1}}};function Fh(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function Xt(t,e,s,i,n,o,a,c){var h,d=t[be],l=d.options.onMove,p;return window.CustomEvent&&!We&&!Vt?h=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(h=document.createEvent("Event"),h.initEvent("move",!0,!0)),h.to=e,h.from=t,h.dragged=s,h.draggedRect=i,h.related=n||e,h.relatedRect=o||oe(e),h.willInsertAfter=c,h.originalEvent=a,t.dispatchEvent(h),l&&(p=l.call(d,h,a)),p}function Nn(t){t.draggable=!1}function Uh(){Kn=!1}function Lh(t,e,s){var i=oe(ht(s.el,0,s.options,!0)),n=$o(s.el,s.options,B),o=10;return e?t.clientX<n.left-o||t.clientY<i.top&&t.clientX<i.right:t.clientY<n.top-o||t.clientY<i.bottom&&t.clientX<i.left}function Wh(t,e,s){var i=oe(us(s.el,s.options.draggable)),n=$o(s.el,s.options,B),o=10;return e?t.clientX>n.right+o||t.clientY>i.bottom&&t.clientX>i.left:t.clientY>n.bottom+o||t.clientX>i.right&&t.clientY>i.top}function Qh(t,e,s,i,n,o,a,c){var h=i?t.clientY:t.clientX,d=i?s.height:s.width,l=i?s.top:s.left,p=i?s.bottom:s.right,_=!1;if(!a){if(c&&Zt<d*n){if(!Pt&&(At===1?h>l+d*o/2:h<p-d*o/2)&&(Pt=!0),Pt)_=!0;else if(At===1?h<l+Zt:h>p-Zt)return-At}else if(h>l+d*(1-n)/2&&h<p-d*(1-n)/2)return Hh(e)}return _=_||a,_&&(h<l+d*o/2||h>p-d*o/2)?h>l+d/2?1:-1:0}function Hh(t){return xe(E)<xe(t)?1:-1}function Xh(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,s=e.length,i=0;s--;)i+=e.charCodeAt(s);return i.toString(36)}function zh(t){ln.length=0;for(var e=t.getElementsByTagName("input"),s=e.length;s--;){var i=e[s];i.checked&&ln.push(i)}}function $t(t){return setTimeout(t,0)}function Zn(t){return clearTimeout(t)}wn&&z(document,"touchmove",function(t){(O.active||at)&&t.cancelable&&t.preventDefault()});O.utils={on:z,off:Q,css:M,find:Jo,is:function(e,s){return!!ke(e,s,e,!1)},extend:Ah,throttle:Yo,closest:ke,toggleClass:ye,clone:Zo,index:xe,nextTick:$t,cancelNextTick:Zn,detectDirection:ti,getChild:ht};O.get=function(t){return t[be]};O.mount=function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];e[0].constructor===Array&&(e=e[0]),e.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(O.utils=qe(qe({},O.utils),i.utils)),Ft.mount(i)})};O.create=function(t,e){return new O(t,e)};O.version=Ih;var se=[],wt,$n,es=!1,Bn,Vn,cn,xt;function Gh(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return t.prototype={dragStarted:function(s){var i=s.originalEvent;this.sortable.nativeDraggable?z(document,"dragover",this._handleAutoScroll):this.options.supportPointer?z(document,"pointermove",this._handleFallbackAutoScroll):i.touches?z(document,"touchmove",this._handleFallbackAutoScroll):z(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(s){var i=s.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?Q(document,"dragover",this._handleAutoScroll):(Q(document,"pointermove",this._handleFallbackAutoScroll),Q(document,"touchmove",this._handleFallbackAutoScroll),Q(document,"mousemove",this._handleFallbackAutoScroll)),$s(),en(),Ph()},nulling:function(){cn=$n=wt=es=xt=Bn=Vn=null,se.length=0},_handleFallbackAutoScroll:function(s){this._handleAutoScroll(s,!0)},_handleAutoScroll:function(s,i){var n=this,o=(s.touches?s.touches[0]:s).clientX,a=(s.touches?s.touches[0]:s).clientY,c=document.elementFromPoint(o,a);if(cn=s,i||this.options.forceAutoScrollFallback||Vt||We||It){Fn(s,this.options,c,i);var h=Ke(c,!0);es&&(!xt||o!==Bn||a!==Vn)&&(xt&&$s(),xt=setInterval(function(){var d=Ke(document.elementFromPoint(o,a),!0);d!==h&&(h=d,en()),Fn(s,n.options,d,i)},10),Bn=o,Vn=a)}else{if(!this.options.bubbleScroll||Ke(c,!0)===Oe()){en();return}Fn(s,this.options,Ke(c,!1),!1)}}},Le(t,{pluginName:"scroll",initializeByDefault:!0})}function en(){se.forEach(function(t){clearInterval(t.pid)}),se=[]}function $s(){clearInterval(xt)}var Fn=Yo(function(t,e,s,i){if(!!e.scroll){var n=(t.touches?t.touches[0]:t).clientX,o=(t.touches?t.touches[0]:t).clientY,a=e.scrollSensitivity,c=e.scrollSpeed,h=Oe(),d=!1,l;$n!==s&&($n=s,en(),wt=e.scroll,l=e.scrollFn,wt===!0&&(wt=Ke(s,!0)));var p=0,_=wt;do{var g=_,b=oe(g),x=b.top,D=b.bottom,q=b.left,A=b.right,I=b.width,X=b.height,le=void 0,J=void 0,Y=g.scrollWidth,Re=g.scrollHeight,ce=M(g),Qe=g.scrollLeft,Ce=g.scrollTop;g===h?(le=I<Y&&(ce.overflowX==="auto"||ce.overflowX==="scroll"||ce.overflowX==="visible"),J=X<Re&&(ce.overflowY==="auto"||ce.overflowY==="scroll"||ce.overflowY==="visible")):(le=I<Y&&(ce.overflowX==="auto"||ce.overflowX==="scroll"),J=X<Re&&(ce.overflowY==="auto"||ce.overflowY==="scroll"));var He=le&&(Math.abs(A-n)<=a&&Qe+I<Y)-(Math.abs(q-n)<=a&&!!Qe),fe=J&&(Math.abs(D-o)<=a&&Ce+X<Re)-(Math.abs(x-o)<=a&&!!Ce);if(!se[p])for(var Me=0;Me<=p;Me++)se[Me]||(se[Me]={});(se[p].vx!=He||se[p].vy!=fe||se[p].el!==g)&&(se[p].el=g,se[p].vx=He,se[p].vy=fe,clearInterval(se[p].pid),(He!=0||fe!=0)&&(d=!0,se[p].pid=setInterval(function(){i&&this.layer===0&&O.active._onTouchMove(cn);var Ne=se[this.layer].vy?se[this.layer].vy*c:0,Te=se[this.layer].vx?se[this.layer].vx*c:0;typeof l=="function"&&l.call(O.dragged.parentNode[be],Te,Ne,t,cn,se[this.layer].el)!=="continue"||Ko(se[this.layer].el,Te,Ne)}.bind({layer:p}),24))),p++}while(e.bubbleScroll&&_!==h&&(_=Ke(_,!1)));es=d}},30),ii=function(e){var s=e.originalEvent,i=e.putSortable,n=e.dragEl,o=e.activeSortable,a=e.dispatchSortableEvent,c=e.hideGhostForTarget,h=e.unhideGhostForTarget;if(!!s){var d=i||o;c();var l=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:s,p=document.elementFromPoint(l.clientX,l.clientY);h(),d&&!d.el.contains(p)&&(a("spill"),this.onSpill({dragEl:n,putSortable:i}))}};function hs(){}hs.prototype={startIndex:null,dragStart:function(e){var s=e.oldDraggableIndex;this.startIndex=s},onSpill:function(e){var s=e.dragEl,i=e.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var n=ht(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(s,n):this.sortable.el.appendChild(s),this.sortable.animateAll(),i&&i.animateAll()},drop:ii};Le(hs,{pluginName:"revertOnSpill"});function ms(){}ms.prototype={onSpill:function(e){var s=e.dragEl,i=e.putSortable,n=i||this.sortable;n.captureAnimationState(),s.parentNode&&s.parentNode.removeChild(s),n.animateAll()},drop:ii};Le(ms,{pluginName:"removeOnSpill"});O.mount(new Gh);O.mount(ms,hs);const Jh={name:"QuoteViewDetail",components:{Card:Ze,QuoteNavBar:nh,EditItemModal:xh,RemoveModal:qt},data(){return{selectedItem:null,selectedInvoiceId:null,editItemsModal:!1,no_items:!0,loading:!0,loading_add:!1,quote:[],quoteItems:[],newItem:{loading_del:!1,item_ref:"",item_name:"",item_category:"Type",item_description:"",quantity:1,vat_rate:0,unit_price:0,discount:0,total_price:0,total_amount:0},vatRate:0,settings:[],list_vats:[],client_detail:[],client_email:null,client_currency:"",default_vat:"",default_currency:"",default_currency_symbol:"",toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},articles:[],categories:[],showDropdown:!1,refs:[],showDropdownRef:!1}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},isQuoteExpired(){const t=new Date().getTime(),e=this.quote.due_date?new Date(this.quote.due_date).getTime():null;return e&&e<t},totalAmountWithoutDiscount(){const t=this.quoteItems.reduce((e,s)=>{const i=s.quantity*s.unit_price;return e+i},0);return this.formatCurrency(t)},totalAmount(){const t=this.quoteItems.reduce((e,s)=>e+parseFloat(s.total_price),0);return this.formatCurrency(t)},totalAmountDefaultCurrency(){return(this.quoteItems.reduce((i,n)=>i+parseFloat(n.total_amount),0)*this.quote.exchange_rate).toFixed(2)},totalAmountWithVAT(){const t=parseFloat(this.totalAmount);if(this.settings.vat_active==1){const e=parseFloat(this.calculateVAT());return this.formatCurrency(t+e)}else return this.formatCurrency(t)},signatureImageUrl(){const t="/wp-json/my-easy-compta/v1/signature-image/",e=myEasyComptaAdmin.nonce;return`${t}${this.quote.file_sign}?_wpnonce=${e}`}},methods:{getUniqueVATRates(){const t=new Set;return this.quoteItems.forEach(e=>{e.vat_rate&&t.add(e.vat_rate)}),Array.from(t)},calculateVATForRate(t){let e=0;return this.quoteItems.forEach(s=>{if(s.vat_rate===t){const i=s.quantity*s.unit_price,n=i*s.discount/100;e+=(i-n)*t/100}}),this.formatCurrency(e)},calculateTotalAmountWithVAT(){let t=this.quoteItems.reduce((e,s)=>e+parseFloat(s.total_amount),0);return this.formatCurrency(t)},fetchQuote(){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/${this.$route.params.id}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{t?(this.quote=t,this.fetchClientInfo(t.client_id)):console.error("Quote not found")}).catch(t=>{console.error("Error fetching quote:",t),this.loading=!1})},fetchClientInfo(t){fetch(`/wp-json/my-easy-compta/v1/clients/details/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Client not found");return e.json()}).then(e=>{this.client_detail=e,this.client_email=e.email;const s=e.currency_id;s&&this.fetchCurrencyDetails(s)}).catch(e=>{console.error("Error fetching client info:",e),this.loading=!1})},fetchItems(){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/${this.$route.params.id}/items`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{t.code=="no_items_found"?(console.error("No items found"),this.quoteItems=[],this.loading=!1,this.no_items=!0):(this.quoteItems=t,this.loading=!1,this.no_items=!1)}).catch(t=>{console.error("Error fetching items:",t),this.loading=!1})},fetchCurrencyDetails(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/settings/currency/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Currency details not found");return this.loading=!1,e.json()}).then(e=>{this.client_currency=e.symbol,this.loading=!1}).catch(e=>{this.loading=!1,console.error("Error fetching currency details:",e)})},updateTotal(){const t=this.newItem.quantity*this.newItem.unit_price,e=t*this.newItem.discount/100,s=t-e;var i=0;if(this.settings.vat_active==1){const n=s*this.newItem.vat_rate/100;i=s+n}else i=s;this.newItem.total_price=this.formatCurrency(s),this.newItem.total_amount=this.formatCurrency(i)},calculateTotalWithVat(t,e,s,i){const n=t*e,o=n*i/100,a=n-o,c=a*s/100,h=a+c;return this.formatCurrency(h)},calculateTotal(t,e,s){const i=t*e,n=i*s/100,a=i-n;return this.formatCurrency(a)},submitItems(){this.updateTotal();const t={...this.newItem,quote_id:this.$route.params.id};this.loading_add=!0,fetch("/wp-json/my-easy-compta/v1/quotes/element-add",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{e.success?(this.loading_add=!1,this.fetchItems(),this.newItem={item_name:"",item_ref:"",item_category:"",item_description:"",quantity:1,vat_rate:this.default_vat.rate,unit_price:0,discount:0,total_price:0,total_amount:0}):(this.showToast(e.message,"alert-error"),console.error("Error submitting item:",e.message),this.loading_add=!1)}).catch(e=>{this.showToast(e.message,"alert-error"),console.error("Error submitting item:",e),this.loading_add=!1})},increase(){this.newItem.quantity++},decrease(){this.newItem.quantity>1&&this.newItem.quantity--},confirmremoveItem(t,e){this.selectedItem=t,this.selectedInvoiceId=e,modal_remove.showModal(),this.showRemoveModal=!0},removeItem(t,e){const s=this.quoteItems.find(i=>i.id===t);s.loading_del=!0,fetch(`/wp-json/my-easy-compta/v1/quotes/element-delete/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({quote_id:e})}).then(i=>i.json()).then(i=>{i.success?(s.loading_del=!1,this.fetchItems()):(this.showToast(i.message,"alert-error"),console.error("Error removing item:",i.message),s.loading_del=!1)}).catch(i=>{this.showToast(i.message,"alert-error"),console.error("Error removing item:",i),s.loading_del=!1})},editItem(t){this.loadingModal=!0,this.editItemsModal=!0,modal_edit_item.showModal(),this.fetchItemDetails(t)},fetchItemDetails(t){fetch(`/wp-json/my-easy-compta/v1/quotes/item-details/${t}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>e.json()).then(e=>{this.selectedItem=e,this.loading=!1}).catch(e=>{console.error("Error fetching item details:",e),this.loading=!1})},formatCurrency(t){const e=t.toFixed(2),s=this.client_currency!==this.default_currency_symbol?this.client_currency:this.default_currency_symbol;return`${e}${s}`},calculateDiscountAmountWithVAT(t,e,s,i){const o=t*e*i/100,a=o*s/100,c=o+a;return this.formatCurrency(c)},calculateDiscountAmount(t,e,s){const o=t*e*s/100;return this.formatCurrency(o)},calculateVAT(){const t=parseFloat(this.totalAmount),e=parseFloat(this.default_vat.rate),s=t*(e/100);return this.formatCurrency(s)},onDragEnd(t){const e=this.quoteItems[t.oldIndex];this.quoteItems.splice(t.oldIndex,1),this.quoteItems.splice(t.newIndex,0,e);const s=this.quoteItems.map(i=>i.id);this.saveOrderToDatabase(s)},nl2br(t){return t?t.replace(/\n/g,"<br>"):""},resize(){let t=this.$refs.textarea;t.style.height="auto",t.style.height=t.scrollHeight+"px"},saveOrderToDatabase(t){fetch("/wp-json/my-easy-compta/v1/quotes/update-quote-items-order",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({order:t})}).then(e=>{e.ok?console.log("Order saved successfully."):console.error("Failed to save order:",e.statusText)}).catch(e=>{console.error("Error saving order:",e)})},fetchCategoriesArticles(){fetch("/wp-json/my-easy-compta/v1/categories-articles",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.categories=t}).catch(t=>console.error("Error fetching categories:",t))},fetchArticles(){if(this.newItem.item_name.length<1){this.articles=[];return}fetch(`/wp-json/my-easy-compta/v1/articles?search=${this.newItem.item_name}&method=name`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.articles=t}).catch(t=>console.error("Error fetching articles:",t))},selectItem(t){this.newItem.item_ref=t.ref,this.newItem.item_name=t.name,this.newItem.item_description=t.description,this.newItem.unit_price=t.unit_price,this.showDropdown=!1,this.showDropdownRef=!1},fetchRefs(){if(this.newItem.item_ref.length<1){this.refs=[];return}fetch(`/wp-json/my-easy-compta/v1/articles?search=${this.newItem.item_ref}&method=ref`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.refs=t}).catch(t=>console.error("Error fetching refrences:",t))},async loadSettings(){try{this.loading=!0,this.loadingPrice=!0;const{settings:t,currencySymbol:e,vatData:s,listVatData:i}=await mn();this.settings=t,this.default_currency_symbol=e,this.default_vat=s,this.list_vats=i,this.newItem.vat_rate=this.default_vat.rate,this.loadingPrice=!1,this.loading=!1}catch(t){this.showToast(t.message,"alert-error"),this.loadingPrice=!1,this.loading=!1}},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)},highlightMatch(t){if(!this.newItem.item_name)return t;const e=new RegExp(`(${this.escapeRegExp(this.newItem.item_name)})`,"gi");return t.replace(e,"<b>$1</b>")},escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},handleClickOutside(t){this.$el.contains(t.target)||(this.showDropdown=!1,this.showDropdownRef=!1)}},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)},mounted(){this.fetchQuote(),this.fetchItems(),this.loadSettings(),this.fetchCategoriesArticles(),document.addEventListener("click",this.handleClickOutside);const t=document.querySelector("tbody");O.create(t,{animation:150,handle:".drag-handle",onEnd:this.onDragEnd})}},Yh={class:"pt-2 pr-4"},Kh={key:1,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},Zh=r("span",{class:"loading loading-spinner text-primary loading-lg"},null,-1),$h=[Zh],em={key:2},tm={role:"alert",class:"alert alert-warning"},nm=r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 shrink-0 stroke-current",fill:"none",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),sm={key:0,class:"relative"},om={class:"ecwp-watermark"},im={class:"grid grid-cols-2"},rm={class:"md:col-span-1"},am=["src"],lm={class:"md:col-span-1 text-right"},cm={class:"text-lg font-semibold"},dm={key:0,class:"badge badge-warning text-white"},um={key:1,class:"badge badge-secondary text-white"},hm={key:2,class:"badge badge-success text-white"},mm={key:3,class:"badge badge-error text-white"},fm={class:"bg-base-300 rounded-lg shadow-md flex justify-between p-4 mt-4 gap-4"},pm=r("br",null,null,-1),_m=r("br",null,null,-1),gm=r("br",null,null,-1),ym=["href"],vm=r("br",null,null,-1),bm=r("br",null,null,-1),wm=r("br",null,null,-1),xm=["href"],Em=r("br",null,null,-1),Cm=["href"],Tm={class:"table mt-8"},Im=r("th",null,null,-1),km={width:"5%"},Sm={width:"19%"},Am={width:"21%"},Pm={width:"10%",class:"text-center"},Dm={width:"8%",class:"text-center"},Rm={key:0,width:"5%",class:"text-center"},jm={key:1,width:"5%"},Om={width:"10%",class:"text-center"},qm={width:"10%",class:"text-right"},Mm=r("th",{width:"18%",class:"text-right inv-actions"},null,-1),Nm=r("td",{class:"draggable-item drag-handle px-2"},[r("i",{class:"fas fa-bars"})],-1),Bm={key:0,class:"badge badge-ghost badge-xs"},Vm=["innerHTML"],Fm={class:"text-center"},Um={class:"text-center"},Lm={key:0},Wm={key:1},Qm={key:0,class:"text-center"},Hm={key:1},Xm={key:2,class:"text-center"},zm=r("br",null,null,-1),Gm={key:3,class:"text-center"},Jm=r("br",null,null,-1),Ym={class:"text-right"},Km={key:0},Zm={key:1},$m=["data-tip"],ef=["onClick"],tf=r("i",{class:"far fa-edit"},null,-1),nf=[tf],sf=["data-tip"],of=["onClick"],rf={key:0,class:"far fa-trash-alt"},af={key:1,class:"loading loading-spinner loading-xs"},lf={key:0},cf=r("td",{class:"px-2"},null,-1),df={class:"align-top px-2"},uf={class:"flex items-center border rounded-md relative"},hf=["placeholder"],mf={key:0,class:"autocomplete-dropdown bg-base-300"},ff=["onClick","innerHTML"],pf={class:"align-top px-2"},_f=r("option",{disabled:"",selected:""},"Type",-1),gf=["value"],yf={class:"flex items-center border rounded-md relative"},vf=["placeholder"],bf={key:0,class:"autocomplete-dropdown bg-base-300"},wf=["onClick","innerHTML"],xf={class:"align-top"},Ef={class:"flex items-center rounded-md"},Cf=["placeholder"],Tf={class:"align-top"},If={class:"flex items-center border rounded-lg"},kf={class:"inline-flex"},Sf=["placeholder"],Af={class:"align-top"},Pf={class:"flex items-center border rounded-md"},Df=["placeholder"],Rf={key:0,class:"align-top"},jf=["value"],Of={key:1,class:"align-top"},qf={class:"align-top"},Mf={class:"flex items-center border rounded-md"},Nf=["placeholder"],Bf=r("div",{class:"px-3 py-2.5 rounded-l-md bg-base-300 border-r"}," % ",-1),Vf={key:2,class:"text-right"},Ff={key:3,class:"text-right"},Uf=["data-tip"],Lf={type:"submit",class:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"},Wf={key:0,class:"fa fa-plus"},Qf={key:1,class:"loading loading-spinner loading-xs"},Hf={colspan:"8",class:"text-right no-border"},Xf={class:"text-right"},zf={key:0,class:"line-through"},Gf=r("td",null,null,-1),Jf={colspan:"8",class:"text-right no-border"},Yf={class:"text-right"},Kf=r("td",null,null,-1),Zf={colspan:"8",class:"text-right no-border font-bold text-xl"},$f={class:"text-right no-border font-bold text-xl"},ep=r("td",null,null,-1),tp={key:2},np={colspan:"8",class:"text-right no-border"},sp={class:"text-right no-border"},op={key:3},ip={colspan:"8",class:"text-right no-border"},rp={class:"text-right no-border font-bold text-xl"},ap={key:1,class:"relative"},lp={class:"flex justify-end mt-4"},cp={class:"border-2 border-slate-300 max-w-md"},dp=["src"];function up(t,e,s,i,n,o){const a=N("QuoteNavBar"),c=N("remove-modal"),h=N("edit-item-modal"),d=N("Card");return m(),f("div",Yh,[j(a,{quoteInfo:n.quote,emailActive:n.settings.easy_compta_email_addon_active,advanceActive:n.settings.easy_compta_advance_addon_active,currency:n.default_currency_symbol,noItems:n.no_items},null,8,["quoteInfo","emailActive","advanceActive","currency","noItems"]),n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),j(c,{"show-modal":t.showRemoveModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_delete_it,cancelText:o.translations.cancel,onConfirm:e[0]||(e[0]=l=>this.removeItem(n.selectedItem,n.selectedInvoiceId)),onCancel:e[1]||(e[1]=l=>t.showRemoveModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),n.loading?(m(),f("div",Kh,$h)):y("",!0),o.isQuoteExpired&&n.quote.status=="pending"?(m(),f("div",em,[r("div",tm,[nm,r("span",null,u(o.translations.quote_expired),1)])])):y("",!0),j(d,{topMargin:"mt-8",id:"quote-content"},{default:me(()=>[n.settings.easy_compta_signature_addon_active&&n.quote.signed==1?(m(),f("div",sm,[r("span",om,u(o.translations.signed),1)])):y("",!0),r("div",im,[r("div",rm,[r("div",null,[r("img",{src:n.settings.logo_url,style:no({width:n.settings.logo_width+"px"}),alt:"Logo"},null,12,am)])]),r("div",lm,[r("p",cm,u(n.quote.quote_number),1),r("div",null,[C(u(o.translations.created_at)+": ",1),r("strong",null,u(n.quote.created_at),1)]),r("div",null,[C(u(o.translations.due_date)+": ",1),r("strong",null,u(n.quote.due_date),1)]),r("div",null,[C(u(o.translations.provisional_date)+": ",1),r("strong",null,u(n.quote.provisional_start_date),1)]),r("div",null,[C(u(o.translations.status)+": ",1),n.quote.status=="draft"?(m(),f("span",dm,u(o.translations.draft),1)):y("",!0),n.quote.status=="pending"?(m(),f("span",um,u(o.translations.pending),1)):y("",!0),n.quote.status=="approved"?(m(),f("span",hm,u(o.translations.approved),1)):y("",!0),n.quote.status=="rejected"?(m(),f("span",mm,u(o.translations.rejected),1)):y("",!0)])])]),r("div",fm,[r("div",null,[r("strong",null,u(o.translations.bill_to)+":",1),r("h4",null,[r("strong",null,u(n.client_detail.company_name),1)]),r("p",null,[C(u(n.client_detail.address),1),pm,C(" "+u(n.client_detail.postal_code)+", "+u(n.client_detail.city)+" ",1),_m,C(" "+u(n.client_detail.country),1),gm,n.client_detail.phone?(m(),f("a",{key:0,href:"tel:"+n.client_detail.phone},u(n.client_detail.phone),9,ym)):y("",!0)])]),r("div",null,[r("strong",null,u(o.translations.received_from)+":",1),r("h4",null,[r("strong",null,u(n.settings.company_name),1)]),r("p",null,[C(u(n.settings.company_address),1),vm,C(" "+u(n.settings.postal_code)+", "+u(n.settings.city)+" ",1),bm,C(" "+u(n.settings.country),1),wm,n.settings.company_phone?(m(),f("a",{key:0,href:"tel:"+n.settings.company_phone},u(n.settings.company_phone),9,xm)):y("",!0),Em,n.settings.mobile_phone?(m(),f("a",{key:1,href:"tel:"+n.settings.mobile_phone},u(n.settings.mobile_phone),9,Cm)):y("",!0)])])]),j(h,{loading:t.loadingModal,"show-modal":n.editItemsModal,"modal-id":"modal_edit_item","modal-title":o.translations.edit_item,item:n.selectedItem,onClose:e[2]||(e[2]=l=>n.editItemsModal=!1),onItemEdited:o.fetchItems},null,8,["loading","show-modal","modal-title","item","onItemEdited"]),r("form",{onSubmit:e[22]||(e[22]=te((...l)=>o.submitItems&&o.submitItems(...l),["prevent"]))},[r("table",Tm,[r("thead",null,[r("tr",null,[Im,r("th",km,u(o.translations.item_ref),1),r("th",Sm,u(o.translations.item_name),1),r("th",Am,u(o.translations.description),1),r("th",Pm,u(o.translations.quantity),1),r("th",Dm,u(o.translations.unit_price),1),n.settings.vat_active==1?(m(),f("th",Rm,u(o.translations.vat),1)):(m(),f("th",jm)),r("th",Om,u(o.translations.discount),1),r("th",qm,u(o.translations.total),1),Mm])]),r("tbody",null,[(m(!0),f(U,null,L(n.quoteItems,(l,p)=>(m(),f("tr",{key:l.id||p},[Nm,r("td",null,u(l.item_ref),1),r("td",null,[l.category_name?(m(),f("div",Bm,u(l.category_name),1)):y("",!0),r("div",null,u(l.item_name),1)]),r("td",{innerHTML:o.nl2br(l.item_description)},null,8,Vm),r("td",Fm,u(l.quantity),1),r("td",Um,[C(u(l.unit_price),1),n.default_currency_symbol==n.client_currency?(m(),f("span",Lm,u(n.default_currency_symbol),1)):(m(),f("span",Wm,u(n.client_currency),1))]),n.settings.vat_active==1?(m(),f("td",Qm,u(l.vat_rate)+"% ",1)):(m(),f("td",Hm)),n.settings.vat_active==1?(m(),f("td",Xm,[C(u(l.discount)+"% ",1),zm,C(" "+u(o.calculateDiscountAmountWithVAT(l.quantity,l.unit_price,l.vat_rate,l.discount)),1)])):(m(),f("td",Gm,[C(u(l.discount)+"% ",1),Jm,C(" "+u(o.calculateDiscountAmount(l.quantity,l.unit_price,l.discount)),1)])),r("td",Ym,[C(u(l.total_amount)+" ",1),n.default_currency_symbol==n.client_currency?(m(),f("span",Km,u(n.default_currency_symbol),1)):(m(),f("span",Zm,u(n.client_currency),1))]),r("td",null,[n.quote.status=="draft"||n.quote.status=="pending"?(m(),f("span",{key:0,class:"lg:tooltip","data-tip":o.translations.edit},[r("button",{onClick:te(_=>o.editItem(l.id),["prevent"]),class:"bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-3 rounded"},nf,8,ef)],8,$m)):y("",!0),n.quote.status=="draft"||n.quote.status=="pending"?(m(),f("span",{key:1,class:"lg:tooltip","data-tip":o.translations.delete},[r("button",{onClick:te(_=>o.confirmremoveItem(l.id,n.quote.id),["prevent"]),class:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-3 mx-2 rounded"},[l.loading_del?y("",!0):(m(),f("i",rf)),l.loading_del?(m(),f("span",af)):y("",!0)],8,of)],8,sf)):y("",!0)])]))),128)),n.quote.status=="draft"||n.quote.status=="pending"?(m(),f("tr",lf,[cf,r("td",df,[r("div",uf,[P(r("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=l=>n.newItem.item_ref=l),onInput:e[4]||(e[4]=(...l)=>o.fetchRefs&&o.fetchRefs(...l)),onFocus:e[5]||(e[5]=l=>n.showDropdownRef=!0),placeholder:o.translations.item_ref,class:"w-full p-2.5 bg-transparent input-xs outline-none"},null,40,hf),[[H,n.newItem.item_ref]]),n.showDropdownRef&&n.refs.length?(m(),f("ul",mf,[(m(!0),f(U,null,L(n.refs,l=>(m(),f("li",{key:l.ref,onClick:p=>o.selectItem(l),class:"autocomplete-item hover:bg-base-200",innerHTML:o.highlightMatch(l.ref)},null,8,ff))),128))])):y("",!0)])]),r("td",pf,[P(r("select",{class:"select select-xs w-full mb-1 ecwp-select","onUpdate:modelValue":e[6]||(e[6]=l=>n.newItem.item_category=l)},[_f,(m(!0),f(U,null,L(n.categories,l=>(m(),f("option",{key:l.id,value:l.id},u(l.name),9,gf))),128))],512),[[ue,n.newItem.item_category]]),r("div",yf,[P(r("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=l=>n.newItem.item_name=l),onInput:e[8]||(e[8]=(...l)=>o.fetchArticles&&o.fetchArticles(...l)),onFocus:e[9]||(e[9]=l=>n.showDropdown=!0),placeholder:o.translations.item_name,class:"w-full p-2.5 bg-transparent input-xs outline-none"},null,40,vf),[[H,n.newItem.item_name]]),n.showDropdown&&n.articles.length?(m(),f("ul",bf,[(m(!0),f(U,null,L(n.articles,l=>(m(),f("li",{key:l.name,onClick:p=>o.selectItem(l),class:"autocomplete-item hover:bg-base-200",innerHTML:o.highlightMatch(l.name)},null,8,wf))),128))])):y("",!0)])]),r("td",xf,[r("div",Ef,[P(r("textarea",{"onUpdate:modelValue":e[10]||(e[10]=l=>n.newItem.item_description=l),placeholder:o.translations.item_description,class:"textarea textarea-bordered input-xs w-full",onInput:e[11]||(e[11]=l=>o.resize()),ref:"textarea"},null,40,Cf),[[H,n.newItem.item_description]])])]),r("td",Tf,[r("div",If,[r("div",kf,[r("div",{class:"select-none border py-3 px-2 cursor-pointer bg-base-300 hover:bg-gray-200 rounded-l",onClick:e[12]||(e[12]=(...l)=>o.decrease&&o.decrease(...l))}," - "),P(r("input",{type:"text",pattern:"([0-9]+.{0,1}[0-9]*,{0,1})*[0-9]","onUpdate:modelValue":e[13]||(e[13]=l=>n.newItem.quantity=l),placeholder:o.translations.quantity,class:"w-full p-2.5 bg-transparent outline-none max-w-40 min-w-10",onInput:e[14]||(e[14]=(...l)=>o.updateTotal&&o.updateTotal(...l))},null,40,Sf),[[H,n.newItem.quantity]]),r("div",{class:"select-none border py-3 px-2 cursor-pointer bg-base-300 hover:bg-gray-200 rounded-r",onClick:e[15]||(e[15]=(...l)=>o.increase&&o.increase(...l))}," + ")])])]),r("td",Af,[r("div",Pf,[P(r("input",{type:"text",pattern:"([0-9]+.{0,1}[0-9]*,{0,1})*[0-9]","onUpdate:modelValue":e[16]||(e[16]=l=>n.newItem.unit_price=l),placeholder:o.translations.unit_price,class:"w-full p-2.5 bg-transparent outline-none max-w-40 min-w-10",onInput:e[17]||(e[17]=(...l)=>o.updateTotal&&o.updateTotal(...l))},null,40,Df),[[H,n.newItem.unit_price]])])]),n.settings.vat_active==1?(m(),f("td",Rf,[P(r("select",{"onUpdate:modelValue":e[18]||(e[18]=l=>n.newItem.vat_rate=l),onChange:e[19]||(e[19]=(...l)=>o.updateTotal&&o.updateTotal(...l)),class:"select select-md w-full mb-1 ecwp-select min-w-20"},[(m(!0),f(U,null,L(n.list_vats,l=>(m(),f("option",{key:l,value:l.rate},u(l.rate)+"% ",9,jf))),128))],544),[[ue,n.newItem.vat_rate]])])):(m(),f("td",Of)),r("td",qf,[r("div",Mf,[P(r("input",{type:"number",min:"0",max:"100","onUpdate:modelValue":e[20]||(e[20]=l=>n.newItem.discount=l),placeholder:o.translations.discount,class:"w-full p-2.5 bg-transparent outline-none max-w-40 min-w-10",onInput:e[21]||(e[21]=(...l)=>o.updateTotal&&o.updateTotal(...l))},null,40,Nf),[[H,n.newItem.discount]]),Bf])]),n.settings.vat_active==1?(m(),f("td",Vf,u(o.calculateTotalWithVat(n.newItem.quantity,n.newItem.unit_price,n.newItem.vat_rate,n.newItem.discount)),1)):(m(),f("td",Ff,u(o.calculateTotal(n.newItem.quantity,n.newItem.unit_price,n.newItem.discount)),1)),r("td",null,[r("span",{class:"lg:tooltip","data-tip":o.translations.add},[r("button",Lf,[n.loading_add?y("",!0):(m(),f("i",Wf)),n.loading_add?(m(),f("span",Qf)):y("",!0)])],8,Uf)])])):y("",!0),r("tr",null,[r("td",Hf,[r("strong",null,u(o.translations.subtotal),1)]),r("td",Xf,[o.totalAmount!==o.totalAmountWithoutDiscount?(m(),f("span",zf,u(o.totalAmountWithoutDiscount),1)):y("",!0),C(" "+u(o.totalAmount),1)]),Gf]),n.settings.vat_active==1?(m(!0),f(U,{key:1},L(o.getUniqueVATRates(),(l,p)=>(m(),f("tr",{key:p},[r("td",Jf,[r("strong",null,u(o.translations.tax)+" ("+u(l)+"%) ",1)]),r("td",Yf,u(o.calculateVATForRate(l)),1),Kf]))),128)):y("",!0),r("tr",null,[r("td",Zf,[r("strong",null,u(o.translations.total),1)]),r("td",$f,u(o.calculateTotalAmountWithVAT()),1),ep]),n.client_currency!=n.default_currency_symbol?(m(),f("tr",tp,[r("td",np,[r("strong",null,u(o.translations.exchange_rate),1)]),r("td",sp,u(n.quote.exchange_rate),1)])):y("",!0),n.client_currency!=n.default_currency_symbol?(m(),f("tr",op,[r("td",ip,[r("strong",null,u(o.translations.total)+" "+u(n.default_currency_symbol),1)]),r("td",rp,u(o.totalAmountDefaultCurrency)+u(n.default_currency_symbol),1)])):y("",!0)])])],32),n.settings.easy_compta_signature_addon_active&&n.quote.signed==1&&n.quote.file_sign?(m(),f("div",ap,[r("div",lp,[r("span",cp,[r("img",{src:o.signatureImageUrl,alt:"Signature"},null,8,dp)])])])):y("",!0)]),_:1})])}var hp=re(Jh,[["render",up]]);const mp={name:"QuoteNew",components:{Card:Ze,ModelSelect:hn,VueDatePicker:Mt,AddClientModal:Ro},data(){return{clientOptions:[],clients:[],quote:{number:"",due_date:"",provisional_start_date:"",client_id:"",status:""},showError:!1,loading:!1,loadingBtn:!1,settings:[],last_quote_number:"",toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},formattedDate(){return t=>{if(!t)return"";const e=t.getDate().toString().padStart(2,"0"),s=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getFullYear();return`${e}-${s}-${i}`}}},mounted(){this.fetchClients(),this.fetchSettings()},methods:{AddNew(){modal_clients.showModal()},cancelAction(){this.$router.push("/quotes")},fetchClients(){this.loading=!0,fetch("/wp-json/my-easy-compta/v1/list-clients",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.clients=t.clients,this.clientOptions=this.clients.map(e=>({value:e.id,text:`${e.company_name} - ${e.email} (${e.currency_symbol})`}))}).catch(t=>{console.error("Error fetching clients:",t)}).finally(()=>{this.loading=!1})},customLabel(t){return t.text},async fetchSettings(){try{this.loading=!0;const t=await fetch("/wp-json/my-easy-compta/v1/settings/get",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}});if(this.loading=!1,t.ok){const e=await t.json();this.settings=e;const s=`${this.settings.quote_prefix}_${String(this.settings.last_quote_id).padStart(4,"0")}`;this.quote.number=s}else{const e=await t.json()}}catch{this.loading=!1}},submitQuote(){if(!this.quote.due_date||!this.quote.provisional_start_date||!this.quote.client_id||!this.quote.status){this.showError=!0,this.showToast("Veuillez remplir tous les champs obligatoires.","alert-error");return}this.loadingBtn=!0,fetch("/wp-json/my-easy-compta/v1/quotes",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.quote)}).then(t=>{if(!t.ok)throw this.loadingBtn=!1,new Error("Network response was not ok");return t.json()}).then(t=>{t.success?(this.loadingBtn=!1,this.showToast(t.message,"alert-success"),this.$router.push({name:"QuoteViewDetail",params:{id:t.id}})):(this.loadingBtn=!1,console.error("Error submitting quote:",t.message),this.showToast(t.message,"alert-error"))}).catch(t=>{this.loadingBtn=!1,console.error("Error submitting quote:",t),this.showToast(t,"alert-error")})},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},fp={class:"pt-2 pr-4"},pp={class:"flex justify-between items-center mb-4"},_p={class:"card-title"},gp=r("div",{class:"divider mt-2"},null,-1),yp={key:0,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},vp={class:"grid grid-cols-3 gap-4"},bp={class:"ecwp-group form-group mb-4"},wp={for:"quoteNumber",class:"ecwp-label"},xp={class:"ecwp-group form-group mb-4"},Ep={for:"quoteDate",class:"ecwp-label"},Cp={class:"ecwp-group form-group mb-4"},Tp={for:"quoteDatePr",class:"ecwp-label"},Ip={class:"grid grid-cols-2 gap-4"},kp={class:"mb-4"},Sp={class:"flex gap-2 items-end"},Ap=r("i",{class:"fas fa-plus"},null,-1),Pp=[Ap],Dp={class:"ecwp-group form-group w-full"},Rp={for:"client",class:"ecwp-label"},jp={class:"ecwp-group form-group mb-4"},Op={for:"status",class:"ecwp-label"},qp={value:"draft",selected:""},Mp={value:"pending"},Np={value:"approved"},Bp={value:"rejected"},Vp={class:"flex justify-between"},Fp=["disabled"],Up={key:0,class:"loading loading-spinner loading-sm"};function Lp(t,e,s,i,n,o){const a=N("VueDatePicker"),c=N("model-select"),h=N("Card"),d=N("AddClientModal");return m(),f("div",fp,[n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),j(h,{topMargin:"mt-8",modalType:"modal_quote_new"},{default:me(()=>[r("div",pp,[r("h2",_p,u(o.translations.new_quote),1)]),gp,n.loading?(m(),f("div",yp)):y("",!0),r("form",{onSubmit:e[7]||(e[7]=te((...l)=>o.submitQuote&&o.submitQuote(...l),["prevent"]))},[r("div",vp,[r("div",bp,[r("label",wp,u(o.translations.quote_number),1),P(r("input",{type:"text",id:"quoteNumber","onUpdate:modelValue":e[0]||(e[0]=l=>n.quote.number=l),class:"ecwp-input input input-bordered w-full",disabled:"disabled"},null,512),[[H,n.quote.number]])]),r("div",xp,[r("label",Ep,u(o.translations.due_date),1),j(a,{class:S(["ecwp-input ecwp-date input input-bordered w-full",[!n.quote.due_date&&n.showError?"input-error":""]]),id:"quoteDate",modelValue:n.quote.due_date,"onUpdate:modelValue":e[1]||(e[1]=l=>n.quote.due_date=l),"enable-time-picker":!1,"auto-apply":"",format:o.formattedDate,"min-date":new Date,locale:"fr"},null,8,["class","modelValue","format","min-date"])]),r("div",Cp,[r("label",Tp,u(o.translations.provisional_date),1),j(a,{class:S(["ecwp-input ecwp-date input input-bordered w-full",[!n.quote.provisional_start_date&&n.showError?"input-error":""]]),id:"quoteDatePr",modelValue:n.quote.provisional_start_date,"onUpdate:modelValue":e[2]||(e[2]=l=>n.quote.provisional_start_date=l),"enable-time-picker":!1,"auto-apply":"",format:o.formattedDate,"min-date":new Date,locale:"fr"},null,8,["class","modelValue","format","min-date"])])]),r("div",Ip,[r("div",kp,[r("div",Sp,[r("button",{type:"button",class:"btn btn-primary",onClick:e[3]||(e[3]=(...l)=>o.AddNew&&o.AddNew(...l))},Pp),r("div",Dp,[r("label",Rp,u(o.translations.company_name),1),j(c,{modelValue:n.quote.client_id,"onUpdate:modelValue":e[4]||(e[4]=l=>n.quote.client_id=l),options:n.clientOptions,label:"text","track-by":"value",placeholder:o.translations.select,class:S(["ecwp-input input input-bordered w-full",[!n.quote.client_id&&n.showError?"input-error":""]])},null,8,["modelValue","options","placeholder","class"])])])]),r("div",jp,[r("label",Op,u(o.translations.status),1),P(r("select",{id:"status","onUpdate:modelValue":e[5]||(e[5]=l=>n.quote.status=l),class:S(["ecwp-input select select-bordered w-full",[!n.quote.status&&n.showError?"input-error":""]])},[r("option",qp,u(o.translations.draft),1),r("option",Mp,u(o.translations.pending),1),r("option",Np,u(o.translations.approved),1),r("option",Bp,u(o.translations.rejected),1)],2),[[ue,n.quote.status]])])]),r("div",Vp,[r("button",{type:"button",class:"btn btn-secondary rounded-full",onClick:e[6]||(e[6]=(...l)=>o.cancelAction&&o.cancelAction(...l))},u(o.translations.cancel),1),r("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[C(u(o.translations.submit)+" ",1),n.loadingBtn?(m(),f("span",Up)):y("",!0)],8,Fp)])],32)]),_:1}),j(d,{onClientAdded:o.fetchClients},null,8,["onClientAdded"])])}var Wp=re(mp,[["render",Lp]]);const Qp={name:"InvoicesList",components:{Card:Ze,RemoveModal:qt},data(){return{invoices:[],filteredInvoices:[],filters:{invoice_number:"",client:"",status:"",total_amount:"",due_date:"",created_at:""},showInvoiceDetailsModal:!1,editInvoiceModal:!1,selectedInvoice:null,currentPage:1,totalCount:0,totalPages:1,paginationButtons:[],loading:!0,loadingPrice:!0,loadingModal:!1,skeletonRows:5,perPage:10,perPageOptions:[5,10,20,50],client_currency:"",default_vat:"",default_currency:"",default_currency_symbol:"",settings:{},toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},created(){this.fetchInvoices(),this.fetchClients(),this.loadSettings()},methods:{fetchInvoices(t=1){this.loading=!0;const{perPage:e}=this;fetch(`/wp-json/my-easy-compta/v1/invoices?page=${t}&per_page=${e}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(s=>s.json()).then(s=>{this.invoices=s.invoices,this.totalCount=s.total_count,this.totalPages=s.total_pages,this.currentPage=t,this.perPage=e,this.generatePaginationButtons()}).catch(s=>{console.error("Error fetching invoices:",s)}).finally(()=>{this.loading=!1})},fetchInvoicesWithFilters(t=1){this.loading=!0;const{perPage:e,filters:s}=this,i=new URLSearchParams({page:t,per_page:e,...s}).toString();fetch(`/wp-json/my-easy-compta/v1/invoices?${i}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(n=>n.json()).then(n=>{this.invoices=n.invoices,this.totalCount=n.total_count,this.totalPages=n.total_pages,this.currentPage=t,this.perPage=e,this.generatePaginationButtons()}).catch(n=>{console.error("Error fetching invoices with filters:",n)}).finally(()=>{this.loading=!1})},fetchClients(){fetch("/wp-json/my-easy-compta/v1/clients",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.clients=t.clients}).catch(t=>{console.error("Error fetching clients:",t)})},async loadSettings(){try{this.loadingPrice=!0;const{settings:t,currencySymbol:e,vatData:s}=await mn();this.settings=t,this.default_currency_symbol=e,this.default_vat=s,this.loadingPrice=!1}catch(t){this.showToast(t.message,"alert-error"),this.loadingPrice=!1}},calculateVAT(t){return so(t,this.default_vat.rate)},calculateWithoutVAT(t){return oo(t)},generatePaginationButtons(){this.paginationButtons=io(this.currentPage,this.totalPages)},goToPage(t){t!=="..."&&this.fetchInvoicesWithFilters(t)},perPageChanged(){this.fetchInvoicesWithFilters()},formatAmount(t,e){return ro(t,e,this.settings.currency_position)},showToast(t,e){ao(this.toast,t,e)},confirmDeleteInvoice(t){this.selectedInvoice=t,modal_remove.showModal(),this.showRemoveModal=!0},deleteInvoice(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/invoices/delete/${t}`,{method:"DELETE",headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{e.success?(this.fetchInvoices(),this.showToast(e.message,"alert-success")):(this.showToast(e.message,"alert-error"),console.error("Error deleting invoice:",e.statusText))}).catch(e=>{console.log(e.message);const s=e&&e.message?e.message:"Error deleting client";s==="This client cannot be deleted because it has associated data."?this.showToast(s,"alert-error"):console.error("Error deleting client:",e)})}},computed:{skeletonItems(){return Array.from({length:5},(t,e)=>e)},totalPages(){return Math.ceil(this.totalCount/this.perPage)},translations(){return window.myEasyComptaAdmin.easyComptaTranslations}}},Hp={class:"pt-2 pr-4"},Xp={class:"flex justify-between items-center"},zp={class:"card-title"},Gp={class:"btn btn-primary rounded-full"},Jp=r("i",{class:"fas fa-plus-circle"},null,-1),Yp={key:0,class:"ms-2"},Kp={class:"btn btn-outline btn-accent rounded-full hover:text-white",href:"/wp-admin/admin.php?page=my-easy-compta-export#tab3"},Zp=r("i",{class:"fas fa-file-export"},null,-1),$p=["data-tip"],e_={class:"btn btn-outline btn-accent rounded-full",disabled:""},t_=r("i",{class:"fas fa-file-export"},null,-1),n_=r("div",{class:"divider mt-2"},null,-1),s_={class:"flex items-center mb-4"},o_={for:"perPageSelect",class:"mr-2"},i_=["value"],r_={class:"overflow-x-auto"},a_={class:"table w-full"},l_={value:""},c_=["value"],d_={value:""},u_={value:"draft"},h_={value:"unpaid"},m_={value:"paid"},f_={class:"flex justify-center"},p_={key:0},__={key:0,class:"badge badge-primary badge-outline badge-sm mr-2"},g_={key:0,class:"badge badge-scondary badge-outline badge-sm"},y_={key:1,class:"badge badge-warning badge-outline badge-sm"},v_={key:2,class:"badge badge-success badge-outline badge-sm"},b_={key:3,class:"badge badge-error badge-outline badge-sm ms-2"},w_={key:0},x_={key:0},E_={key:0},C_={key:1},T_={key:0},I_={key:1},k_={key:1},S_=r("span",{class:"loading loading-bars loading-sm"},null,-1),A_=[S_],P_={key:0},D_={key:1},R_=r("span",{class:"loading loading-bars loading-sm"},null,-1),j_=[R_],O_={key:0},q_={key:1},M_=r("span",{class:"loading loading-bars loading-sm"},null,-1),N_=[M_],B_={class:"flex justify-end"},V_=["data-tip"],F_=r("button",{class:"btn btn-circle mx-1"},[r("i",{class:"far fa-eye"})],-1),U_=["data-tip"],L_=r("button",{class:"btn btn-circle mx-1"},[r("i",{class:"fas fa-pencil-alt"})],-1),W_=["data-tip"],Q_=["onClick"],H_=r("i",{class:"far fa-trash-alt"},null,-1),X_=[H_],z_={key:0},G_=r("div",{class:"flex gap-4 items-center"},[r("div",{class:"skeleton w-16 h-16 rounded-full shrink-0"}),r("div",{class:"flex flex-col gap-4 w-full"},[r("div",{class:"skeleton h-4 w-full"}),r("div",{class:"skeleton h-4 w-full"})])],-1),J_=r("div",{class:"divider my-1"},null,-1),Y_=[G_,J_],K_={class:"join ecwp_pagination mt-6 pt-4"},Z_=["onClick"];function $_(t,e,s,i,n,o){const a=N("remove-modal"),c=N("router-link"),h=N("Card");return m(),f("div",Hp,[n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),j(a,{"show-modal":t.showRemoveModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_delete_it,cancelText:o.translations.cancel,onConfirm:e[0]||(e[0]=d=>this.deleteInvoice(n.selectedInvoice)),onCancel:e[1]||(e[1]=d=>t.showRemoveModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),j(h,{topMargin:"mt-8"},{default:me(()=>[r("div",Xp,[r("h2",zp,u(o.translations.invoices),1),r("div",null,[j(c,{to:{name:"InvoiceNew"}},{default:me(()=>[r("button",Gp,[C(u(o.translations.add)+" ",1),Jp])]),_:1}),n.settings.easy_compta_export_addon_active==1?(m(),f("span",Yp,[r("a",Kp,[C(u(o.translations.export)+" ",1),Zp])])):(m(),f("span",{key:1,class:"tooltip tooltip-left tooltip-warning ms-2","data-tip":o.translations.active_export_addon},[r("button",e_,[C(u(o.translations.export)+" ",1),t_])],8,$p))])]),n_,r("div",s_,[r("label",o_,u(o.translations.display_per_page),1),P(r("select",{id:"perPageSelect","onUpdate:modelValue":e[2]||(e[2]=d=>n.perPage=d),onChange:e[3]||(e[3]=(...d)=>o.perPageChanged&&o.perPageChanged(...d))},[(m(!0),f(U,null,L(n.perPageOptions,d=>(m(),f("option",{key:d,value:d},u(d),9,i_))),128))],544),[[ue,n.perPage]])]),r("div",r_,[r("table",a_,[r("thead",null,[r("tr",null,[r("th",null,[r("div",null,u(o.translations.invoice_number),1),P(r("input",{"onUpdate:modelValue":e[4]||(e[4]=d=>n.filters.invoice_number=d),onInput:e[5]||(e[5]=d=>o.fetchInvoicesWithFilters()),type:"text",class:"ecwp-input input-xs input-bordered mt-2"},null,544),[[H,n.filters.invoice_number]])]),r("th",null,[r("div",null,u(o.translations.client),1),P(r("select",{"onUpdate:modelValue":e[6]||(e[6]=d=>n.filters.client=d),onChange:e[7]||(e[7]=d=>o.fetchInvoicesWithFilters()),class:"ecwp-input input-xs input-bordered mt-2"},[r("option",l_,u(o.translations.all),1),(m(!0),f(U,null,L(t.clients,d=>(m(),f("option",{key:d.id,value:d.company_name},u(d.company_name),9,c_))),128))],544),[[ue,n.filters.client]])]),r("th",null,[r("div",null,u(o.translations.status),1),P(r("select",{"onUpdate:modelValue":e[8]||(e[8]=d=>n.filters.status=d),onChange:e[9]||(e[9]=d=>o.fetchInvoicesWithFilters()),class:"ecwp-input input-xs input-bordered mt-2"},[r("option",d_,u(o.translations.all_statuses),1),r("option",u_,u(o.translations.draft),1),r("option",h_,u(o.translations.unpaid),1),r("option",m_,u(o.translations.paid),1)],544),[[ue,n.filters.status]])]),r("th",null,[r("div",null,u(o.translations.total),1),P(r("input",{"onUpdate:modelValue":e[10]||(e[10]=d=>n.filters.total_amount=d),onInput:e[11]||(e[11]=d=>o.fetchInvoicesWithFilters()),type:"text",class:"ecwp-input input-xs input-bordered mt-2"},null,544),[[H,n.filters.total_amount]])]),r("th",null,[r("div",null,u(o.translations.due_date),1),P(r("input",{"onUpdate:modelValue":e[12]||(e[12]=d=>n.filters.due_date=d),onInput:e[13]||(e[13]=d=>o.fetchInvoicesWithFilters()),type:"date",class:"ecwp-input input-xs input-bordered mt-2"},null,544),[[H,n.filters.due_date]])]),r("th",null,[r("div",null,u(o.translations.created_at),1),P(r("input",{"onUpdate:modelValue":e[14]||(e[14]=d=>n.filters.created_at=d),onInput:e[15]||(e[15]=d=>o.fetchInvoicesWithFilters()),type:"date",class:"ecwp-input input-xs input-bordered mt-2"},null,544),[[H,n.filters.created_at]])]),r("th",f_,u(o.translations.actions),1)])]),n.loading?y("",!0):(m(),f("tbody",p_,[(m(!0),f(U,null,L(n.invoices,d=>(m(),f("tr",{key:d.id},[r("td",null,[d.advance==1?(m(),f("span",__,u(o.translations.advance),1)):y("",!0),C(u(d.invoice_number),1)]),r("td",null,u(d.client_name),1),r("td",null,[d.status=="draft"?(m(),f("span",g_,u(o.translations.draft),1)):y("",!0),d.status=="unpaid"?(m(),f("span",y_,u(o.translations.unpaid),1)):y("",!0),d.status=="paid"?(m(),f("span",v_,u(o.translations.paid),1)):y("",!0),d.credit=="1"?(m(),f("span",b_,u(o.translations.credit),1)):y("",!0)]),r("td",null,[n.loadingPrice?(m(),f("div",k_,A_)):(m(),f("div",w_,[n.settings.easy_compta_advance_addon_active&&d.advance==1?(m(),f("div",x_,u(o.formatAmount(d.advance_amount,d.client_currency||n.default_currency_symbol)),1)):y("",!0),n.settings.vat_active==1?(m(),f("div",{key:1,class:S({"text-xs":d.advance==1})},[n.default_currency_symbol==d.client_currency||d.client_currency==null?(m(),f("span",E_,u(o.formatAmount(d.total_amount,n.default_currency_symbol)),1)):(m(),f("span",C_,u(o.formatAmount(d.total_amount,d.client_currency)),1))],2)):(m(),f("div",{key:2,class:S({"text-xs":d.advance==1})},[n.default_currency_symbol==d.client_currency||d.client_currency==null?(m(),f("span",T_,u(o.formatAmount(d.total_amount,n.default_currency_symbol)),1)):(m(),f("span",I_,u(o.formatAmount(d.total_amount,d.client_currency)),1))],2))]))]),r("td",null,[n.loadingPrice?(m(),f("div",D_,j_)):(m(),f("div",P_,u(d.due_date),1))]),r("td",null,[n.loadingPrice?(m(),f("div",q_,N_)):(m(),f("div",O_,u(d.created),1))]),r("td",B_,[r("span",{class:"lg:tooltip","data-tip":o.translations.view},[j(c,{to:{name:"InvoiceViewDetail",params:{id:d.id}}},{default:me(()=>[F_]),_:2},1032,["to"])],8,V_),d.status=="draft"?(m(),f("span",{key:0,class:"lg:tooltip","data-tip":o.translations.edit},[j(c,{to:{name:"InvoiceEdit",params:{id:d.id}}},{default:me(()=>[L_]),_:2},1032,["to"])],8,U_)):y("",!0),d.status=="draft"?(m(),f("span",{key:1,class:"lg:tooltip","data-tip":o.translations.delete},[r("button",{onClick:l=>o.confirmDeleteInvoice(d.id),class:"btn btn-circle text-red-500 hover:text-red-700 mx-1"},X_,8,Q_)],8,W_)):y("",!0)])]))),128))]))]),n.loading?(m(),f("div",z_,[(m(!0),f(U,null,L(n.skeletonRows,d=>(m(),f("div",{key:d,class:"flex flex-col gap-4 w-full"},Y_))),128))])):y("",!0)]),r("div",K_,[(m(!0),f(U,null,L(n.paginationButtons,d=>(m(),f("button",{key:d,class:S(["join-item btn",{"btn-disabled":d==="..."||d===n.currentPage}]),onClick:l=>o.goToPage(d)},u(d),11,Z_))),128))])]),_:1})])}var eg=re(Qp,[["render",$_]]);const tg={name:"sendInvoice",components:{VueEditor:Nt.exports.VueEditor},props:{showModal:Boolean,modalId:String,client:Object,invoiceId:Number,loading:Boolean,subject:String,content:String},data(){const t=window.myEasyComptaAdmin.easyComptaTranslations;return{loading:!1,loadingBtn:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},toolbarOptions:[["bold","italic","underline","strike"],["link"],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{align:[]}],[{align:"right"},{align:"center"},{align:"justify"}],["clean"]],fields:{client_email:{label:t.client,value:"",disabled:!0},email_subject:{label:t.email_subject,value:""},email_message:{label:t.email_content,value:"",type:"textarea"}}}},watch:{client:{immediate:!0,handler(t){this.fields.client_email.value=(t==null?void 0:t.email)||""}},subject:{immediate:!0,handler(t){this.fields.email_subject.value=t||""}},content:{immediate:!0,handler(t){this.fields.email_message.value=t||""}}},computed:{skeletonItems(){return Array.from({length:10},(t,e)=>e)},translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{closeModal(){document.getElementById(this.modalId).close()},async submitForm(){this.loadingBtn=!0;try{const t=await fetch("/wp-json/my-easy-compta/v1/emails/send-email",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({type:"invoice",id:this.invoiceId,client_email:this.client.email,email_subject:this.fields.email_subject.value,email_message:this.fields.email_message.value})});if(t.ok){const e=await t.json();this.loadingBtn=!1,this.closeModal(),this.showToast(e.message,"alert-success")}else{const e=`Error sending email: ${t.statusText}`;this.showToast(e,"alert-error"),console.error(e),this.loadingBtn=!1}}catch(t){const e=t.response&&t.response.data&&t.response.data.message?t.response.data.message:"Error sending email";this.showToast(e,"alert-error"),console.error("Error sending email:",t),this.loadingBtn=!1}},updateFieldValue(t,e){this.fields[t].value=e},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},ng=["id","open"],sg={class:"modal-box"},og={class:"font-bold text-lg"},ig={key:0},rg={class:"grid grid-cols-1 gap-4"},ag=r("div",{class:"skeleton h-4 w-full mb-2"},null,-1),lg=r("div",{class:"skeleton h-4 w-full"},null,-1),cg=[ag,lg],dg={class:"grid grid-cols-1 gap-4"},ug=["type"],hg=["for"],mg=["id","value","disabled","onInput"],fg={key:1},pg=["for"],_g={class:"form-group mt-4 flex justify-end"},gg=["disabled"],yg={key:0,class:"loading loading-spinner loading-sm"};function vg(t,e,s,i,n,o){const a=N("vue-editor");return m(),f("div",null,[n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),r("dialog",{id:s.modalId,class:"modal",open:s.showModal},[r("div",sg,[r("h3",og,u(o.translations.send_invoice),1),r("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=c=>o.closeModal())}," \u2715 "),n.loading?(m(),f("div",ig,[r("div",rg,[(m(!0),f(U,null,L(o.skeletonItems,c=>(m(),f("div",{key:c,class:"py-2"},cg))),128))])])):(m(),f("form",{key:1,onSubmit:e[1]||(e[1]=te((...c)=>o.submitForm&&o.submitForm(...c),["prevent"])),class:"form"},[r("div",dg,[(m(!0),f(U,null,L(n.fields,(c,h)=>(m(),f("div",{key:h,class:"ecwp-group form-group"},[c.type!=="textarea"?(m(),f("div",{key:0,type:c.type||"text"},[r("label",{for:h,class:"ecwp-label form-label"},u(c.label),9,hg),r("input",{id:h,class:S(["ecwp-input input input-bordered",c.class||"w-full"]),value:c.value,disabled:c.disabled,onInput:d=>o.updateFieldValue(h,d.target.value)},null,42,mg)],8,ug)):(m(),f("div",fg,[r("label",{for:h,class:"form-label"},u(c.label),9,pg),j(a,{modelValue:c.value,"onUpdate:modelValue":d=>c.value=d,editorToolbar:n.toolbarOptions},null,8,["modelValue","onUpdate:modelValue","editorToolbar"])]))]))),128))]),r("div",_g,[r("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[C(u(o.translations.send)+" ",1),n.loadingBtn?(m(),f("span",yg)):y("",!0)],8,gg)])],32))])],8,ng)])}var bg=re(tg,[["render",vg]]);const wg={props:{isVisible:{type:Boolean,default:!1},title:{type:String,default:"Confirmation"},message:{type:String,default:"Are you sure?"},confirmText:{type:String,default:"Confirm"},cancelText:{type:String,default:"Cancel"},status:{type:String}},data(){return{selectedPaymentMethod:"",paymentMethods:[],hasPaymentMethodError:!1}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},mounted(){this.fetchPaymentMethods()},methods:{async fetchPaymentMethods(){try{const t=await fetch("/wp-json/my-easy-compta/v1/payments/methods",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}});if(!t.ok)throw new Error(`Erreur : ${t.status}`);const e=await t.json();this.paymentMethods=e}catch(t){console.error("Erreur lors de la r\xE9cup\xE9ration des m\xE9thodes de paiement :",t)}},onConfirm(){if(!this.selectedPaymentMethod){this.hasPaymentMethodError=!0;return}this.hasPaymentMethodError=!1,this.$emit("confirm",this.selectedPaymentMethod),this.closeModal()},onCancel(){this.$emit("cancel"),this.closeModal()},closeModal(){document.getElementById("modal_confirm_paid").close()}}},xg=["open"],Eg={class:"modal-box"},Cg={class:"font-bold text-lg"},Tg=r("div",{class:"text-center text-red-400 mb-2"},[r("i",{class:"fas fa-exclamation-triangle text-4xl"})],-1),Ig={class:"text-lg font-semibold text-center"},kg={class:"my-4 text-center text-xl"},Sg={key:0,class:"mt-4 mb-4"},Ag={class:"ecwp-group form-group"},Pg={for:"payment_method",class:"ecwp-label form-label"},Dg={value:""},Rg=["value"],jg={class:"flex justify-between space-x-4"};function Og(t,e,s,i,n,o){return m(),f("div",null,[r("dialog",{id:"modal_confirm_paid",class:"modal",open:t.showModal},[r("div",Eg,[r("h3",Cg,u(t.modalTitle),1),r("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=(...a)=>o.closeModal&&o.closeModal(...a))}," \u2715 "),Tg,r("h2",Ig,u(s.title),1),r("p",kg,u(s.message),1),s.status==="paid"?(m(),f("div",Sg,[r("div",Ag,[r("label",Pg,u(o.translations.payment_method),1),P(r("select",{id:"payment_method","onUpdate:modelValue":e[1]||(e[1]=a=>n.selectedPaymentMethod=a),class:S([{"input-error":n.hasPaymentMethodError},"ecwp-input input input-bordered w-full"])},[r("option",Dg,u(o.translations.select),1),(m(!0),f(U,null,L(n.paymentMethods,a=>(m(),f("option",{key:a.id,value:a.id},u(a.method_name),9,Rg))),128))],2),[[ue,n.selectedPaymentMethod]])])])):y("",!0),r("div",jg,[r("button",{onClick:e[2]||(e[2]=(...a)=>o.onCancel&&o.onCancel(...a)),class:"btn btn-secondary rounded-full"},u(s.cancelText),1),r("button",{onClick:e[3]||(e[3]=(...a)=>o.onConfirm&&o.onConfirm(...a)),class:"btn rounded-full btn-error text-white"},u(s.confirmText),1)])])],8,xg)])}var qg=re(wg,[["render",Og]]);const Mg={props:{isVisible:{type:Boolean,default:!1},title:{type:String,default:"Confirmation"},message:{type:String,default:"Are you sure?"},confirmText:{type:String,default:"Confirm"},cancelText:{type:String,default:"Cancel"},status:{type:String}},data(){return{selectedPaymentMethod:""}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{onConfirm(){this.$emit("confirm",this.selectedPaymentMethod),this.closeModal()},onCancel(){this.$emit("cancel"),this.closeModal()},closeModal(){document.getElementById("modal_confirm_credit").close()}}},Ng=["open"],Bg={class:"modal-box"},Vg={class:"font-bold text-lg"},Fg=r("div",{class:"text-center text-red-400 mb-2"},[r("i",{class:"fas fa-exclamation-triangle text-4xl"})],-1),Ug={class:"text-lg font-semibold text-center"},Lg={class:"my-4 text-center text-xl"},Wg={class:"flex justify-between space-x-4"};function Qg(t,e,s,i,n,o){return m(),f("div",null,[r("dialog",{id:"modal_confirm_credit",class:"modal",open:t.showModal},[r("div",Bg,[r("h3",Vg,u(t.modalTitle),1),r("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=(...a)=>o.closeModal&&o.closeModal(...a))}," \u2715 "),Fg,r("h2",Ug,u(s.title),1),r("p",Lg,u(s.message),1),r("div",Wg,[r("button",{onClick:e[1]||(e[1]=(...a)=>o.onCancel&&o.onCancel(...a)),class:"btn btn-secondary rounded-full"},u(s.cancelText),1),r("button",{onClick:e[2]||(e[2]=(...a)=>o.onConfirm&&o.onConfirm(...a)),class:"btn rounded-full btn-error text-white"},u(s.confirmText),1)])])],8,Ng)])}var Hg=re(Mg,[["render",Qg]]);const Xg={name:"InvoiceNavBar",components:{SendInvoiceModal:bg,RemoveModal:qt,ConfirmModal:ds,ConfirmModalPaid:qg,ConfirmModalCredit:Hg},props:{invoiceInfo:Object,currencyDefault:Object,currencyClient:Object,emailActive:String,qrCodeActive:String,totalAmount:String,noItems:Boolean},data(){return{showConfirmModal:!1,showConfirmCreditModal:!1,loading:!1,sendInvoiceModal:!1,loadingModal:!1,loadingPdf:!1,client_detail:null,selectedStatus:null,subject:"",content:"",showQrCodeModal:!1,qrCodeSrc:""}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{changeInvoiceStatusWithPaymentMethod(t){const e=this.selectedStatus;this.changeInvoiceStatus(e,t),this.showConfirmModal=!1},async changeInvoiceStatus(t,e){this.loading=!0;try{const i=await(await fetch("/wp-json/my-easy-compta/v1/invoices/update-status",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({id:this.invoiceInfo.id,status:t,method:e})})).json();i.success?(this.invoiceInfo.status=t,this.loading=!1):(console.error("Failed to update invoice status:",i.message),this.loading=!1)}catch(s){console.error("An error occurred while updating invoice status:",s)}},async addCreditInvoice(){this.loading=!0;try{const e=await(await fetch("/wp-json/my-easy-compta/v1/invoices/credit",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({id:this.invoiceInfo.id})})).json();e.success?(this.invoiceInfo.credit=1,this.loading=!1):(console.error("Failed to update invoice status:",e.message),this.loading=!1)}catch(t){console.error("An error occurred while updating invoice status:",t)}},exportToPDF(t){this.loadingPdf=!0;let s=`/wp-json/my-easy-compta/v1/invoices/pdf/${this.invoiceInfo.id}?currency_id=${t}`;fetch(s,{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(i=>{if(!i.ok)throw this.loadingPdf=!1,new Error("Network response was not ok");return i.blob()}).then(i=>{const n=URL.createObjectURL(i);window.open(n),this.loadingPdf=!1}).catch(i=>{console.error("There was a problem with the fetch operation:",i),this.loadingPdf=!1})},sendInvoice(t){this.loadingModal=!0,this.sendInvoiceModal=!0,modal_send_invoice.showModal(),this.fetchClient(t),this.fetchSettings()},fetchClient(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/clients/details/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Client not found");return e.json()}).then(e=>{this.client_detail=e,this.loading=!1}).catch(e=>{console.error("Error fetching client info:",e),this.loading=!1})},async fetchSettings(){try{this.loading=!0;const t=await fetch("/wp-json/my-easy-compta/v1/settings/get",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}});if(this.loading=!1,t.ok){const e=await t.json();this.subject=e.email_invoice_subject,this.content=e.email_invoice_content}else{const e=await t.json();this.showToast(e.message,"alert-error")}}catch(t){this.loading=!1,this.showToast(t.message,"alert-error")}},confirmValidateInvoice(t){this.selectedStatus=t,t=="unpaid"?modal_confirm.showModal():t=="paid"&&modal_confirm_paid.showModal(),this.showConfirmModal=!0},confirmCreditInvoice(){modal_confirm_credit.showModal(),this.showConfirmCreditModal=!0},async generateQRCode(){this.loading=!0;try{const t=await fetch("/wp-json/my-easy-compta/v1/generate-qrcode",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({invoice_ref:this.invoiceInfo.invoice_number||`Facture #${this.invoiceInfo.number}`,price:parseFloat(this.invoiceInfo.total_amount)})}),e=await t.json();t.ok&&e.qr_code?(this.qrCodeSrc=e.qr_code,this.showQrCodeModal=!0):console.error("Erreur lors de la g\xE9n\xE9ration du QR Code :",e.message)}catch(t){console.error("Erreur lors de l'appel \xE0 l'API pour g\xE9n\xE9rer le QR code :",t)}finally{this.loading=!1}},closeQrCodeModal(){this.showQrCodeModal=!1},downloadQRCode(){const t=document.createElement("a");t.href=this.qrCodeSrc,t.download=`qr_code_${this.invoiceInfo.invoice_number||this.invoiceInfo.number}.png`,t.click()}}},zg={key:0},Gg={key:1,class:"modal modal-open"},Jg={class:"modal-box"},Yg={class:"font-bold text-lg"},Kg={class:"mb-4"},Zg=["src"],$g={class:"flex justify-end space-x-4"},ey={key:2,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},ty=r("span",{class:"loading loading-spinner text-primary loading-lg"},null,-1),ny=[ty],sy={class:"navbar bg-base-100 mb-4 shadow-xl rounded-box flex justify-between"},oy=r("div",{class:"dropdown"},[r("div",{tabindex:"0",role:"button",class:"btn btn-ghost lg:hidden"},[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h8m-8 6h16"})])]),r("ul",{tabindex:"0",class:"menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52"},[r("li",null,[r("a",null,"Item")]),r("li",null,[r("a",null,"Parent"),r("ul",{class:"p-2"},[r("li",null,[r("a",null,"Submenu")]),r("li",null,[r("a",null,"Submenu")])])]),r("li",null,[r("a",null,"Item")])])],-1),iy={class:"hidden lg:flex gap-2"},ry={class:"btn btn-sm"},ay=r("i",{class:"far fa-edit"},null,-1),ly={key:1},cy={class:"btn btn-sm",disabled:""},dy=r("i",{class:"far fa-edit"},null,-1),uy={key:2},hy=r("i",{class:"fa fa-check"},null,-1),my={class:"btn btn-outline btn-success btn-sm hover:text-white",disabled:""},fy=r("i",{class:"fa fa-check"},null,-1),py={key:0},_y={class:"btn btn-sm ms-2",disabled:""},gy=r("i",{class:"fas fa-undo"},null,-1),yy={key:1},vy=r("i",{class:"fas fa-undo"},null,-1),by=["disabled"],wy=r("i",{class:"far fa-file-pdf"},null,-1),xy={key:0,class:"loading loading-spinner loading-sm"},Ey={class:"flex gap-2"},Cy=r("i",{class:"fas fa-paper-plane"},null,-1),Ty={key:0},Iy={key:1},ky={key:2,class:"far fa-envelope"},Sy=["data-tip"],Ay={click:"#",class:"btn btn-outline btn-primary btn-sm hover:text-white",disabled:""},Py=r("i",{class:"fas fa-paper-plane"},null,-1),Dy=["data-tip"],Ry={click:"#",class:"btn btn-outline btn-primary btn-sm hover:text-white",disabled:""},jy=r("i",{class:"fas fa-paper-plane"},null,-1),Oy={key:3},qy=r("i",{class:"fas fa-qrcode"},null,-1),My={key:1,click:"#",class:"btn btn-outline btn-primary btn-sm hover:text-white",disabled:""},Ny=r("i",{class:"fas fa-qrcode"},null,-1),By=["data-tip"],Vy={click:"#",class:"btn btn-outline btn-primary btn-sm hover:text-white",disabled:""},Fy=r("i",{class:"fas fa-qrcode"},null,-1),Uy={key:5},Ly={key:0,class:"dropdown dropdown-end"},Wy={tabindex:"0",role:"button",class:"btn btn-outline btn-success btn-sm"},Qy=r("i",{class:"far fa-file-pdf"},null,-1),Hy={key:0,class:"loading loading-spinner loading-sm"},Xy={tabindex:"0",class:"dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2 shadow"},zy=["disabled"],Gy=["disabled"],Jy={key:6},Yy=["disabled"],Ky=r("i",{class:"far fa-file-pdf"},null,-1),Zy={key:0},$y={key:1},ev={key:2,class:"loading loading-spinner loading-sm"},tv=r("i",{class:"fas fa-check"},null,-1),nv=["data-tip"],sv={click:"#",class:"btn btn-outline btn-primary btn-sm hover:text-white",disabled:""},ov=r("i",{class:"fas fa-check"},null,-1);function iv(t,e,s,i,n,o){const a=N("send-invoice-modal"),c=N("confirm-modal"),h=N("confirm-modal-paid"),d=N("confirm-modal-credit"),l=N("router-link");return m(),f("div",null,[s.emailActive==1?(m(),f("div",zg,[j(a,{loading:n.loadingModal,"show-modal":n.sendInvoiceModal,"modal-id":"modal_send_invoice",client:n.client_detail,"invoice-id":s.invoiceInfo.id,subject:n.subject,content:n.content,onClose:e[0]||(e[0]=p=>n.sendInvoiceModal=!1)},null,8,["loading","show-modal","client","invoice-id","subject","content"])])):y("",!0),j(c,{"show-modal":n.showConfirmModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_confirm_it,cancelText:o.translations.cancel,status:n.selectedStatus,onConfirm:e[1]||(e[1]=p=>o.changeInvoiceStatus("unpaid")),onCancel:e[2]||(e[2]=p=>n.showConfirmModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText","status"]),j(h,{"show-modal":n.showConfirmModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_confirm_it,cancelText:o.translations.cancel,status:n.selectedStatus,onConfirm:o.changeInvoiceStatusWithPaymentMethod,onCancel:e[3]||(e[3]=p=>n.showConfirmModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText","status","onConfirm"]),j(d,{"show-modal":n.showConfirmCreditModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_confirm_it,cancelText:o.translations.cancel,onConfirm:e[4]||(e[4]=p=>this.addCreditInvoice()),onCancel:e[5]||(e[5]=p=>n.showConfirmCreditModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),s.qrCodeActive==1&&n.showQrCodeModal?(m(),f("div",Gg,[r("div",Jg,[r("h3",Yg,u(o.translations.download_qr_code),1),r("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[6]||(e[6]=p=>o.closeQrCodeModal())}," \u2715 "),r("div",Kg,[r("img",{src:n.qrCodeSrc,alt:"QR Code",class:"max-w-full h-auto mx-auto"},null,8,Zg)]),r("div",$g,[r("button",{onClick:e[7]||(e[7]=(...p)=>o.downloadQRCode&&o.downloadQRCode(...p)),class:"btn btn-primary"},u(o.translations.download_qr_code),1)])])])):y("",!0),n.loading?(m(),f("div",ey,ny)):y("",!0),r("div",sy,[r("div",null,[oy,r("div",iy,[s.invoiceInfo.status=="draft"?(m(),fi(l,{key:0,to:{name:"InvoiceEdit",params:{id:s.invoiceInfo.id}}},{default:me(()=>[r("button",ry,[ay,C(" "+u(o.translations.edit_invoice),1)])]),_:1},8,["to"])):(m(),f("div",ly,[r("button",cy,[dy,C(" "+u(o.translations.edit_invoice),1)])])),s.invoiceInfo.status=="unpaid"&&!s.noItems?(m(),f("div",uy,[r("button",{class:"btn btn-outline btn-success btn-sm hover:text-white",onClick:e[8]||(e[8]=p=>o.confirmValidateInvoice("paid"))},[hy,C(" "+u(o.translations.mark_as_paid),1)])])):(m(),f(U,{key:3},[r("div",null,[r("button",my,[fy,C(" "+u(o.translations.mark_as_paid),1)])]),s.invoiceInfo.credit!=0&&s.invoiceInfo.status=="paid"&&!s.noItems?(m(),f("div",py,[r("button",_y,[gy,C(" "+u(o.translations.credit_invoice),1)])])):y("",!0),s.invoiceInfo.credit==0&&s.invoiceInfo.status=="paid"&&!s.noItems?(m(),f("div",yy,[r("button",{class:"btn btn-sm ms-2",onClick:e[9]||(e[9]=p=>o.confirmCreditInvoice())},[vy,C(" "+u(o.translations.credit_invoice),1)])])):y("",!0)],64))])]),s.invoiceInfo.status=="draft"?(m(),f("button",{key:0,onClick:e[10]||(e[10]=p=>o.exportToPDF(s.currencyDefault.currency_id)),class:"btn btn-outline btn-secondary btn-sm",disabled:n.loadingPdf},[wy,r("span",null,u(o.translations.previewPDF),1),n.loadingPdf?(m(),f("span",xy)):y("",!0)],8,by)):y("",!0),r("div",Ey,[s.emailActive==1&&s.invoiceInfo.status!="draft"?(m(),f("button",{key:0,onClick:e[11]||(e[11]=te(p=>o.sendInvoice(s.invoiceInfo.client_id),["prevent"])),class:"btn btn-outline btn-primary btn-sm hover:text-white"},[Cy,s.invoiceInfo.sent==1?(m(),f("span",Ty,u(o.translations.resend_invoice),1)):(m(),f("span",Iy,u(o.translations.send_invoice),1)),s.invoiceInfo.sent==1?(m(),f("i",ky)):y("",!0)])):s.emailActive==1&&s.invoiceInfo.status=="draft"?(m(),f("div",{key:1,class:"tooltip tooltip-bottom tooltip-warning","data-tip":o.translations.draft_cannot_send},[r("button",Ay,[Py,C(" "+u(o.translations.send_invoice),1)])],8,Sy)):(m(),f("div",{key:2,class:"tooltip tooltip-bottom tooltip-warning","data-tip":o.translations.active_email_addon},[r("button",Ry,[jy,C(" "+u(o.translations.send_invoice),1)])],8,Dy)),s.qrCodeActive==1?(m(),f("div",Oy,[s.invoiceInfo.status=="unpaid"?(m(),f("button",{key:0,class:"btn btn-outline btn-accent btn-sm",onClick:e[12]||(e[12]=(...p)=>o.generateQRCode&&o.generateQRCode(...p))},[qy,C(" "+u(o.translations.generate_qrcode),1)])):(m(),f("button",My,[Ny,C(" "+u(o.translations.generate_qrcode),1)]))])):(m(),f("div",{key:4,class:"tooltip tooltip-bottom tooltip-warning","data-tip":o.translations.active_qrcode_addon},[r("button",Vy,[Fy,C(" "+u(o.translations.generate_qrcode),1)])],8,By)),s.currencyDefault.currency_id!==s.currencyClient.currency_id?(m(),f("div",Uy,[s.invoiceInfo.status!="draft"?(m(),f("div",Ly,[r("div",Wy,[Qy,C(" "+u(o.translations.exportToPDF)+" ",1),n.loadingPdf?(m(),f("span",Hy)):y("",!0)]),r("ul",Xy,[r("li",null,[r("a",{onClick:e[13]||(e[13]=p=>o.exportToPDF(s.currencyDefault.currency_id)),disabled:n.loadingPdf},u(o.translations.invoice_in)+" "+u(s.currencyDefault.currency_symbol),9,zy)]),r("li",null,[r("a",{onClick:e[14]||(e[14]=p=>o.exportToPDF(s.currencyClient.currency_id)),disabled:n.loadingPdf},u(o.translations.invoice_in)+" "+u(s.currencyClient.currency_symbol),9,Gy)])])])):y("",!0)])):(m(),f("div",Jy,[s.invoiceInfo.status!="draft"?(m(),f("button",{key:0,onClick:e[15]||(e[15]=p=>o.exportToPDF(s.currencyDefault.currency_id)),class:"btn btn-outline btn-success btn-sm",disabled:n.loadingPdf},[Ky,s.invoiceInfo.status!="draft"?(m(),f("span",Zy,u(o.translations.exportToPDF),1)):(m(),f("span",$y,u(o.translations.previewPDF),1)),n.loadingPdf?(m(),f("span",ev)):y("",!0)],8,Yy)):y("",!0)])),s.invoiceInfo.status=="draft"&&!s.noItems?(m(),f("button",{key:7,class:"btn btn-outline btn-success btn-sm hover:text-white",onClick:e[16]||(e[16]=p=>o.confirmValidateInvoice("unpaid"))},[tv,C(" "+u(o.translations.validateInvoice),1)])):y("",!0),s.invoiceInfo.status=="draft"&&s.noItems?(m(),f("div",{key:8,class:"tooltip tooltip-left tooltip-warning","data-tip":o.translations.min_article},[r("button",sv,[ov,C(" "+u(o.translations.validateInvoice),1)])],8,nv)):y("",!0)])])])}var rv=re(Xg,[["render",iv]]);const av={components:{VueEditor:Nt.exports.VueEditor},props:{loading:Boolean,showModal:Boolean,modalId:String,modalTitle:String,item:Object},data(){return{editedItem:{...this.item},loading:this.loading,loadingBtn:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},fields:{item_name:{label:"Nom de l'item"},item_description:{label:"Description de l'item",type:"textarea"},quantity:{label:"Quantit\xE9",type:"number"},vat_rate:{label:"Taux de TVA",type:"number"},unit_price:{label:"Prix unitaire",type:"number"},discount:{label:"Remise",type:"number"}}}},computed:{skeletonItems(){return Array.from({length:10},(t,e)=>e)},translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{closeModal(){document.getElementById(this.modalId).close()},async submitForm(){this.loadingBtn=!0;try{const t=await fetch(`/wp-json/my-easy-compta/v1/invoices/edit-item/${this.editedItem.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.editedItem)});if(t.ok){const e=await t.json();this.loadingBtn=!1,this.closeModal(),this.showToast(e.message,"alert-success"),this.$emit("itemEdited")}else{const e=`Error editing item: ${t.statusText}`;this.showToast(e,"alert-error"),console.error(e),this.loadingBtn=!1}}catch(t){const e=t.response&&t.response.data&&t.response.data.message?t.response.data.message:"Error editing item";this.showToast(e,"alert-error"),console.error("Error editing item:",t),this.loadingBtn=!1}},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)},increase(){this.newItem.quantity++},decrease(){this.newItem.quantity>1&&this.newItem.quantity--}},watch:{item:{handler(t){this.editedItem={...t}},immediate:!0}}},lv=["id","open"],cv={class:"modal-box"},dv={class:"font-bold text-lg"},uv={key:0},hv={class:"grid grid-cols-1 gap-4"},mv=r("div",{class:"skeleton h-4 w-full mb-2"},null,-1),fv=r("div",{class:"skeleton h-4 w-full"},null,-1),pv=[mv,fv],_v={class:"grid grid-cols-1 gap-4"},gv=["type"],yv=["for"],vv=["id","onUpdate:modelValue"],bv={key:1},wv=["for"],xv={class:"form-group mt-4 flex justify-end"},Ev=["disabled"],Cv={key:0,class:"loading loading-spinner loading-sm"};function Tv(t,e,s,i,n,o){const a=N("vue-editor");return m(),f("div",null,[n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),r("dialog",{id:s.modalId,class:"modal",open:s.showModal},[r("div",cv,[r("h3",dv,u(s.modalTitle),1),r("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=c=>o.closeModal())}," \u2715 "),n.loading?(m(),f("div",uv,[r("div",hv,[(m(!0),f(U,null,L(o.skeletonItems,c=>(m(),f("div",{key:c,class:"py-2"},pv))),128))])])):(m(),f("form",{key:1,onSubmit:e[1]||(e[1]=te((...c)=>o.submitForm&&o.submitForm(...c),["prevent"])),class:"form"},[r("div",_v,[(m(!0),f(U,null,L(n.fields,(c,h)=>(m(),f("div",{key:h,class:"ecwp-group form-group"},[c.type!=="textarea"?(m(),f("div",{key:0,type:c.type||"text"},[r("label",{for:h,class:"ecwp-label form-label"},u(c.label),9,yv),P(r("input",{id:h,"onUpdate:modelValue":d=>n.editedItem[h]=d,class:S(["ecwp-input input input-bordered",c.class||"w-full"])},null,10,vv),[[H,n.editedItem[h]]])],8,gv)):(m(),f("div",bv,[r("label",{for:h,class:"form-label"},u(c.label),9,wv),j(a,{id:h,modelValue:n.editedItem[h],"onUpdate:modelValue":d=>n.editedItem[h]=d,editorToolbar:t.toolbarOptions},null,8,["id","modelValue","onUpdate:modelValue","editorToolbar"])]))]))),128))]),r("div",xv,[r("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[C(u(o.translations.save)+" ",1),n.loadingBtn?(m(),f("span",Cv)):y("",!0)],8,Ev)])],32))])],8,lv)])}var Iv=re(av,[["render",Tv]]);const kv={name:"sendRemind",components:{VueEditor:Nt.exports.VueEditor},props:{showModal:Boolean,modalId:String,client:Object,invoiceId:Number,loading:Boolean,subject:String,content:String},data(){const t=window.myEasyComptaAdmin.easyComptaTranslations;return{loading:!1,loadingBtn:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},toolbarOptions:[["bold","italic","underline","strike"],["link"],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{align:[]}],[{align:"right"},{align:"center"},{align:"justify"}],["clean"]],fields:{client_email:{label:t.client,value:"",disabled:!0},email_subject:{label:t.email_subject,value:""},email_message:{label:t.email_content,value:"",type:"textarea"}}}},watch:{client:{immediate:!0,handler(t){this.fields.client_email.value=(t==null?void 0:t.email)||""}},subject:{immediate:!0,handler(t){this.fields.email_subject.value=t||""}},content:{immediate:!0,handler(t){this.fields.email_message.value=t||""}}},computed:{skeletonItems(){return Array.from({length:10},(t,e)=>e)},translations(){return window.myEasyComptaAdmin.easyComptaTranslations}},methods:{closeModal(){document.getElementById(this.modalId).close()},async submitForm(){this.loadingBtn=!0;try{const t=await fetch("/wp-json/my-easy-compta/v1/emails/send-email",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({type:"remind",id:this.invoiceId,client_email:this.client.email,email_subject:this.fields.email_subject.value,email_message:this.fields.email_message.value})});if(t.ok){const e=await t.json();this.loadingBtn=!1,this.closeModal(),this.showToast(e.message,"alert-success")}else{const e=`Error sending email: ${t.statusText}`;this.showToast(e,"alert-error"),console.error(e),this.loadingBtn=!1}}catch(t){const e=t.response&&t.response.data&&t.response.data.message?t.response.data.message:"Error sending email";this.showToast(e,"alert-error"),console.error("Error sending email:",t),this.loadingBtn=!1}},updateFieldValue(t,e){this.fields[t].value=e},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},Sv=["id","open"],Av={class:"modal-box"},Pv={class:"font-bold text-lg"},Dv={key:0},Rv={class:"grid grid-cols-1 gap-4"},jv=r("div",{class:"skeleton h-4 w-full mb-2"},null,-1),Ov=r("div",{class:"skeleton h-4 w-full"},null,-1),qv=[jv,Ov],Mv={class:"grid grid-cols-1 gap-4"},Nv=["type"],Bv=["for"],Vv=["id","value","disabled","onInput"],Fv={key:1},Uv=["for"],Lv={class:"form-group mt-4 flex justify-end"},Wv=["disabled"],Qv={key:0,class:"loading loading-spinner loading-sm"};function Hv(t,e,s,i,n,o){const a=N("vue-editor");return m(),f("div",null,[n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),r("dialog",{id:s.modalId,class:"modal",open:s.showModal},[r("div",Av,[r("h3",Pv,u(o.translations.remind_invoice),1),r("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:e[0]||(e[0]=c=>o.closeModal())}," \u2715 "),n.loading?(m(),f("div",Dv,[r("div",Rv,[(m(!0),f(U,null,L(o.skeletonItems,c=>(m(),f("div",{key:c,class:"py-2"},qv))),128))])])):(m(),f("form",{key:1,onSubmit:e[1]||(e[1]=te((...c)=>o.submitForm&&o.submitForm(...c),["prevent"])),class:"form"},[r("div",Mv,[(m(!0),f(U,null,L(n.fields,(c,h)=>(m(),f("div",{key:h,class:"ecwp-group form-group"},[c.type!=="textarea"?(m(),f("div",{key:0,type:c.type||"text"},[r("label",{for:h,class:"ecwp-label form-label"},u(c.label),9,Bv),r("input",{id:h,class:S(["ecwp-input input input-bordered",c.class||"w-full"]),value:c.value,disabled:c.disabled,onInput:d=>o.updateFieldValue(h,d.target.value)},null,42,Vv)],8,Nv)):(m(),f("div",Fv,[r("label",{for:h,class:"form-label"},u(c.label),9,Uv),j(a,{modelValue:c.value,"onUpdate:modelValue":d=>c.value=d,editorToolbar:n.toolbarOptions},null,8,["modelValue","onUpdate:modelValue","editorToolbar"])]))]))),128))]),r("div",Lv,[r("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[C(u(o.translations.send)+" ",1),n.loadingBtn?(m(),f("span",Qv)):y("",!0)],8,Wv)])],32))])],8,Sv)])}var Xv=re(kv,[["render",Hv]]);const zv={name:"InvoiceViewDetail",components:{Card:Ze,InvoiceNavBar:rv,EditItemModal:Iv,RemoveModal:qt,RemindInvoiceModal:Xv},data(){return{selectedItem:null,SelectedInvoiceId:null,editItemsModal:!1,RemindInvoiceModal:!1,no_items:!0,loading:!1,loading_add:!1,invoice:[],invoiceItems:[],newItem:{loading_del:!1,item_name:"",item_ref:"",item_category:"Type",item_description:"",quantity:1,vat_rate:0,unit_price:0,discount:0,total_price:0,total_amount:0},settings:[],client_detail:[],list_vats:[],client_currency:"",default_vat:"",default_currency:"",default_currency_symbol:"",articles:[],categories:[],refs:[],showDropdown:!1,showDropdownRef:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},isInvoiceOverdue(){const t=new Date().getTime(),e=this.invoice.due_date?new Date(this.invoice.due_date).getTime():null;return e&&e<t},defaultCurrency(){return{currency_id:this.settings.default_currency,currency_symbol:this.default_currency_symbol}},clientCurrency(){return{currency_id:this.client_detail.currency_id,currency_symbol:this.client_currency}},totalAmountWithoutDiscount(){const t=this.invoiceItems.reduce((e,s)=>{const i=s.quantity*s.unit_price;return e+i},0);return this.formatCurrency(t)},totalAmount(){const t=this.invoiceItems.reduce((e,s)=>e+parseFloat(s.total_price),0);return this.formatCurrency(t)},totalAmountDefaultCurrency(){return(this.invoiceItems.reduce((i,n)=>i+parseFloat(n.total_amount),0)*this.invoice.exchange_rate).toFixed(2)},totalAmountWithVAT(){const t=parseFloat(this.totalAmount);if(this.settings.vat_active==1){const e=parseFloat(this.calculateVAT());return this.formatCurrency(t+e)}else return this.formatCurrency(t)}},methods:{getUniqueVATRates(){const t=new Set;return this.invoiceItems.forEach(e=>{e.vat_rate&&t.add(e.vat_rate)}),Array.from(t)},calculateVATForRate(t){let e=0;return this.invoiceItems.forEach(s=>{if(s.vat_rate===t){const i=s.quantity*s.unit_price,n=i*s.discount/100;e+=(i-n)*t/100}}),this.formatCurrency(e)},calculateTotalAmountWithVAT(){let t=this.invoiceItems.reduce((e,s)=>e+parseFloat(s.total_amount),0);return this.settings.easy_compta_woo_addon_active==1&&(t+=parseFloat(this.invoice.shipping_amount||0)),this.formatCurrency(t)},formatShippingAmout(t){return this.formatShippingCurrency(t)},formatShippingCurrency(t){const s=(parseFloat(t)||0).toFixed(2),i=this.client_currency!==this.default_currency_symbol?this.client_currency:this.default_currency_symbol;return`${s}${i}`},fetchInvoice(){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/invoices/${this.$route.params.id}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{t?(this.invoice=t,this.fetchClientInfo(t.client_id)):console.error("Invoice not found")}).catch(t=>{console.error("Error fetching invoice:",t),this.loading=!1})},fetchClientInfo(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/clients/details/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw new Error("Client not found");return e.json()}).then(e=>{this.client_detail=e;const s=e.currency_id;s&&this.fetchCurrencyDetails(s)}).catch(e=>{console.error("Error fetching client info:",e),this.loading=!1})},fetchItems(){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/invoices/${this.$route.params.id}/items`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{t.code=="no_items_found"?(console.error("No items found"),this.invoiceItems=[],this.loading=!1,this.no_items=!0):(this.invoiceItems=t,this.loading=!1,this.no_items=!1)}).catch(t=>{console.error("Error fetching items:",t),this.loading=!1})},fetchCurrencyDetails(t){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/settings/currency/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>{if(!e.ok)throw this.loading=!1,new Error("Currency details not found");return this.loading=!1,e.json()}).then(e=>{this.client_currency=e.symbol,this.loading=!1}).catch(e=>{this.loading=!1,console.error("Error fetching currency details:",e)})},updateTotal(){const t=this.newItem.quantity*this.newItem.unit_price,e=t*this.newItem.discount/100,s=t-e;var i=0;if(this.settings.vat_active==1){const n=s*this.newItem.vat_rate/100;i=s+n}else i=s;this.newItem.total_price=this.formatCurrency(s),this.newItem.total_amount=this.formatCurrency(i)},calculateTotalWithVat(t,e,s,i){const n=t*e,o=n*i/100,a=n-o,c=a*s/100,h=a+c;return this.formatCurrency(h)},calculateTotal(t,e,s){const i=t*e,n=i*s/100,a=i-n;return this.formatCurrency(a)},submitItems(){this.updateTotal();const t={...this.newItem,invoice_id:this.$route.params.id};this.loading_add=!0,fetch("/wp-json/my-easy-compta/v1/invoices/element-add",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{e.success?(this.loading_add=!1,this.fetchItems(),this.newItem={item_name:"",item_ref:"",item_category:"Type",item_description:"",quantity:1,vat_rate:this.default_vat.rate,unit_price:0,discount:0,total_price:0,total_amount:0}):(this.showToast(e.message,"alert-error"),console.error("Error submitting item:",e.message),this.loading_add=!1)}).catch(e=>{this.showToast(e.message,"alert-error"),console.error("Error submitting item:",e),this.loading_add=!1})},increase(){this.newItem.quantity++},decrease(){this.newItem.quantity>1&&this.newItem.quantity--},confirmremoveItem(t,e){this.selectedItem=t,this.SelectedInvoiceId=e,modal_remove.showModal(),this.showRemoveModal=!0},removeItem(t,e){const s=this.invoiceItems.find(i=>i.id===t);s.loading_del=!0,fetch(`/wp-json/my-easy-compta/v1/invoices/element-delete/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({invoice_id:e})}).then(i=>i.json()).then(i=>{i.success?(s.loading_del=!1,this.fetchItems()):(this.showToast(i.message,"alert-error"),console.error("Error removing item:",i.message),s.loading_del=!1)}).catch(i=>{this.showToast(i.message,"alert-error"),console.error("Error removing item:",i),s.loading_del=!1})},editItem(t){this.loadingModal=!0,this.editItemsModal=!0,modal_edit_item.showModal(),this.fetchItemDetails(t)},fetchItemDetails(t){fetch(`/wp-json/my-easy-compta/v1/invoices/item-details/${t}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>e.json()).then(e=>{this.selectedItem=e,this.loading=!1}).catch(e=>{console.error("Error fetching item details:",e),this.loading=!1})},formatCurrency(t){const e=t.toFixed(2),s=this.client_currency!==this.default_currency_symbol?this.client_currency:this.default_currency_symbol;return`${e}${s}`},calculateDiscountAmountWithVAT(t,e,s,i){const o=t*e*i/100,a=o*s/100,c=o+a;return this.formatCurrency(c)},calculateDiscountAmount(t,e,s){const o=t*e*s/100;return this.formatCurrency(o)},calculateVAT(){const t=parseFloat(this.totalAmount),e=parseFloat(this.default_vat.rate),s=t*(e/100);return this.formatCurrency(s)},onDragEnd(t){const e=this.invoiceItems[t.oldIndex];this.invoiceItems.splice(t.oldIndex,1),this.invoiceItems.splice(t.newIndex,0,e);const s=this.invoiceItems.map(i=>i.id);this.saveOrderToDatabase(s)},nl2br(t){return t?t.replace(/\n/g,"<br>"):""},resize(){let t=this.$refs.textarea;t.style.height="auto",t.style.height=t.scrollHeight+"px"},saveOrderToDatabase(t){fetch("/wp-json/my-easy-compta/v1/invoices/update-invoice-items-order",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify({order:t})}).then(e=>{e.ok?console.log("Order saved successfully."):console.error("Failed to save order:",e.statusText)}).catch(e=>{console.error("Error saving order:",e)})},fetchCategoriesArticles(){fetch("/wp-json/my-easy-compta/v1/categories-articles",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.categories=t}).catch(t=>console.error("Error fetching categories:",t))},fetchArticles(){if(this.newItem.item_name.length<1){this.articles=[];return}fetch(`/wp-json/my-easy-compta/v1/articles?search=${this.newItem.item_name}&method=name`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.articles=t}).catch(t=>console.error("Error fetching articles:",t))},selectItem(t){this.newItem.item_ref=t.ref,this.newItem.item_name=t.name,this.newItem.item_description=t.description,this.newItem.unit_price=t.unit_price,this.showDropdown=!1,this.showDropdownRef=!1},fetchRefs(){if(this.newItem.item_ref.length<1){this.refs=[];return}fetch(`/wp-json/my-easy-compta/v1/articles?search=${this.newItem.item_ref}&method=ref`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.refs=t}).catch(t=>console.error("Error fetching refrences:",t))},async loadSettings(){try{this.loadingPrice=!0;const{settings:t,currencySymbol:e,vatData:s,listVatData:i}=await mn();this.settings=t,this.default_currency_symbol=e,this.default_vat=s,this.list_vats=i,this.newItem.vat_rate=this.default_vat.rate,this.loadingPrice=!1}catch(t){this.showToast(t.message,"alert-error"),this.loadingPrice=!1}},highlightMatch(t){if(!this.newItem.item_name)return t;const e=new RegExp(`(${this.escapeRegExp(this.newItem.item_name)})`,"gi");return t.replace(e,"<b>$1</b>")},escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},handleClickOutside(t){this.$el.contains(t.target)||(this.showDropdown=!1,this.showDropdownRef=!1)},sendRemind(t){this.loadingModal=!0,this.RemindInvoiceModal=!0,modal_send_remind.showModal(),this.fetchClientInfo(t),this.loadSettings()},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)},mounted(){this.fetchInvoice(),this.fetchItems(),this.loadSettings(),this.fetchCategoriesArticles(),document.addEventListener("click",this.handleClickOutside);const t=document.querySelector("tbody");O.create(t,{animation:150,handle:".drag-handle",onEnd:this.onDragEnd})}},Gv={class:"pt-2 pr-4"},Jv={key:0},Yv={key:2,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},Kv=r("span",{class:"loading loading-spinner text-primary loading-lg"},null,-1),Zv=[Kv],$v={key:3},eb={role:"alert",class:"alert alert-warning"},tb=r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 shrink-0 stroke-current",fill:"none",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),nb={key:0},sb=["data-tip"],ob={class:"btn btn-sm btn-primary",disabled:""},ib={class:"grid grid-cols-2"},rb={class:"md:col-span-1"},ab=["src"],lb={class:"md:col-span-1 text-right"},cb={class:"text-lg font-semibold"},db={key:0,class:"badge badge-error text-white"},ub={key:1,class:"badge badge-error text-white"},hb={key:2,class:"badge badge-success text-white"},mb={class:"bg-base-300 rounded-lg shadow-md flex justify-between p-4 mt-4 gap-4"},fb=r("br",null,null,-1),pb=r("br",null,null,-1),_b=r("br",null,null,-1),gb=["href"],yb=r("br",null,null,-1),vb=r("br",null,null,-1),bb=r("br",null,null,-1),wb=["href"],xb=r("br",null,null,-1),Eb=["href"],Cb={class:"table mt-8"},Tb=r("th",null,null,-1),Ib={width:"5%"},kb={width:"19%"},Sb={width:"21%"},Ab={width:"10%",class:"text-center"},Pb={width:"8%",class:"text-center"},Db={key:0,width:"5%",class:"text-center"},Rb={key:1,width:"5%"},jb={width:"10%",class:"text-center"},Ob={width:"10%",class:"text-right"},qb=r("th",{width:"18%",class:"text-right inv-actions"},null,-1),Mb=r("td",{class:"draggable-item drag-handle px-2"},[r("i",{class:"fas fa-bars"})],-1),Nb={key:0,class:"badge badge-ghost badge-xs"},Bb=["innerHTML"],Vb={class:"text-center"},Fb={class:"text-center"},Ub={key:0},Lb={key:1},Wb={key:0,class:"text-center"},Qb={key:1},Hb={key:2,class:"text-center"},Xb=r("br",null,null,-1),zb={key:3,class:"text-center"},Gb=r("br",null,null,-1),Jb={class:"text-right"},Yb={key:0},Kb={key:1},Zb={key:0},$b=["data-tip"],e1=["onClick"],t1=r("i",{class:"far fa-edit"},null,-1),n1=[t1],s1=["data-tip"],o1=["onClick"],i1={key:0,class:"far fa-trash-alt"},r1={key:1,class:"loading loading-spinner loading-xs"},a1={key:0},l1=r("td",{class:"px-2"},null,-1),c1={class:"align-top px-2"},d1={class:"flex items-center border rounded-md relative"},u1=["placeholder"],h1={key:0,class:"autocomplete-dropdown bg-base-100"},m1=["onClick","innerHTML"],f1={class:"align-top px-2"},p1=r("option",{disabled:"",selected:""},"Type",-1),_1=["value"],g1={class:"flex items-center border rounded-md relative"},y1=["placeholder"],v1={key:0,class:"autocomplete-dropdown bg-base-100"},b1=["onClick","innerHTML"],w1={class:"align-top"},x1={class:"flex items-center rounded-md"},E1=["placeholder"],C1={class:"align-top"},T1={class:"flex items-center border rounded-lg"},I1={class:"inline-flex"},k1=["placeholder"],S1={class:"align-top"},A1={class:"flex items-center border rounded-md"},P1=["placeholder"],D1={key:0,class:"align-top"},R1=["value"],j1={key:1,class:"align-top"},O1={class:"align-top"},q1={class:"flex items-center border rounded-md"},M1=["placeholder"],N1=r("div",{class:"px-3 py-2.5 rounded-l-md bg-base-300 border-r"}," % ",-1),B1={key:2,class:"text-right"},V1={key:3,class:"text-right"},F1=["data-tip"],U1={type:"submit",class:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"},L1={key:0,class:"fa fa-plus"},W1={key:1,class:"loading loading-spinner loading-xs"},Q1={colspan:"8",class:"text-right no-border"},H1={class:"text-right"},X1={key:0,class:"line-through"},z1=r("td",null,null,-1),G1={colspan:"8",class:"text-right no-border"},J1={class:"text-right"},Y1=r("td",null,null,-1),K1={key:2},Z1={colspan:"8",class:"text-right no-border"},$1={class:"text-right no-border"},ew={colspan:"8",class:"text-right no-border font-bold text-xl"},tw={class:"text-right no-border font-bold text-xl"},nw=r("td",null,null,-1),sw={key:3},ow={colspan:"8",class:"text-right no-border"},iw={class:"text-right no-border"},rw={key:4},aw={colspan:"8",class:"text-right no-border"},lw={class:"text-right no-border font-bold text-xl"};function cw(t,e,s,i,n,o){const a=N("InvoiceNavBar"),c=N("remove-modal"),h=N("remind-invoice-modal"),d=N("edit-item-modal"),l=N("Card");return m(),f("div",Gv,[j(a,{invoiceInfo:n.invoice,currencyDefault:o.defaultCurrency,currencyClient:o.clientCurrency,emailActive:n.settings.easy_compta_email_addon_active,qrCodeActive:n.settings.easy_compta_qrcode_addon_active,noItems:n.no_items},null,8,["invoiceInfo","currencyDefault","currencyClient","emailActive","qrCodeActive","noItems"]),j(c,{"show-modal":t.showRemoveModal,title:o.translations.are_you_sure,message:o.translations.no_turning_back,confirmText:o.translations.yes_delete_it,cancelText:o.translations.cancel,onConfirm:e[0]||(e[0]=p=>this.removeItem(n.selectedItem,n.SelectedInvoiceId)),onCancel:e[1]||(e[1]=p=>t.showRemoveModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),n.settings.easy_compta_email_addon_active==1?(m(),f("div",Jv,[j(h,{loading:t.loadingModal,"show-modal":n.RemindInvoiceModal,"modal-id":"modal_send_remind",client:n.client_detail,"invoice-id":n.invoice.id,subject:n.settings.remind_invoice_subject,content:n.settings.remind_invoice_content,onClose:e[2]||(e[2]=p=>n.RemindInvoiceModal=!1)},null,8,["loading","show-modal","client","invoice-id","subject","content"])])):y("",!0),n.toast.visible?(m(),f("div",{key:1,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),n.loading?(m(),f("div",Yv,Zv)):y("",!0),o.isInvoiceOverdue&&n.invoice.status=="unpaid"?(m(),f("div",$v,[r("div",eb,[tb,r("span",null,u(o.translations.invoice_overdue),1),n.settings.easy_compta_email_addon_active==1?(m(),f("div",nb,[r("button",{onClick:e[3]||(e[3]=te(p=>o.sendRemind(n.invoice.client_id),["prevent"])),class:"btn btn-sm btn-primary"},u(o.translations.remind_invoice),1)])):(m(),f("div",{key:1,class:"tooltip tooltip-bottom tooltip-warning","data-tip":o.translations.active_email_addon},[r("button",ob,u(o.translations.remind_invoice),1)],8,sb))])])):y("",!0),j(l,{topMargin:"mt-8",id:"invoice-content"},{default:me(()=>[r("div",ib,[r("div",rb,[r("div",null,[r("img",{src:n.settings.logo_url,style:no({width:n.settings.logo_width+"px"}),alt:"Logo"},null,12,ab)])]),r("div",lb,[r("p",cb,u(n.invoice.invoice_number),1),r("div",null,[C(u(o.translations.created_at)+": ",1),r("strong",null,u(n.invoice.created_at),1)]),r("div",null,[C(u(o.translations.due_date)+": ",1),r("strong",null,u(n.invoice.due_date),1)]),r("div",null,[C(u(o.translations.status)+": ",1),n.invoice.status=="draft"?(m(),f("span",db,u(o.translations.draft),1)):y("",!0),n.invoice.status=="unpaid"?(m(),f("span",ub,u(o.translations.unpaid),1)):y("",!0),n.invoice.status=="paid"?(m(),f("span",hb,u(o.translations.paid),1)):y("",!0)])])]),r("div",mb,[r("div",null,[r("strong",null,u(o.translations.bill_to)+":",1),r("h4",null,[r("strong",null,u(n.client_detail.company_name),1)]),r("p",null,[C(u(n.client_detail.address),1),fb,C(" "+u(n.client_detail.postal_code)+", "+u(n.client_detail.city)+" ",1),pb,C(" "+u(n.client_detail.country),1),_b,n.client_detail.phone?(m(),f("a",{key:0,href:"tel:"+n.client_detail.phone},u(n.client_detail.phone),9,gb)):y("",!0)])]),r("div",null,[r("strong",null,u(o.translations.received_from)+":",1),r("h4",null,[r("strong",null,u(n.settings.company_name),1)]),r("p",null,[C(u(n.settings.company_address),1),yb,C(" "+u(n.settings.postal_code)+", "+u(n.settings.city)+" ",1),vb,C(" "+u(n.settings.country),1),bb,n.settings.company_phone?(m(),f("a",{key:0,href:"tel:"+n.settings.company_phone},u(n.settings.company_phone),9,wb)):y("",!0),xb,n.settings.mobile_phone?(m(),f("a",{key:1,href:"tel:"+n.settings.mobile_phone},u(n.settings.mobile_phone),9,Eb)):y("",!0)])])]),j(d,{loading:t.loadingModal,"show-modal":n.editItemsModal,"modal-id":"modal_edit_item","modal-title":o.translations.edit_item,item:n.selectedItem,onClose:e[4]||(e[4]=p=>n.editItemsModal=!1),onItemEdited:o.fetchItems},null,8,["loading","show-modal","modal-title","item","onItemEdited"]),r("form",{onSubmit:e[24]||(e[24]=te((...p)=>o.submitItems&&o.submitItems(...p),["prevent"]))},[r("table",Cb,[r("thead",null,[r("tr",null,[Tb,r("th",Ib,u(o.translations.item_ref),1),r("th",kb,u(o.translations.item_name),1),r("th",Sb,u(o.translations.description),1),r("th",Ab,u(o.translations.quantity),1),r("th",Pb,u(o.translations.unit_price),1),n.settings.vat_active==1?(m(),f("th",Db,u(o.translations.vat),1)):(m(),f("th",Rb)),r("th",jb,u(o.translations.discount),1),r("th",Ob,u(o.translations.total),1),qb])]),r("tbody",null,[(m(!0),f(U,null,L(n.invoiceItems,(p,_)=>(m(),f("tr",{key:p.id||_},[Mb,r("td",null,u(p.item_ref),1),r("td",null,[p.category_name?(m(),f("div",Nb,u(p.category_name),1)):y("",!0),r("div",null,u(p.item_name),1)]),r("td",{innerHTML:o.nl2br(p.item_description)},null,8,Bb),r("td",Vb,u(p.quantity),1),r("td",Fb,[C(u(p.unit_price),1),n.default_currency_symbol==n.client_currency?(m(),f("span",Ub,u(n.default_currency_symbol),1)):(m(),f("span",Lb,u(n.client_currency),1))]),n.settings.vat_active==1?(m(),f("td",Wb,u(p.vat_rate)+"% ",1)):(m(),f("td",Qb)),n.settings.vat_active==1?(m(),f("td",Hb,[C(u(p.discount)+"% ",1),Xb,C(" "+u(o.calculateDiscountAmountWithVAT(p.quantity,p.unit_price,p.vat_rate,p.discount)),1)])):(m(),f("td",zb,[C(u(p.discount)+"% ",1),Gb,C(" "+u(o.calculateDiscountAmount(p.quantity,p.unit_price,p.discount)),1)])),r("td",Jb,[C(u(p.total_amount)+" ",1),n.default_currency_symbol==n.client_currency?(m(),f("span",Yb,u(n.default_currency_symbol),1)):(m(),f("span",Kb,u(n.client_currency),1))]),r("td",null,[n.invoice.status=="draft"?(m(),f("div",Zb,[r("span",{class:"lg:tooltip","data-tip":o.translations.edit},[r("button",{onClick:te(g=>o.editItem(p.id),["prevent"]),class:"bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-3 rounded"},n1,8,e1)],8,$b),r("span",{class:"lg:tooltip","data-tip":o.translations.delete},[r("button",{onClick:te(g=>o.confirmremoveItem(p.id,n.invoice.id),["prevent"]),class:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-3 mx-2 rounded"},[p.loading_del?y("",!0):(m(),f("i",i1)),p.loading_del?(m(),f("span",r1)):y("",!0)],8,o1)],8,s1)])):y("",!0)])]))),128)),n.invoice.status=="draft"?(m(),f("tr",a1,[l1,r("td",c1,[r("div",d1,[P(r("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=p=>n.newItem.item_ref=p),onInput:e[6]||(e[6]=(...p)=>o.fetchRefs&&o.fetchRefs(...p)),onFocus:e[7]||(e[7]=p=>n.showDropdownRef=!0),placeholder:o.translations.item_ref,class:"w-full p-2.5 input-xs outline-none"},null,40,u1),[[H,n.newItem.item_ref]]),n.showDropdownRef&&n.refs.length?(m(),f("ul",h1,[(m(!0),f(U,null,L(n.refs,p=>(m(),f("li",{key:p.ref,onClick:_=>o.selectItem(p),class:"autocomplete-item",innerHTML:o.highlightMatch(p.ref)},null,8,m1))),128))])):y("",!0)])]),r("td",f1,[P(r("select",{class:"select select-xs w-full mb-1 ecwp-select","onUpdate:modelValue":e[8]||(e[8]=p=>n.newItem.item_category=p)},[p1,(m(!0),f(U,null,L(n.categories,p=>(m(),f("option",{key:p.id,value:p.id},u(p.name),9,_1))),128))],512),[[ue,n.newItem.item_category]]),r("div",g1,[P(r("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=p=>n.newItem.item_name=p),onInput:e[10]||(e[10]=(...p)=>o.fetchArticles&&o.fetchArticles(...p)),onFocus:e[11]||(e[11]=p=>n.showDropdown=!0),placeholder:o.translations.item_name,class:"w-full p-2.5 bg-transparent input-xs outline-none"},null,40,y1),[[H,n.newItem.item_name]]),n.showDropdown&&n.articles.length?(m(),f("ul",v1,[(m(!0),f(U,null,L(n.articles,p=>(m(),f("li",{key:p.name,onClick:_=>o.selectItem(p),class:"autocomplete-item bt-primary",innerHTML:o.highlightMatch(p.name)},null,8,b1))),128))])):y("",!0)])]),r("td",w1,[r("div",x1,[P(r("textarea",{"onUpdate:modelValue":e[12]||(e[12]=p=>n.newItem.item_description=p),placeholder:o.translations.item_description,class:"textarea textarea-bordered input-xs w-full",onInput:e[13]||(e[13]=p=>o.resize()),ref:"textarea"},null,40,E1),[[H,n.newItem.item_description]])])]),r("td",C1,[r("div",T1,[r("div",I1,[r("div",{class:"select-none border py-3 px-2 cursor-pointer bg-base-300 hover:bg-gray-200 rounded-l",onClick:e[14]||(e[14]=(...p)=>o.decrease&&o.decrease(...p))}," - "),P(r("input",{type:"text",pattern:"([0-9]+.{0,1}[0-9]*,{0,1})*[0-9]","onUpdate:modelValue":e[15]||(e[15]=p=>n.newItem.quantity=p),placeholder:o.translations.quantity,class:"w-full p-2.5 bg-transparent outline-none max-w-40 min-w-10",onInput:e[16]||(e[16]=(...p)=>o.updateTotal&&o.updateTotal(...p))},null,40,k1),[[H,n.newItem.quantity]]),r("div",{class:"select-none border py-3 px-2 cursor-pointer bg-base-300 hover:bg-gray-200 rounded-r",onClick:e[17]||(e[17]=(...p)=>o.increase&&o.increase(...p))}," + ")])])]),r("td",S1,[r("div",A1,[P(r("input",{type:"text",pattern:"([0-9]+.{0,1}[0-9]*,{0,1})*[0-9]","onUpdate:modelValue":e[18]||(e[18]=p=>n.newItem.unit_price=p),placeholder:o.translations.unit_price,class:"w-full p-2.5 bg-transparent outline-none max-w-40 min-w-10",onInput:e[19]||(e[19]=(...p)=>o.updateTotal&&o.updateTotal(...p))},null,40,P1),[[H,n.newItem.unit_price]])])]),n.settings.vat_active==1?(m(),f("td",D1,[P(r("select",{"onUpdate:modelValue":e[20]||(e[20]=p=>n.newItem.vat_rate=p),onChange:e[21]||(e[21]=(...p)=>o.updateTotal&&o.updateTotal(...p)),class:"select select-md w-full mb-1 ecwp-select min-w-20"},[(m(!0),f(U,null,L(n.list_vats,p=>(m(),f("option",{key:p,value:p.rate},u(p.rate)+"% ",9,R1))),128))],544),[[ue,n.newItem.vat_rate]])])):(m(),f("td",j1)),r("td",O1,[r("div",q1,[P(r("input",{type:"number","onUpdate:modelValue":e[22]||(e[22]=p=>n.newItem.discount=p),min:"0",max:"100",placeholder:o.translations.discount,class:"w-full p-2.5 bg-transparent outline-none max-w-40 min-w-10",onInput:e[23]||(e[23]=(...p)=>o.updateTotal&&o.updateTotal(...p))},null,40,M1),[[H,n.newItem.discount]]),N1])]),n.settings.vat_active==1?(m(),f("td",B1,u(o.calculateTotalWithVat(n.newItem.quantity,n.newItem.unit_price,n.newItem.vat_rate,n.newItem.discount)),1)):(m(),f("td",V1,u(o.calculateTotal(n.newItem.quantity,n.newItem.unit_price,n.newItem.discount)),1)),r("td",null,[r("span",{class:"lg:tooltip","data-tip":o.translations.add},[r("button",U1,[n.loading_add?y("",!0):(m(),f("i",L1)),n.loading_add?(m(),f("span",W1)):y("",!0)])],8,F1)])])):y("",!0),r("tr",null,[r("td",Q1,[r("strong",null,u(o.translations.subtotal),1)]),r("td",H1,[o.totalAmount!==o.totalAmountWithoutDiscount?(m(),f("span",X1,u(o.totalAmountWithoutDiscount),1)):y("",!0),C(" "+u(o.totalAmount),1)]),z1]),n.settings.vat_active==1?(m(!0),f(U,{key:1},L(o.getUniqueVATRates(),(p,_)=>(m(),f("tr",{key:_},[r("td",G1,[r("strong",null,u(o.translations.tax)+" ("+u(p)+"%) ",1)]),r("td",J1,u(o.calculateVATForRate(p)),1),Y1]))),128)):y("",!0),n.invoice.shipping_amount?(m(),f("tr",K1,[r("td",Z1,[r("strong",null,u(o.translations.shipping_fees),1)]),r("td",$1,u(o.formatShippingAmout(n.invoice.shipping_amount)),1)])):y("",!0),r("tr",null,[r("td",ew,[r("strong",null,u(o.translations.total),1)]),r("td",tw,u(o.calculateTotalAmountWithVAT()),1),nw]),n.client_currency!=n.default_currency_symbol?(m(),f("tr",sw,[r("td",ow,[r("strong",null,u(o.translations.exchange_rate),1)]),r("td",iw,u(n.invoice.exchange_rate),1)])):y("",!0),n.client_currency!=n.default_currency_symbol?(m(),f("tr",rw,[r("td",aw,[r("strong",null,u(o.translations.total)+" "+u(n.default_currency_symbol),1)]),r("td",lw,u(o.totalAmountDefaultCurrency)+u(n.default_currency_symbol),1)])):y("",!0)])])],32)]),_:1})])}var dw=re(zv,[["render",cw]]);const uw={name:"InvoiceNew",components:{Card:Ze,ModelSelect:hn,VueDatePicker:Mt,AddClientModal:Ro},data(){return{invoice:{invoice_number:"",due_date:"",client_id:"",client:null,status:"",exchange_rate:0},showError:!1,loading:!1,loadingBtn:!1,clients:[],clientOptions:[],settings:[],last_invoice_number:"",toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},formattedDate(){return t=>{if(!t)return"";const e=t.getDate().toString().padStart(2,"0"),s=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getFullYear();return`${e}-${s}-${i}`}},currencyMismatch(){const t=this.clients.find(e=>e.id===this.invoice.client_id);return t&&this.settings.default_currency!==t.currency_id}},mounted(){this.fetchClients(),this.fetchSettings()},methods:{AddNew(){modal_clients.showModal()},cancelAction(){this.$router.push("/invoices")},fetchClients(){this.loading=!0,fetch("/wp-json/my-easy-compta/v1/list-clients",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.clients=t.clients,this.clientOptions=this.clients.map(e=>({value:e.id,text:`${e.company_name} - ${e.email} (${e.currency_symbol})`}))}).catch(t=>{console.error("Error fetching clients:",t)}).finally(()=>{this.loading=!1})},async fetchSettings(){try{this.loading=!0;const t=await fetch("/wp-json/my-easy-compta/v1/settings/get",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}});if(this.loading=!1,t.ok){const e=await t.json();this.settings=e;const s=`${this.settings.invoice_prefix}_${String(this.settings.last_invoice_id).padStart(4,"0")}`;this.invoice.number=s}else{const e=await t.json()}}catch{this.loading=!1}},handleClientChange(){const t=this.clients.find(e=>e.id===this.invoice.client_id);t&&this.settings.default_currency!==t.currency_id?this.invoice.exchange_rate=1:this.invoice.exchange_rate=0},submitInvoice(){if(!this.invoice.due_date||!this.invoice.client_id||!this.invoice.status){this.showError=!0,this.showToast("Veuillez remplir tous les champs obligatoires.","alert-error");return}this.loadingBtn=!0,fetch("/wp-json/my-easy-compta/v1/invoices",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.invoice)}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(t=>{t.success?(this.loadingBtn=!1,this.showToast(t.message,"alert-success"),this.$router.push({name:"InvoiceViewDetail",params:{id:t.id}})):(console.error("Error submitting invoice:",t.message),this.showToast(t.message,"alert-error"),this.loadingBtn=!1)}).catch(t=>{console.error("Error submitting invoice:",t),this.showToast(t,"alert-error"),this.loadingBtn=!1})},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},hw={class:"pt-2 pr-4"},mw={class:"flex justify-between items-center mb-4"},fw={class:"card-title"},pw=r("div",{class:"divider mt-2"},null,-1),_w={key:0,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},gw={class:"grid grid-cols-2 gap-4"},yw={class:"ecwp-group form-group mb-4"},vw={for:"invoiceNumber",class:"ecwp-label"},bw={class:"ecwp-group form-group mb-4"},ww={for:"invoiceDate",class:"ecwp-label"},xw={class:"mb-4"},Ew={class:"flex gap-2 items-end"},Cw=r("i",{class:"fas fa-plus"},null,-1),Tw=[Cw],Iw={class:"ecwp-group form-group w-full"},kw={for:"client",class:"ecwp-label"},Sw={class:"ecwp-group form-group mb-4"},Aw={for:"status",class:"ecwp-label"},Pw={value:"draft"},Dw={key:0,class:"ecwp-group form-group mb-4"},Rw={for:"exchangeRate",class:"ecwp-label"},jw={class:"flex justify-between"},Ow=["disabled"],qw={key:0,class:"loading loading-spinner loading-sm"};function Mw(t,e,s,i,n,o){const a=N("VueDatePicker"),c=N("model-select"),h=N("Card"),d=N("AddClientModal");return m(),f("div",hw,[n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),j(h,{topMargin:"mt-8",modalType:"modal_invoice_new"},{default:me(()=>[r("div",mw,[r("h2",fw,u(o.translations.new_invoice),1)]),pw,n.loading?(m(),f("div",_w)):y("",!0),r("form",{onSubmit:e[7]||(e[7]=te((...l)=>o.submitInvoice&&o.submitInvoice(...l),["prevent"]))},[r("div",gw,[r("div",yw,[r("label",vw,u(o.translations.invoice_number),1),P(r("input",{type:"text",id:"invoiceNumber","onUpdate:modelValue":e[0]||(e[0]=l=>n.invoice.number=l),class:"ecwp-input input input-bordered w-full",disabled:"disabled"},null,512),[[H,n.invoice.number]])]),r("div",bw,[r("label",ww,u(o.translations.due_date),1),j(a,{class:S(["ecwp-input ecwp-date input input-bordered w-full",[!n.invoice.due_date&&n.showError?"input-error":""]]),id:"invoiceDate",modelValue:n.invoice.due_date,"onUpdate:modelValue":e[1]||(e[1]=l=>n.invoice.due_date=l),"enable-time-picker":!1,"auto-apply":"",format:o.formattedDate,"min-date":new Date,locale:"fr"},null,8,["class","modelValue","format","min-date"])]),r("div",xw,[r("div",Ew,[r("button",{type:"button",class:"btn btn-primary",onClick:e[2]||(e[2]=(...l)=>o.AddNew&&o.AddNew(...l))},Tw),r("div",Iw,[r("label",kw,u(o.translations.company_name),1),j(c,{modelValue:n.invoice.client_id,"onUpdate:modelValue":e[3]||(e[3]=l=>n.invoice.client_id=l),options:n.clientOptions,label:"text","track-by":"value",placeholder:o.translations.select,class:S(["ecwp-input input input-bordered w-full",[!n.invoice.client_id&&n.showError?"input-error":""]])},null,8,["modelValue","options","placeholder","class"])])])]),r("div",Sw,[r("label",Aw,u(o.translations.status),1),P(r("select",{id:"status","onUpdate:modelValue":e[4]||(e[4]=l=>n.invoice.status=l),class:S(["ecwp-input select select-bordered w-full",[!n.invoice.status&&n.showError?"input-error":""]])},[r("option",Pw,u(o.translations.draft),1)],2),[[ue,n.invoice.status]])]),o.currencyMismatch?(m(),f("div",Dw,[r("label",Rw,u(o.translations.exchange_rate),1),P(r("input",{type:"text",id:"exchangeRate","onUpdate:modelValue":e[5]||(e[5]=l=>n.invoice.exchange_rate=l),class:"ecwp-input input input-bordered w-full",required:""},null,512),[[H,n.invoice.exchange_rate]])])):y("",!0)]),r("div",jw,[r("button",{type:"button",class:"btn btn-secondary rounded-full",onClick:e[6]||(e[6]=(...l)=>o.cancelAction&&o.cancelAction(...l))},u(o.translations.cancel),1),r("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[C(u(o.translations.submit)+" ",1),n.loadingBtn?(m(),f("span",qw)):y("",!0)],8,Ow)])],32)]),_:1}),j(d,{onClientAdded:o.fetchClients},null,8,["onClientAdded"])])}var Nw=re(uw,[["render",Mw]]);const Bw={name:"invoiceEdit",components:{Card:Ze,ModelSelect:hn,VueDatePicker:Mt},data(){return{invoice:{invoice_number:"",due_date:"",client_id:"",client:null,status:"paid",exchange_rate:0},showError:!1,loading:!1,loadingBtn:!1,clients:[],clientOptions:[],settings:[],toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},formattedDate(){return t=>{if(!t)return"";const e=t.getDate().toString().padStart(2,"0"),s=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getFullYear();return`${e}-${s}-${i}`}},currencyMismatch(){const t=this.clients.find(e=>e.id===this.invoice.client_id);return t&&this.settings.default_currency!==t.currency_id}},mounted(){this.fetchClients(),this.fetchSettings(),this.fetchInvoiceDetails()},methods:{cancelAction(){this.$router.push("/invoices")},fetchClients(){this.loading=!0,fetch("/wp-json/my-easy-compta/v1/list-clients",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.clients=t.clients,this.clientOptions=this.clients.map(e=>({value:e.id,text:`${e.company_name} - ${e.email} (${e.currency_symbol})`})),this.invoice.client_id&&this.setClientById(this.invoice.client_id)}).catch(t=>{console.error("Error fetching clients:",t)}).finally(()=>{this.loading=!1})},async fetchSettings(){try{this.loading=!0;const t=await fetch("/wp-json/my-easy-compta/v1/settings/get",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}});if(this.loading=!1,t.ok){const e=await t.json();this.settings=e}else{const e=await t.json();console.error("Error fetching settings:",e)}}catch(t){this.loading=!1,console.error("Error fetching settings:",t)}},fetchInvoiceDetails(){const t=this.$route.params.id;!t||(this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/invoices/${t}`,{headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(e=>e.json()).then(e=>{e?this.invoice=e:(console.error("Error fetching invoice details:",e.message),this.showToast(e.message,"alert-error"))}).catch(e=>{console.error("Error fetching invoice details:",e),this.showToast(e,"alert-error")}).finally(()=>{this.loading=!1}))},setClientById(t){this.invoice.client=this.clients.find(e=>e.id===t)||null},handleClientChange(){const t=this.clients.find(e=>e.id===this.invoice.client_id);t&&this.settings.default_currency!==t.currency_id?this.invoice.exchange_rate=1:this.invoice.exchange_rate=0},submitInvoice(){if(!this.invoice.due_date||!this.invoice.client_id||!this.invoice.status){this.showError=!0,this.showToast("Veuillez remplir tous les champs obligatoires.","alert-error");return}this.loadingBtn=!0,fetch(`/wp-json/my-easy-compta/v1/invoices/${this.$route.params.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.invoice)}).then(t=>{if(!t.ok)throw this.loadingBtn=!1,new Error("Network response was not ok");return t.json()}).then(t=>{t.success?(this.loadingBtn=!1,this.showToast(t.message,"alert-success"),this.$router.push({name:"InvoiceViewDetail",params:{id:t.id}})):(this.loadingBtn=!1,console.error("Error submitting invoice:",t.message),this.showToast(t.message,"alert-error"))}).catch(t=>{this.loadingBtn=!1,console.error("Error submitting invoice:",t),this.showToast(t,"alert-error")})},showToast(t,e){this.toast.message=t,this.toast.type=e,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}}},Vw={class:"pt-2 pr-4"},Fw={class:"flex justify-between items-center mb-4"},Uw={class:"card-title"},Lw=r("div",{class:"divider mt-2"},null,-1),Ww={key:0,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center bg-gray-900 bg-opacity-50 z-50"},Qw={class:"grid grid-cols-2 gap-4"},Hw={class:"ecwp-group form-group mb-4"},Xw={for:"invoiceNumber",class:"ecwp-label"},zw={class:"ecwp-group form-group mb-4"},Gw={for:"invoiceDate",class:"ecwp-label"},Jw={class:"ecwp-group form-group mb-4"},Yw={for:"client",class:"ecwp-label"},Kw={class:"ecwp-group form-group mb-4"},Zw={for:"status",class:"ecwp-label"},$w={value:"draft",selected:""},e0={value:"unpaid"},t0={value:"paid"},n0={key:0,class:"ecwp-group form-group mb-4"},s0={for:"exchangeRate",class:"ecwp-label"},o0={class:"flex justify-between"},i0=["disabled"],r0={key:0,class:"loading loading-spinner loading-sm"};function a0(t,e,s,i,n,o){const a=N("VueDatePicker"),c=N("model-select"),h=N("Card");return m(),f("div",Vw,[n.toast.visible?(m(),f("div",{key:0,class:S(["toast",n.toast.position]),style:{zIndex:9999}},[r("div",{class:S(["alert",n.toast.type,"text-white"])},[r("span",null,u(n.toast.message),1)],2)],2)):y("",!0),j(h,{topMargin:"mt-8",modalType:"modal_invoice_new"},{default:me(()=>[r("div",Fw,[r("h2",Uw,u(o.translations.edit_invoice),1)]),Lw,n.loading?(m(),f("div",Ww)):y("",!0),r("form",{onSubmit:e[6]||(e[6]=te((...d)=>o.submitInvoice&&o.submitInvoice(...d),["prevent"]))},[r("div",Qw,[r("div",Hw,[r("label",Xw,u(o.translations.invoice_number),1),P(r("input",{type:"text",id:"invoiceNumber","onUpdate:modelValue":e[0]||(e[0]=d=>n.invoice.invoice_number=d),class:"ecwp-input input input-bordered w-full",disabled:"true"},null,512),[[H,n.invoice.invoice_number]])]),r("div",zw,[r("label",Gw,u(o.translations.due_date),1),j(a,{class:S(["ecwp-input ecwp-date input input-bordered w-full",[!n.invoice.due_date&&n.showError?"input-error":""]]),id:"invoiceDate",modelValue:n.invoice.due_date,"onUpdate:modelValue":e[1]||(e[1]=d=>n.invoice.due_date=d),"enable-time-picker":!1,"auto-apply":"",format:o.formattedDate,"min-date":new Date,locale:"fr"},null,8,["class","modelValue","format","min-date"])]),r("div",Jw,[r("label",Yw,u(o.translations.company_name),1),j(c,{modelValue:n.invoice.client_id,"onUpdate:modelValue":e[2]||(e[2]=d=>n.invoice.client_id=d),options:n.clientOptions,label:"text","track-by":"value",placeholder:o.translations.select,class:S(["ecwp-input input input-bordered w-full",[!n.invoice.client_id&&n.showError?"input-error":""]])},null,8,["modelValue","options","placeholder","class"])]),r("div",Kw,[r("label",Zw,u(o.translations.status),1),P(r("select",{id:"status","onUpdate:modelValue":e[3]||(e[3]=d=>n.invoice.status=d),class:S(["ecwp-input select select-bordered w-full",[!n.invoice.status&&n.showError?"input-error":""]])},[r("option",$w,u(o.translations.draft),1),r("option",e0,u(o.translations.unpaid),1),r("option",t0,u(o.translations.paid),1)],2),[[ue,n.invoice.status]])]),o.currencyMismatch?(m(),f("div",n0,[r("label",s0,u(o.translations.exchange_rate),1),P(r("input",{type:"text",id:"exchangeRate","onUpdate:modelValue":e[4]||(e[4]=d=>n.invoice.exchange_rate=d),class:"ecwp-input input input-bordered w-full",required:""},null,512),[[H,n.invoice.exchange_rate]])])):y("",!0)]),r("div",o0,[r("button",{type:"button",class:"btn btn-secondary rounded-full",onClick:e[5]||(e[5]=(...d)=>o.cancelAction&&o.cancelAction(...d))},u(o.translations.cancel),1),r("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[C(u(o.translations.save)+" ",1),n.loadingBtn?(m(),f("span",r0)):y("",!0)],8,i0)])],32)]),_:1})])}var l0=re(Bw,[["render",a0]]);const we=un;(function(t,e){const s=un,i=t();for(;[];)try{if(-parseInt(s(142))/1*(-parseInt(s(135))/2)+-parseInt(s(134))/3+parseInt(s(133))/4*(parseInt(s(141))/5)+-parseInt(s(131))/6+parseInt(s(137))/7*(-parseInt(s(130))/8)+-parseInt(s(132))/9+parseInt(s(128))/10*(parseInt(s(139))/11)===e)break;i.push(i.shift())}catch{i.push(i.shift())}})(dn,906252);function dn(){const t=["2hEDFjs","/quote/edit/:id","861wCheij","QuoteEdit","10655337pLZdcu","/quote/new","1880ZkwCNn","507901PNMwBj","/quote/detail/:id","/invoice/edit/:id","/invoice/detail/:id","/quotes","Quote","/invoice/new","Invoice","QuoteViewDetail","40noPLkr","InvoiceEdit","86232TUTcqO","7557858yqFDNx","481284hkNnWa","2056fvbPmN","3091935PyEVKU"];return dn=function(){return t},dn()}function un(t,e){const s=dn();return un=function(i,n){return i=i-124,s[i]},un(t,e)}const c0=[{path:we(146),name:we(124),component:wd},{path:we(143),name:we(127),component:hp},{path:we(140),name:"QuoteNew",component:Wp},{path:we(136),name:we(138),component:Ho},{path:"/invoices",name:we(126),component:eg},{path:we(145),name:"InvoiceViewDetail",component:dw},{path:we(144),name:we(129),component:l0},{path:we(125),name:"InvoiceNew",component:Nw}],_0=El({history:Ka(),routes:c0});export{Ro as A,_0 as r};
