import{_ as E,d as g,o as i,c as r,n as _,a as e,t as d,g as f,F as p,r as h,w as T,i as y,v as j,j as v,H as B,k as b,l as C,e as k,m as V,f as I,h as S}from"./plugin-vue_export-helper.min.js";import{C as A,R as D}from"./RemoveAlert.min.js";import{V as F}from"./vue-datepicker.min.js";import{g as W,b as U,s as N,f as R}from"./api.min.js";const X={components:{VueDatePicker:F},props:{loading:{type:Boolean,default:!1},showModal:{type:Boolean,default:!1},modalId:{type:String,required:!0},modalTitle:{type:String,default:""},payment:{type:Object,default:()=>({id:null,invoice_number:"",company_name:"",amount:"",payment_method_id:"",payment_date:"",note:"",payment_methods:[]})},disabled:{type:Boolean,default:!0},methods:Array},data(){const s=window.myEasyComptaAdmin.easyComptaTranslations;return{editedPayment:{...this.payment},loadingBtn:!1,toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"},fields:{invoice_number:{label:s.invoice_number,disabled:this.disabled},company_name:{label:s.client,disabled:this.disabled},amount:{label:s.amount,disabled:!1},payment_method:{label:s.payment_method},payment_date:{label:s.payment_date}}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations},formattedDate(){return s=>{if(!s)return"";const t=s.getDate().toString().padStart(2,"0"),l=(s.getMonth()+1).toString().padStart(2,"0"),c=s.getFullYear();return`${t}-${l}-${c}`}},paymentMethods(){return this.methods},skeletonItems(){return Array.from({length:10},(s,t)=>t)}},methods:{closeModal(){document.getElementById("modal_payment_edit").close()},async submitForm(){this.loadingBtn=!0;try{const s=await fetch(`/wp-json/my-easy-compta/v1/payments/${this.editedPayment.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":myEasyComptaAdmin.nonce},body:JSON.stringify(this.editedPayment)});if(s.ok){const t=await s.json();this.closeModal(),this.loadingBtn=!1,this.showToast(t.message,"alert-success"),this.$emit("paymentEdited")}else{this.loadingBtn=!1;const t=`Error editing payment: ${s.statusText}`;this.showToast(t,"alert-error"),console.error(t)}}catch(s){const t=s.response&&s.response.data&&s.response.data.message?s.response.data.message:"Error editing payment";this.showToast(t,"alert-error"),console.error("Error editing payment:",s),this.loadingBtn=!1}},showToast(s,t){this.toast.message=s,this.toast.type=t,this.toast.visible=!0,setTimeout(()=>{this.toast.visible=!1},3e3)}},watch:{payment:{handler(s){this.editedPayment={...s}},immediate:!0}}},O=["id","open"],z={class:"modal-box"},L={class:"font-bold text-lg"},q={key:0},K={class:"grid grid-cols-2 gap-4"},Y=e("div",{class:"skeleton h-4 w-full mb-2"},null,-1),H=e("div",{class:"skeleton h-4 w-full"},null,-1),J=[Y,H],G={class:"grid grid-cols-2 gap-4"},Q=["for"],Z=["type","id","onUpdate:modelValue","disabled"],$=["id"],tt=["value"],et={class:"ecwp-group form-group mt-4"},st={for:"note",class:"ecwp-label form-label"},nt={class:"form-group mt-4 flex justify-end"},ot=["disabled"],at={key:0,class:"loading loading-spinner loading-sm"};function lt(s,t,l,c,n,a){const x=g("VueDatePicker");return i(),r("div",null,[n.toast.visible?(i(),r("div",{key:0,class:_(["toast",n.toast.position]),style:{zIndex:9999}},[e("div",{class:_(["alert",n.toast.type,"text-white"])},[e("span",null,d(n.toast.message),1)],2)],2)):f("",!0),e("dialog",{id:l.modalId,class:"modal",open:l.showModal},[e("div",z,[e("h3",L,d(l.modalTitle),1),e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:t[0]||(t[0]=(...m)=>a.closeModal&&a.closeModal(...m))}," \u2715 "),l.loading?(i(),r("div",q,[e("div",K,[(i(!0),r(p,null,h(a.skeletonItems,m=>(i(),r("div",{key:m,class:"py-2"},J))),128))])])):(i(),r("form",{key:1,onSubmit:t[4]||(t[4]=T((...m)=>a.submitForm&&a.submitForm(...m),["prevent"])),class:"form"},[e("div",G,[(i(!0),r(p,null,h(n.fields,(m,u)=>(i(),r("div",{key:u,class:"ecwp-group form-group"},[e("label",{for:u,class:"ecwp-label form-label"},d(m.label),9,Q),u!=="payment_method"&&u!=="payment_date"?y((i(),r("input",{key:0,type:m.type||"text",id:u,"onUpdate:modelValue":o=>n.editedPayment[u]=o,class:_(["ecwp-input input","input-bordered",m.class||"w-full"]),disabled:m.disabled},null,10,Z)),[[j,n.editedPayment[u]]]):u=="payment_method"?y((i(),r("select",{key:1,id:u,"onUpdate:modelValue":t[1]||(t[1]=o=>n.editedPayment.payment_method_id=o),class:_(["ecwp-input input","input-bordered",m.class||"w-full"])},[(i(!0),r(p,null,h(a.paymentMethods,o=>(i(),r("option",{key:o.id,value:o.id},d(o.method_name),9,tt))),128))],10,$)),[[v,n.editedPayment.payment_method_id]]):u=="payment_date"?(i(),B(x,{key:2,class:"ecwp-input ecwp-date input input-bordered w-full",id:"invoiceDate",modelValue:n.editedPayment.payment_date,"onUpdate:modelValue":t[2]||(t[2]=o=>n.editedPayment.payment_date=o),"enable-time-picker":!1,"auto-apply":"",format:a.formattedDate,"min-date":new Date,locale:"fr",required:""},null,8,["modelValue","format","min-date"])):f("",!0)]))),128))]),e("div",et,[e("label",st,d(a.translations.note),1),y(e("textarea",{id:"note","onUpdate:modelValue":t[3]||(t[3]=m=>n.editedPayment.notes=m),class:"ecwp-input textarea textarea-bordered w-full",rows:"4"},null,512),[[b,n.editedPayment.notes]])]),e("div",nt,[e("button",{type:"submit",class:"btn btn-primary rounded-full",disabled:n.loadingBtn},[C(d(a.translations.save)+" ",1),n.loadingBtn?(i(),r("span",at)):f("",!0)],8,ot)])],32))])],8,O)])}var it=E(X,[["render",lt]]);const rt={name:"Payments",components:{Card:A,PaymentEditModal:it,RemoveModal:D},data(){return{payments:[],filteredPayments:[],filters:{invoice_number:"",client:"",payment_date:"",total_amount:"",payment_methods:""},clients:[],payments_methods:[],paymentMethods:[],paymentForm:{invoice_id:"",client_id:"",amount:"",payment_method_id:"",payment_date:""},editPaymentModal:!1,selectedPayment:null,currentPage:1,totalPages:1,paginationButtons:[],loading:!0,loadingPrice:!0,loadingModal:!1,showRemoveModal:!1,skeletonRows:5,perPage:10,perPageOptions:[5,10,20,50],settings:[],default_currency_symbol:"",toast:{visible:!1,message:"",type:"alert-success",position:"toast-bottom toast-end"}}},created(){this.fetchPaymentsWithFilters(),this.fetchClients(),this.fetchPaymentMethods(),this.loadSettings()},methods:{fetchPayments(s=1){this.loading=!0;const{perPage:t}=this;fetch(`/wp-json/my-easy-compta/v1/payments?page=${s}&per_page=${t}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(l=>l.json()).then(l=>{this.payments=l.payments,this.totalCount=l.total_count,this.totalPages=l.total_pages,this.currentPage=l.page,this.perPage=t,this.generatePaginationButtons()}).catch(l=>{console.error("Error fetching payments:",l)}).finally(()=>{this.loading=!1})},fetchPaymentsWithFilters(s=1){this.loading=!0;const{perPage:t,filters:l}=this,c=new URLSearchParams({page:s,per_page:t,...l}).toString();fetch(`/wp-json/my-easy-compta/v1/payments?${c}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(n=>n.json()).then(n=>{this.payments=n.payments,this.totalCount=n.total_count,this.totalPages=n.total_pages,this.currentPage=s,this.perPage=t,this.generatePaginationButtons()}).catch(n=>{console.error("Error fetching payments with filters:",n)}).finally(()=>{this.loading=!1})},fetchClients(){fetch("/wp-json/my-easy-compta/v1/clients",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(s=>s.json()).then(s=>{this.clients=s.clients}).catch(s=>{console.error("Error fetching clients:",s)})},fetchPaymentMethods(){fetch("/wp-json/my-easy-compta/v1/payments/methods",{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(s=>s.json()).then(s=>{this.payments_methods=s}).catch(s=>{console.error("Error fetching payment Methods:",s)})},editPayment(s){this.loadingModal=!0,this.editPaymentModal=!0,modal_payment_edit.showModal(),this.fetchPaymentDetails(s)},fetchPaymentDetails(s){fetch(`/wp-json/my-easy-compta/v1/payments/details/${s}`,{headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>t.json()).then(t=>{this.selectedPayment=t,this.paymentMethods=t.payment_methods,this.loadingModal=!1}).catch(t=>{console.error("Error fetching payment details:",t),this.loadingModal=!1})},generatePaginationButtons(){this.paginationButtons=W(this.currentPage,this.totalPages)},goToPage(s){s!=="..."&&this.fetchPaymentsWithFilters(s)},perPageChanged(){this.fetchPaymentsWithFilters()},formatAmount(s,t){return U(s,t,this.settings.currency_position)},showToast(s,t){N(this.toast,s,t)},closePaymentModal(){this.showPaymentModal=!1},confirmDeletePayment(s){this.selectedPayment=s,modal_remove.showModal(),this.showRemoveModal=!0},deletePayment(s){this.loading=!0,fetch(`/wp-json/my-easy-compta/v1/payments/${s}`,{method:"DELETE",headers:{"X-WP-Nonce":myEasyComptaAdmin.nonce}}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(t=>{t.success?(this.fetchPayments(),this.showToast(t.message,"alert-success")):(this.showToast(t.message,"alert-error"),console.error("Error deleting payment:",t.statusText))}).catch(t=>{console.error("Error deleting payment:",t)})},async loadSettings(){try{this.loadingPrice=!0;const{settings:s,currencySymbol:t,vatData:l}=await R();this.settings=s,this.default_currency_symbol=t,this.default_vat=l,this.loadingPrice=!1}catch(s){this.showToast(s.message,"alert-error"),this.loadingPrice=!1}}},computed:{translations(){return window.myEasyComptaAdmin.easyComptaTranslations}}},dt={class:"pt-2 pr-4"},mt={class:"flex justify-between items-center"},ct={class:"card-title"},ut={key:0},pt={class:"btn btn-outline btn-accent rounded-full",href:"/wp-admin/admin.php?page=my-easy-compta-export#tab4"},ht=e("i",{class:"fas fa-file-export"},null,-1),yt=["data-tip"],_t={class:"btn btn-outline btn-accent rounded-full",disabled:""},ft=e("i",{class:"fas fa-file-export"},null,-1),gt=e("div",{class:"divider mt-2"},null,-1),vt={class:"flex items-center mb-4"},bt={for:"perPageSelect",class:"mr-2"},Pt=["value"],wt={class:"overflow-x-auto"},xt={class:"table w-full"},kt={value:""},Ct=["value"],Mt={value:""},Et=["value"],Tt={class:"align-top"},jt={class:"flex justify-center"},Bt={key:0},Vt={key:0},It={key:1},St=e("span",{class:"loading loading-bars loading-sm"},null,-1),At=[St],Dt={class:"flex justify-end"},Ft=["data-tip"],Wt=["onClick"],Ut=e("i",{class:"fas fa-pencil-alt"},null,-1),Nt=[Ut],Rt=["data-tip"],Xt=["onClick"],Ot=e("i",{class:"far fa-trash-alt"},null,-1),zt=[Ot],Lt={key:0},qt=e("div",{class:"flex gap-4 items-center"},[e("div",{class:"skeleton w-16 h-16 rounded-full shrink-0"}),e("div",{class:"flex flex-col gap-4 w-full"},[e("div",{class:"skeleton h-4 w-full"}),e("div",{class:"skeleton h-4 w-full"})])],-1),Kt=e("div",{class:"divider my-1"},null,-1),Yt=[qt,Kt],Ht={class:"join ecwp_pagination mt-6 pt-4"},Jt=["onClick"];function Gt(s,t,l,c,n,a){const x=g("payment-edit-modal"),m=g("remove-modal"),u=g("Card");return i(),r("div",dt,[n.toast.visible?(i(),r("div",{key:0,class:_(["toast",n.toast.position]),style:{zIndex:9999}},[e("div",{class:_(["alert",n.toast.type,"text-white"])},[e("span",null,d(n.toast.message),1)],2)],2)):f("",!0),k(x,{loading:n.loadingModal,"show-modal":n.editPaymentModal,"modal-id":"modal_payment_edit","modal-title":a.translations.edit_payment,payment:n.selectedPayment,methods:n.paymentMethods,onClose:t[0]||(t[0]=o=>n.editPaymentModal=!1),onPaymentEdited:a.fetchPayments},null,8,["loading","show-modal","modal-title","payment","methods","onPaymentEdited"]),k(m,{"show-modal":n.showRemoveModal,title:a.translations.are_you_sure,message:a.translations.no_turning_back,confirmText:a.translations.yes_delete_it,cancelText:a.translations.cancel,onConfirm:t[1]||(t[1]=o=>this.deletePayment(n.selectedPayment)),onCancel:t[2]||(t[2]=o=>n.showRemoveModal=!1)},null,8,["show-modal","title","message","confirmText","cancelText"]),k(u,{topMargin:"mt-8"},{default:V(()=>[e("div",mt,[e("h2",ct,d(a.translations.payments),1),n.settings.easy_compta_export_addon_active==1?(i(),r("div",ut,[e("a",pt,[C(d(a.translations.export)+" ",1),ht])])):(i(),r("div",{key:1,class:"tooltip tooltip-left tooltip-warning","data-tip":a.translations.active_export_addon},[e("button",_t,[C(d(a.translations.export)+" ",1),ft])],8,yt))]),gt,e("div",vt,[e("label",bt,d(a.translations.display_per_page),1),y(e("select",{id:"perPageSelect","onUpdate:modelValue":t[3]||(t[3]=o=>n.perPage=o),onChange:t[4]||(t[4]=(...o)=>a.perPageChanged&&a.perPageChanged(...o))},[(i(!0),r(p,null,h(n.perPageOptions,o=>(i(),r("option",{key:o,value:o},d(o),9,Pt))),128))],544),[[v,n.perPage]])]),e("div",wt,[e("table",xt,[e("thead",null,[e("tr",null,[e("th",null,[e("div",null,d(a.translations.invoice_number),1),y(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>n.filters.invoice_number=o),onInput:t[6]||(t[6]=o=>a.fetchPaymentsWithFilters()),type:"text",class:"ecwp-input input-xs input-bordered mt-2"},null,544),[[b,n.filters.invoice_number]])]),e("th",null,[e("div",null,d(a.translations.client),1),y(e("select",{"onUpdate:modelValue":t[7]||(t[7]=o=>n.filters.client=o),onChange:t[8]||(t[8]=o=>a.fetchPaymentsWithFilters()),class:"ecwp-input input-xs input-bordered mt-2"},[e("option",kt,d(a.translations.all),1),(i(!0),r(p,null,h(n.clients,o=>(i(),r("option",{key:o.id,value:o.company_name},d(o.company_name),9,Ct))),128))],544),[[v,n.filters.client]])]),e("th",null,[e("div",null,d(a.translations.payment_date),1),y(e("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>n.filters.payment_date=o),onInput:t[10]||(t[10]=o=>a.fetchPaymentsWithFilters()),type:"date",class:"ecwp-input input-xs input-bordered mt-2"},null,544),[[b,n.filters.payment_date]])]),e("th",null,[e("div",null,d(a.translations.amount),1),y(e("input",{"onUpdate:modelValue":t[11]||(t[11]=o=>n.filters.total_amount=o),onInput:t[12]||(t[12]=o=>a.fetchPaymentsWithFilters()),type:"text",class:"ecwp-input input-xs input-bordered mt-2"},null,544),[[b,n.filters.total_amount]])]),e("th",null,[e("div",null,d(a.translations.payment_method),1),y(e("select",{"onUpdate:modelValue":t[13]||(t[13]=o=>n.filters.payment_method=o),onChange:t[14]||(t[14]=o=>a.fetchPaymentsWithFilters()),class:"ecwp-input input-xs input-bordered mt-2"},[e("option",Mt,d(a.translations.all),1),(i(!0),r(p,null,h(n.payments_methods,o=>(i(),r("option",{key:o.id,value:o.method_name},d(o.method_name),9,Et))),128))],544),[[v,n.filters.payment_method]])]),e("th",Tt,d(a.translations.note),1),e("th",jt,d(a.translations.actions),1)])]),n.loading?f("",!0):(i(),r("tbody",Bt,[(i(!0),r(p,null,h(n.payments,o=>(i(),r("tr",{key:o.id},[e("td",null,d(o.invoice_number),1),e("td",null,d(o.company_name),1),e("td",null,d(o.payment_date),1),e("td",null,[n.loadingPrice?(i(),r("div",It,At)):(i(),r("div",Vt,[e("span",null,d(a.formatAmount(o.amount,n.default_currency_symbol)),1)]))]),e("td",null,d(o.payment_method),1),e("td",null,d(o.notes),1),e("td",Dt,[e("span",{class:"lg:tooltip","data-tip":a.translations.edit},[e("button",{class:"btn btn-circle mx-1",onClick:M=>a.editPayment(o.id)},Nt,8,Wt)],8,Ft),e("span",{class:"lg:tooltip","data-tip":a.translations.delete},[e("button",{onClick:M=>a.confirmDeletePayment(o.id),class:"btn btn-circle text-red-500 hover:text-red-700 mx-1"},zt,8,Xt)],8,Rt)])]))),128))]))]),n.loading?(i(),r("div",Lt,[(i(!0),r(p,null,h(n.skeletonRows,o=>(i(),r("div",{key:o,class:"flex flex-col gap-4 w-full"},Yt))),128))])):f("",!0),e("div",Ht,[(i(!0),r(p,null,h(n.paginationButtons,o=>(i(),r("button",{key:o,class:_(["join-item btn",{"btn-disabled":o==="..."||o===n.currentPage}]),onClick:M=>a.goToPage(o)},d(o),11,Jt))),128))])])]),_:1})])}var Qt=E(rt,[["render",Gt]]);const Zt=P;function P(s,t){const l=w();return P=function(c,n){return c=c-287,l[c]},P(s,t)}(function(s,t){const l=P,c=s();for(;[];)try{if(-parseInt(l(291))/1*(parseInt(l(298))/2)+-parseInt(l(287))/3+parseInt(l(288))/4*(-parseInt(l(289))/5)+-parseInt(l(297))/6*(parseInt(l(293))/7)+-parseInt(l(294))/8+parseInt(l(296))/9+-parseInt(l(290))/10*(-parseInt(l(295))/11)===t)break;c.push(c.shift())}catch{c.push(c.shift())}})(w,557177);const $t=I({render:()=>S(Qt)});function w(){const s=["145YwhPNT","4122300cAAohw","1pNLAuj","mount","7boltSJ","7746160SBmFzM","77rnnuaw","962550ePRwGn","3864684TOcfVN","87618XeiYKp","959664uKKSjX","63352vlHvak"];return w=function(){return s},w()}$t[Zt(292)]("#my-easy-compta-payments-app");
